"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/datasets/[name]/analyze/route";
exports.ids = ["app/api/datasets/[name]/analyze/route"];
exports.modules = {

/***/ "@aws-sdk/client-s3":
/*!*************************************!*\
  !*** external "@aws-sdk/client-s3" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@aws-sdk/client-s3");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_juliangarritz_dev_py_veraset_veraset_api_app_api_datasets_name_analyze_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/datasets/[name]/analyze/route.ts */ \"(rsc)/./app/api/datasets/[name]/analyze/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/datasets/[name]/analyze/route\",\n        pathname: \"/api/datasets/[name]/analyze\",\n        filename: \"route\",\n        bundlePath: \"app/api/datasets/[name]/analyze/route\"\n    },\n    resolvedPagePath: \"/Users/juliangarritz/dev/py/veraset/veraset-api/app/api/datasets/[name]/analyze/route.ts\",\n    nextConfigOutput,\n    userland: _Users_juliangarritz_dev_py_veraset_veraset_api_app_api_datasets_name_analyze_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/datasets/[name]/analyze/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkYXRhc2V0cyUyRiU1Qm5hbWUlNUQlMkZhbmFseXplJTJGcm91dGUmcGFnZT0lMkZhcGklMkZkYXRhc2V0cyUyRiU1Qm5hbWUlNUQlMkZhbmFseXplJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZGF0YXNldHMlMkYlNUJuYW1lJTVEJTJGYW5hbHl6ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmp1bGlhbmdhcnJpdHolMkZkZXYlMkZweSUyRnZlcmFzZXQlMkZ2ZXJhc2V0LWFwaSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZqdWxpYW5nYXJyaXR6JTJGZGV2JTJGcHklMkZ2ZXJhc2V0JTJGdmVyYXNldC1hcGkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3dDO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ21jLXZlcmFzZXQtYXBpLz80MzJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9qdWxpYW5nYXJyaXR6L2Rldi9weS92ZXJhc2V0L3ZlcmFzZXQtYXBpL2FwcC9hcGkvZGF0YXNldHMvW25hbWVdL2FuYWx5emUvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2RhdGFzZXRzL1tuYW1lXS9hbmFseXplL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZGF0YXNldHMvW25hbWVdL2FuYWx5emVcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2RhdGFzZXRzL1tuYW1lXS9hbmFseXplL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2p1bGlhbmdhcnJpdHovZGV2L3B5L3ZlcmFzZXQvdmVyYXNldC1hcGkvYXBwL2FwaS9kYXRhc2V0cy9bbmFtZV0vYW5hbHl6ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvZGF0YXNldHMvW25hbWVdL2FuYWx5emUvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/datasets/[name]/analyze/route.ts":
/*!**************************************************!*\
  !*** ./app/api/datasets/[name]/analyze/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   revalidate: () => (/* binding */ revalidate)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_dataset_analyzer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/dataset-analyzer */ \"(rsc)/./lib/dataset-analyzer.ts\");\n\n\nconst dynamic = \"force-dynamic\";\nconst revalidate = 0;\nconst maxDuration = 300; // Allow up to 5 minutes for Athena queries (Vercel max)\nasync function POST(req, { params }) {\n    try {\n        const body = await req.json().catch(()=>({}));\n        const filters = body.filters || {};\n        const result = await (0,_lib_dataset_analyzer__WEBPACK_IMPORTED_MODULE_1__.analyzeDataset)(params.name, filters);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(result);\n    } catch (error) {\n        console.error(`POST /api/datasets/${params.name}/analyze error:`, error);\n        console.error(\"Error stack:\", error.stack);\n        // Provide more helpful error messages\n        let errorMessage = error.message || \"Unknown error\";\n        let statusCode = 500;\n        if (errorMessage.includes(\"AWS credentials not configured\")) {\n            statusCode = 503;\n            errorMessage = \"AWS credentials not configured. Please configure AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY.\";\n        } else if (errorMessage.includes(\"database\") || errorMessage.includes(\"Database\")) {\n            statusCode = 503;\n            errorMessage = `Athena database 'veraset' not found. Please create it in AWS Glue: aws glue create-database --database-input '{\"Name\": \"veraset\"}'`;\n        } else if (errorMessage.includes(\"Access denied\")) {\n            statusCode = 403;\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Analysis failed\",\n            details: errorMessage,\n            hint: errorMessage.includes(\"database\") ? 'Run: aws glue create-database --database-input \\'{\"Name\": \"veraset\"}\\'' : undefined\n        }, {\n            status: statusCode\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2RhdGFzZXRzL1tuYW1lXS9hbmFseXplL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUEyQztBQUM4QjtBQUVsRSxNQUFNRSxVQUFVLGdCQUFnQjtBQUNoQyxNQUFNQyxhQUFhLEVBQUU7QUFDckIsTUFBTUMsY0FBYyxJQUFJLENBQUMsd0RBQXdEO0FBRWpGLGVBQWVDLEtBQ3BCQyxHQUFZLEVBQ1osRUFBRUMsTUFBTSxFQUFnQztJQUV4QyxJQUFJO1FBQ0YsTUFBTUMsT0FBTyxNQUFNRixJQUFJRyxJQUFJLEdBQUdDLEtBQUssQ0FBQyxJQUFPLEVBQUM7UUFDNUMsTUFBTUMsVUFBMkJILEtBQUtHLE9BQU8sSUFBSSxDQUFDO1FBRWxELE1BQU1DLFNBQVMsTUFBTVgscUVBQWNBLENBQUNNLE9BQU9NLElBQUksRUFBRUY7UUFFakQsT0FBT1gscURBQVlBLENBQUNTLElBQUksQ0FBQ0c7SUFFM0IsRUFBRSxPQUFPRSxPQUFZO1FBQ25CQyxRQUFRRCxLQUFLLENBQUMsQ0FBQyxtQkFBbUIsRUFBRVAsT0FBT00sSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFQztRQUNsRUMsUUFBUUQsS0FBSyxDQUFDLGdCQUFnQkEsTUFBTUUsS0FBSztRQUV6QyxzQ0FBc0M7UUFDdEMsSUFBSUMsZUFBZUgsTUFBTUksT0FBTyxJQUFJO1FBQ3BDLElBQUlDLGFBQWE7UUFFakIsSUFBSUYsYUFBYUcsUUFBUSxDQUFDLG1DQUFtQztZQUMzREQsYUFBYTtZQUNiRixlQUFlO1FBQ2pCLE9BQU8sSUFBSUEsYUFBYUcsUUFBUSxDQUFDLGVBQWVILGFBQWFHLFFBQVEsQ0FBQyxhQUFhO1lBQ2pGRCxhQUFhO1lBQ2JGLGVBQWUsQ0FBQyxrSUFBa0ksQ0FBQztRQUNySixPQUFPLElBQUlBLGFBQWFHLFFBQVEsQ0FBQyxrQkFBa0I7WUFDakRELGFBQWE7UUFDZjtRQUVBLE9BQU9uQixxREFBWUEsQ0FBQ1MsSUFBSSxDQUN0QjtZQUNFSyxPQUFPO1lBQ1BPLFNBQVNKO1lBQ1RLLE1BQU1MLGFBQWFHLFFBQVEsQ0FBQyxjQUFjLDJFQUEyRUc7UUFDdkgsR0FDQTtZQUFFQyxRQUFRTDtRQUFXO0lBRXpCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nbWMtdmVyYXNldC1hcGkvLi9hcHAvYXBpL2RhdGFzZXRzL1tuYW1lXS9hbmFseXplL3JvdXRlLnRzPzY5NTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgYW5hbHl6ZURhdGFzZXQsIEFuYWx5c2lzRmlsdGVycyB9IGZyb20gJ0AvbGliL2RhdGFzZXQtYW5hbHl6ZXInO1xuXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJztcbmV4cG9ydCBjb25zdCByZXZhbGlkYXRlID0gMDtcbmV4cG9ydCBjb25zdCBtYXhEdXJhdGlvbiA9IDMwMDsgLy8gQWxsb3cgdXAgdG8gNSBtaW51dGVzIGZvciBBdGhlbmEgcXVlcmllcyAoVmVyY2VsIG1heClcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoXG4gIHJlcTogUmVxdWVzdCxcbiAgeyBwYXJhbXMgfTogeyBwYXJhbXM6IHsgbmFtZTogc3RyaW5nIH0gfVxuKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgY29uc3QgZmlsdGVyczogQW5hbHlzaXNGaWx0ZXJzID0gYm9keS5maWx0ZXJzIHx8IHt9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5hbHl6ZURhdGFzZXQocGFyYW1zLm5hbWUsIGZpbHRlcnMpO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3VsdCk7XG5cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYFBPU1QgL2FwaS9kYXRhc2V0cy8ke3BhcmFtcy5uYW1lfS9hbmFseXplIGVycm9yOmAsIGVycm9yKTtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdGFjazonLCBlcnJvci5zdGFjayk7XG4gICAgXG4gICAgLy8gUHJvdmlkZSBtb3JlIGhlbHBmdWwgZXJyb3IgbWVzc2FnZXNcbiAgICBsZXQgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcic7XG4gICAgbGV0IHN0YXR1c0NvZGUgPSA1MDA7XG4gICAgXG4gICAgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygnQVdTIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkJykpIHtcbiAgICAgIHN0YXR1c0NvZGUgPSA1MDM7XG4gICAgICBlcnJvck1lc3NhZ2UgPSAnQVdTIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkLiBQbGVhc2UgY29uZmlndXJlIEFXU19BQ0NFU1NfS0VZX0lEIGFuZCBBV1NfU0VDUkVUX0FDQ0VTU19LRVkuJztcbiAgICB9IGVsc2UgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygnZGF0YWJhc2UnKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ0RhdGFiYXNlJykpIHtcbiAgICAgIHN0YXR1c0NvZGUgPSA1MDM7XG4gICAgICBlcnJvck1lc3NhZ2UgPSBgQXRoZW5hIGRhdGFiYXNlICd2ZXJhc2V0JyBub3QgZm91bmQuIFBsZWFzZSBjcmVhdGUgaXQgaW4gQVdTIEdsdWU6IGF3cyBnbHVlIGNyZWF0ZS1kYXRhYmFzZSAtLWRhdGFiYXNlLWlucHV0ICd7XCJOYW1lXCI6IFwidmVyYXNldFwifSdgO1xuICAgIH0gZWxzZSBpZiAoZXJyb3JNZXNzYWdlLmluY2x1ZGVzKCdBY2Nlc3MgZGVuaWVkJykpIHtcbiAgICAgIHN0YXR1c0NvZGUgPSA0MDM7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiAnQW5hbHlzaXMgZmFpbGVkJywgXG4gICAgICAgIGRldGFpbHM6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgaGludDogZXJyb3JNZXNzYWdlLmluY2x1ZGVzKCdkYXRhYmFzZScpID8gJ1J1bjogYXdzIGdsdWUgY3JlYXRlLWRhdGFiYXNlIC0tZGF0YWJhc2UtaW5wdXQgXFwne1wiTmFtZVwiOiBcInZlcmFzZXRcIn1cXCcnIDogdW5kZWZpbmVkXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IHN0YXR1c0NvZGUgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJhbmFseXplRGF0YXNldCIsImR5bmFtaWMiLCJyZXZhbGlkYXRlIiwibWF4RHVyYXRpb24iLCJQT1NUIiwicmVxIiwicGFyYW1zIiwiYm9keSIsImpzb24iLCJjYXRjaCIsImZpbHRlcnMiLCJyZXN1bHQiLCJuYW1lIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhY2siLCJlcnJvck1lc3NhZ2UiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImluY2x1ZGVzIiwiZGV0YWlscyIsImhpbnQiLCJ1bmRlZmluZWQiLCJzdGF0dXMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/datasets/[name]/analyze/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/athena.ts":
/*!***********************!*\
  !*** ./lib/athena.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createTableForDataset: () => (/* binding */ createTableForDataset),\n/* harmony export */   getTableName: () => (/* binding */ getTableName),\n/* harmony export */   runQuery: () => (/* binding */ runQuery),\n/* harmony export */   tableExists: () => (/* binding */ tableExists)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/AthenaClient.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/StartQueryExecutionCommand.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/GetQueryExecutionCommand.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/GetQueryResultsCommand.js\");\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @aws-sdk/client-s3 */ \"@aws-sdk/client-s3\");\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * AWS Athena client for querying Parquet files in S3\n */ \n\nconst athena = new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_1__.AthenaClient({\n    region: process.env.AWS_REGION || \"us-west-2\",\n    credentials: {\n        accessKeyId: process.env.AWS_ACCESS_KEY_ID || \"\",\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || \"\"\n    }\n});\nconst DATABASE = \"veraset\";\nconst OUTPUT_LOCATION = process.env.ATHENA_OUTPUT_LOCATION || `s3://${process.env.S3_BUCKET || \"garritz-veraset-data-us-west-2\"}/athena-results/`;\nconst BUCKET = process.env.S3_BUCKET || \"garritz-veraset-data-us-west-2\";\nconst s3Client = new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.S3Client({\n    region: process.env.AWS_REGION || \"us-west-2\",\n    credentials: {\n        accessKeyId: process.env.AWS_ACCESS_KEY_ID || \"\",\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || \"\"\n    }\n});\n/**\n * Run an Athena SQL query and return results\n */ async function runQuery(sql) {\n    try {\n        // Check if AWS credentials are configured\n        if (!process.env.AWS_ACCESS_KEY_ID || !process.env.AWS_SECRET_ACCESS_KEY) {\n            throw new Error(\"AWS credentials not configured. Please set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables.\");\n        }\n        // Start query\n        const startRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_2__.StartQueryExecutionCommand({\n            QueryString: sql,\n            QueryExecutionContext: {\n                Database: DATABASE\n            },\n            ResultConfiguration: {\n                OutputLocation: OUTPUT_LOCATION\n            }\n        }));\n        const queryId = startRes.QueryExecutionId;\n        if (!queryId) {\n            throw new Error(\"No query execution ID returned from Athena\");\n        }\n        console.log(`üöÄ Started Athena query: ${queryId}`);\n        console.log(`   Query preview: ${sql.substring(0, 200)}${sql.length > 200 ? \"...\" : \"\"}`);\n        // Poll for completion\n        let state = \"QUEUED\";\n        let attempts = 0;\n        const maxAttempts = 600; // 5 minutes max (500ms * 600) - Athena queries can take time\n        const logInterval = 20; // Log every 10 seconds\n        while((state === \"QUEUED\" || state === \"RUNNING\") && attempts < maxAttempts){\n            await new Promise((r)=>setTimeout(r, 500));\n            attempts++;\n            const statusRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_3__.GetQueryExecutionCommand({\n                QueryExecutionId: queryId\n            }));\n            state = statusRes.QueryExecution?.Status?.State;\n            // Log progress periodically\n            if (attempts % logInterval === 0) {\n                const elapsedSeconds = Math.floor(attempts * 0.5);\n                console.log(`   ‚è≥ Query ${queryId}: ${state} (${elapsedSeconds}s elapsed)`);\n                // If stuck in QUEUED for too long, log warning\n                if (state === \"QUEUED\" && elapsedSeconds > 30) {\n                    console.warn(`   ‚ö†Ô∏è Query ${queryId} has been QUEUED for ${elapsedSeconds}s. This may indicate Athena is overloaded or there are permission issues.`);\n                }\n            }\n            if (state === \"FAILED\") {\n                const reason = statusRes.QueryExecution?.Status?.StateChangeReason || \"Query failed\";\n                const queryString = statusRes.QueryExecution?.Query || \"\";\n                const statistics = statusRes.QueryExecution?.Statistics;\n                console.error(`‚ùå Athena query ${queryId} failed:`);\n                console.error(`   Reason: ${reason}`);\n                console.error(`   Query: ${queryString.substring(0, 500)}${queryString.length > 500 ? \"...\" : \"\"}`);\n                if (statistics) {\n                    console.error(`   Statistics:`, JSON.stringify(statistics, null, 2));\n                }\n                throw new Error(`Athena query failed: ${reason}`);\n            }\n            if (state === \"CANCELLED\") {\n                console.error(`‚ùå Athena query ${queryId} was cancelled`);\n                throw new Error(\"Athena query was cancelled\");\n            }\n        }\n        if (state !== \"SUCCEEDED\") {\n            const elapsedSeconds = Math.floor(attempts * 0.5);\n            const errorMsg = `Query ${queryId} did not complete within ${elapsedSeconds}s. Final state: ${state}`;\n            console.error(`‚ùå ${errorMsg}`);\n            console.error(`   Query: ${sql.substring(0, 500)}${sql.length > 500 ? \"...\" : \"\"}`);\n            console.error(`   You can check the query status in AWS Console: https://console.aws.amazon.com/athena/home?region=${process.env.AWS_REGION || \"us-west-2\"}#query-history`);\n            throw new Error(errorMsg);\n        }\n        console.log(`‚úÖ Athena query ${queryId} completed successfully (${Math.floor(attempts * 0.5)}s)`);\n        // Get results\n        const resultsRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_4__.GetQueryResultsCommand({\n            QueryExecutionId: queryId\n        }));\n        const rows = resultsRes.ResultSet?.Rows || [];\n        if (rows.length === 0) {\n            return {\n                columns: [],\n                rows: []\n            };\n        }\n        // First row is headers\n        const columns = rows[0].Data?.map((d)=>d.VarCharValue || \"\") || [];\n        // Remaining rows are data\n        const data = rows.slice(1).map((row)=>{\n            const obj = {};\n            row.Data?.forEach((d, i)=>{\n                const value = d.VarCharValue;\n                const columnName = columns[i];\n                // Keep dates as strings (they come formatted from Athena)\n                if (columnName === \"date\" && value) {\n                    obj[columnName] = value;\n                } else if (value !== null && value !== undefined) {\n                    // Try to parse numbers\n                    const numValue = parseFloat(value);\n                    obj[columnName] = isNaN(numValue) ? value : numValue;\n                } else {\n                    obj[columnName] = null;\n                }\n            });\n            return obj;\n        });\n        return {\n            columns,\n            rows: data\n        };\n    } catch (error) {\n        console.error(\"Athena query error:\", error);\n        // Provide more helpful error messages\n        if (error.name === \"InvalidRequestException\") {\n            if (error.message?.includes(\"Database\") || error.message?.includes(\"not found\")) {\n                throw new Error(`Athena database '${DATABASE}' not found. Please create it in AWS Glue first.`);\n            }\n            if (error.message?.includes(\"does not exist\")) {\n                throw new Error(`Table does not exist. Error: ${error.message}`);\n            }\n        }\n        if (error.name === \"AccessDeniedException\") {\n            throw new Error(`Access denied to Athena. Please check IAM permissions. Error: ${error.message}`);\n        }\n        throw error;\n    }\n}\n/**\n * Discover partitions from S3 by listing objects\n */ async function discoverPartitionsFromS3(datasetName) {\n    const prefix = `${datasetName}/`;\n    const partitions = new Set();\n    try {\n        console.log(`üîç Discovering partitions for ${datasetName} from S3 prefix: ${prefix}`);\n        let continuationToken;\n        let pageCount = 0;\n        do {\n            pageCount++;\n            const listRes = await s3Client.send(new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.ListObjectsV2Command({\n                Bucket: BUCKET,\n                Prefix: prefix,\n                Delimiter: \"/\",\n                MaxKeys: 1000\n            }));\n            // Extract partition dates from common prefixes\n            if (listRes.CommonPrefixes) {\n                console.log(`   Page ${pageCount}: Found ${listRes.CommonPrefixes.length} common prefixes`);\n                for (const prefixObj of listRes.CommonPrefixes){\n                    const prefixPath = prefixObj.Prefix || \"\";\n                    const match = prefixPath.match(/date=(\\d{4}-\\d{2}-\\d{2})/);\n                    if (match) {\n                        partitions.add(match[1]);\n                    }\n                }\n            }\n            // Also check individual objects for date patterns (in case Delimiter didn't catch them)\n            if (listRes.Contents) {\n                console.log(`   Page ${pageCount}: Found ${listRes.Contents.length} objects`);\n                for (const obj of listRes.Contents){\n                    const key = obj.Key || \"\";\n                    const match = key.match(/date=(\\d{4}-\\d{2}-\\d{2})/);\n                    if (match) {\n                        partitions.add(match[1]);\n                    }\n                }\n            }\n            continuationToken = listRes.NextContinuationToken;\n            if (continuationToken) {\n                console.log(`   Page ${pageCount}: More results available, continuing...`);\n            }\n        }while (continuationToken);\n        const sortedPartitions = Array.from(partitions).sort();\n        console.log(`‚úÖ Discovered ${sortedPartitions.length} partitions: ${sortedPartitions.slice(0, 5).join(\", \")}${sortedPartitions.length > 5 ? \"...\" : \"\"}`);\n        return sortedPartitions;\n    } catch (error) {\n        console.error(`‚ùå Error discovering partitions from S3:`, error.message || error);\n        return [];\n    }\n}\n/**\n * Add partitions manually to ensure all data is accessible\n */ async function addPartitionsManually(tableName, datasetName, partitions) {\n    if (partitions.length === 0) {\n        console.log(`No partitions found in S3 for ${datasetName}`);\n        return;\n    }\n    console.log(`üì¶ Found ${partitions.length} partitions in S3, adding to table...`);\n    // Add partitions in batches (Athena has limits)\n    const batchSize = 50;\n    for(let i = 0; i < partitions.length; i += batchSize){\n        const batch = partitions.slice(i, i + batchSize);\n        const partitionSpecs = batch.map((date)=>`PARTITION (date='${date}') LOCATION 's3://${BUCKET}/${datasetName}/date=${date}/'`).join(\", \");\n        try {\n            await runQuery(`ALTER TABLE ${tableName} ADD IF NOT EXISTS ${partitionSpecs}`);\n            console.log(`‚úÖ Added ${batch.length} partitions (${i + 1}-${Math.min(i + batch.length, partitions.length)}/${partitions.length})`);\n        } catch (error) {\n            // Ignore \"partition already exists\" errors\n            if (!error.message?.includes(\"already exists\")) {\n                console.warn(`Warning adding partitions batch ${i / batchSize + 1}:`, error.message);\n            }\n        }\n    }\n}\n/**\n * Create an external table for a dataset in Athena/Glue\n * Ensures all partitions are loaded so all Parquet files are accessible\n */ async function createTableForDataset(datasetName) {\n    const tableName = getTableName(datasetName);\n    // First, discover partitions from S3\n    console.log(`üîç Discovering partitions for ${datasetName} from S3...`);\n    const s3Partitions = await discoverPartitionsFromS3(datasetName);\n    console.log(`üìÖ Found ${s3Partitions.length} partitions in S3:`, s3Partitions.slice(0, 10).join(\", \"), s3Partitions.length > 10 ? \"...\" : \"\");\n    const sql = `\n    CREATE EXTERNAL TABLE IF NOT EXISTS ${tableName} (\n      ad_id STRING,\n      utc_timestamp TIMESTAMP,\n      horizontal_accuracy DOUBLE,\n      id_type STRING,\n      ip_address STRING,\n      latitude DOUBLE,\n      longitude DOUBLE,\n      iso_country_code STRING,\n      poi_ids ARRAY<STRING>\n    )\n    PARTITIONED BY (date STRING)\n    STORED AS PARQUET\n    LOCATION 's3://${BUCKET}/${datasetName}/'\n  `;\n    try {\n        await runQuery(sql);\n        console.log(`‚úÖ Created/verified table: ${tableName}`);\n        // Try MSCK REPAIR first (fastest if it works)\n        try {\n            await runQuery(`MSCK REPAIR TABLE ${tableName}`);\n            console.log(`‚úÖ Repaired partitions with MSCK REPAIR`);\n        } catch (repairError) {\n            console.warn(`MSCK REPAIR failed:`, repairError.message);\n            // Fall back to manual partition addition\n            if (s3Partitions.length > 0) {\n                await addPartitionsManually(tableName, datasetName, s3Partitions);\n            }\n        }\n        // Verify partitions are accessible by checking row count\n        try {\n            const countRes = await runQuery(`SELECT COUNT(*) as total FROM ${tableName} LIMIT 1`);\n            const totalRows = countRes.rows[0]?.total || 0;\n            console.log(`üìä Table ${tableName} has ${totalRows.toLocaleString()} total rows`);\n            // Also check partition count\n            const partitionRes = await runQuery(`SELECT COUNT(DISTINCT date) as partition_count FROM ${tableName}`);\n            const partitionCount = partitionRes.rows[0]?.partition_count || 0;\n            console.log(`üìÖ Table ${tableName} has ${partitionCount} partitions loaded`);\n            if (totalRows === 0) {\n                console.warn(`‚ö†Ô∏è  Warning: Table ${tableName} appears empty. Expected ${s3Partitions.length} partitions from S3.`);\n            } else if (partitionCount < s3Partitions.length) {\n                console.warn(`‚ö†Ô∏è  Warning: Only ${partitionCount}/${s3Partitions.length} partitions loaded. Trying manual addition...`);\n                await addPartitionsManually(tableName, datasetName, s3Partitions);\n            }\n        } catch (countError) {\n            console.warn(`Could not verify row count:`, countError);\n        }\n    } catch (error) {\n        // If table exists with different schema, try to repair partitions\n        if (error.message?.includes(\"already exists\")) {\n            console.log(`Table ${tableName} already exists, repairing partitions...`);\n            try {\n                await runQuery(`MSCK REPAIR TABLE ${tableName}`);\n                console.log(`‚úÖ Repaired partitions for ${tableName}`);\n            } catch (repairError) {\n                console.warn(`MSCK REPAIR failed, trying manual partition addition...`);\n                if (s3Partitions.length > 0) {\n                    await addPartitionsManually(tableName, datasetName, s3Partitions);\n                }\n            }\n        } else {\n            throw error;\n        }\n    }\n}\n/**\n * Check if a table exists in Athena\n */ async function tableExists(datasetName) {\n    const tableName = getTableName(datasetName);\n    try {\n        await runQuery(`DESCRIBE ${tableName}`);\n        return true;\n    } catch (error) {\n        // If it's a \"table not found\" error, return false\n        if (error.message?.includes(\"does not exist\") || error.message?.includes(\"Table not found\") || error.message?.includes(\"Table veraset.\") || error.name === \"InvalidRequestException\") {\n            return false;\n        }\n        // For access/permission errors, re-throw with helpful message\n        if (error.message?.includes(\"not authorized\") || error.message?.includes(\"Access denied\") || error.name === \"AccessDeniedException\") {\n            throw error; // Will be caught and handled with better message\n        }\n        // For other errors, re-throw\n        throw error;\n    }\n}\n/**\n * Get table name for a dataset\n * Adds 'ds_' prefix to ensure table name starts with a letter (required by SQL)\n */ function getTableName(datasetName) {\n    const sanitized = datasetName.replace(/-/g, \"_\").replace(/[^a-z0-9_]/gi, \"_\");\n    // SQL table names cannot start with a number, so add prefix if needed\n    return /^[0-9]/.test(sanitized) ? `ds_${sanitized}` : sanitized;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UyxzQkFDeEIzQixNQUFNMEIsT0FBTyxFQUFFQyxTQUFTLHFCQUN4QjNCLE1BQU15QixJQUFJLEtBQUssMkJBQTJCO1lBQzVDLE9BQU87UUFDVDtRQUNBLDhEQUE4RDtRQUM5RCxJQUFJekIsTUFBTTBCLE9BQU8sRUFBRUMsU0FBUyxxQkFDeEIzQixNQUFNMEIsT0FBTyxFQUFFQyxTQUFTLG9CQUN4QjNCLE1BQU15QixJQUFJLEtBQUsseUJBQXlCO1lBQzFDLE1BQU16QixPQUFPLGlEQUFpRDtRQUNoRTtRQUNBLDZCQUE2QjtRQUM3QixNQUFNQTtJQUNSO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxTQUFTOEQsYUFBYWpDLFdBQW1CO0lBQzlDLE1BQU02QyxZQUFZN0MsWUFBWThDLE9BQU8sQ0FBQyxNQUFNLEtBQUtBLE9BQU8sQ0FBQyxnQkFBZ0I7SUFDekUsc0VBQXNFO0lBQ3RFLE9BQU8sU0FBU0MsSUFBSSxDQUFDRixhQUFhLENBQUMsR0FBRyxFQUFFQSxVQUFVLENBQUMsR0FBR0E7QUFDeEQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nbWMtdmVyYXNldC1hcGkvLi9saWIvYXRoZW5hLnRzPzU3YTEiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBV1MgQXRoZW5hIGNsaWVudCBmb3IgcXVlcnlpbmcgUGFycXVldCBmaWxlcyBpbiBTM1xuICovXG5cbmltcG9ydCB7XG4gIEF0aGVuYUNsaWVudCxcbiAgU3RhcnRRdWVyeUV4ZWN1dGlvbkNvbW1hbmQsXG4gIEdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCxcbiAgR2V0UXVlcnlSZXN1bHRzQ29tbWFuZCxcbiAgUXVlcnlFeGVjdXRpb25TdGF0ZSxcbn0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWF0aGVuYSc7XG5pbXBvcnQgeyBTM0NsaWVudCwgTGlzdE9iamVjdHNWMkNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xuXG5jb25zdCBhdGhlbmEgPSBuZXcgQXRoZW5hQ2xpZW50KHtcbiAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIHx8ICd1cy13ZXN0LTInLFxuICBjcmVkZW50aWFsczoge1xuICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCB8fCAnJyxcbiAgICBzZWNyZXRBY2Nlc3NLZXk6IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSB8fCAnJyxcbiAgfSxcbn0pO1xuXG5jb25zdCBEQVRBQkFTRSA9ICd2ZXJhc2V0JztcbmNvbnN0IE9VVFBVVF9MT0NBVElPTiA9IHByb2Nlc3MuZW52LkFUSEVOQV9PVVRQVVRfTE9DQVRJT04gfHwgXG4gIGBzMzovLyR7cHJvY2Vzcy5lbnYuUzNfQlVDS0VUIHx8ICdnYXJyaXR6LXZlcmFzZXQtZGF0YS11cy13ZXN0LTInfS9hdGhlbmEtcmVzdWx0cy9gO1xuY29uc3QgQlVDS0VUID0gcHJvY2Vzcy5lbnYuUzNfQlVDS0VUIHx8ICdnYXJyaXR6LXZlcmFzZXQtZGF0YS11cy13ZXN0LTInO1xuXG5jb25zdCBzM0NsaWVudCA9IG5ldyBTM0NsaWVudCh7XG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtd2VzdC0yJyxcbiAgY3JlZGVudGlhbHM6IHtcbiAgICBhY2Nlc3NLZXlJZDogcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQgfHwgJycsXG4gICAgc2VjcmV0QWNjZXNzS2V5OiBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVkgfHwgJycsXG4gIH0sXG59KTtcblxuZXhwb3J0IGludGVyZmFjZSBRdWVyeVJlc3VsdCB7XG4gIGNvbHVtbnM6IHN0cmluZ1tdO1xuICByb3dzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+W107XG59XG5cbi8qKlxuICogUnVuIGFuIEF0aGVuYSBTUUwgcXVlcnkgYW5kIHJldHVybiByZXN1bHRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW5RdWVyeShzcWw6IHN0cmluZyk6IFByb21pc2U8UXVlcnlSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICAvLyBDaGVjayBpZiBBV1MgY3JlZGVudGlhbHMgYXJlIGNvbmZpZ3VyZWRcbiAgICBpZiAoIXByb2Nlc3MuZW52LkFXU19BQ0NFU1NfS0VZX0lEIHx8ICFwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQVdTIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IEFXU19BQ0NFU1NfS0VZX0lEIGFuZCBBV1NfU0VDUkVUX0FDQ0VTU19LRVkgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IHF1ZXJ5XG4gICAgY29uc3Qgc3RhcnRSZXMgPSBhd2FpdCBhdGhlbmEuc2VuZChuZXcgU3RhcnRRdWVyeUV4ZWN1dGlvbkNvbW1hbmQoe1xuICAgICAgUXVlcnlTdHJpbmc6IHNxbCxcbiAgICAgIFF1ZXJ5RXhlY3V0aW9uQ29udGV4dDogeyBEYXRhYmFzZTogREFUQUJBU0UgfSxcbiAgICAgIFJlc3VsdENvbmZpZ3VyYXRpb246IHsgT3V0cHV0TG9jYXRpb246IE9VVFBVVF9MT0NBVElPTiB9LFxuICAgIH0pKTtcblxuICAgIGNvbnN0IHF1ZXJ5SWQgPSBzdGFydFJlcy5RdWVyeUV4ZWN1dGlvbklkO1xuICAgIGlmICghcXVlcnlJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBxdWVyeSBleGVjdXRpb24gSUQgcmV0dXJuZWQgZnJvbSBBdGhlbmEnKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+agCBTdGFydGVkIEF0aGVuYSBxdWVyeTogJHtxdWVyeUlkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBRdWVyeSBwcmV2aWV3OiAke3NxbC5zdWJzdHJpbmcoMCwgMjAwKX0ke3NxbC5sZW5ndGggPiAyMDAgPyAnLi4uJyA6ICcnfWApO1xuXG4gICAgLy8gUG9sbCBmb3IgY29tcGxldGlvblxuICAgIGxldCBzdGF0ZTogUXVlcnlFeGVjdXRpb25TdGF0ZSA9ICdRVUVVRUQnO1xuICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgY29uc3QgbWF4QXR0ZW1wdHMgPSA2MDA7IC8vIDUgbWludXRlcyBtYXggKDUwMG1zICogNjAwKSAtIEF0aGVuYSBxdWVyaWVzIGNhbiB0YWtlIHRpbWVcbiAgICBjb25zdCBsb2dJbnRlcnZhbCA9IDIwOyAvLyBMb2cgZXZlcnkgMTAgc2Vjb25kc1xuXG4gICAgd2hpbGUgKChzdGF0ZSA9PT0gJ1FVRVVFRCcgfHwgc3RhdGUgPT09ICdSVU5OSU5HJykgJiYgYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDUwMCkpO1xuICAgICAgYXR0ZW1wdHMrKztcblxuICAgICAgY29uc3Qgc3RhdHVzUmVzID0gYXdhaXQgYXRoZW5hLnNlbmQobmV3IEdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCh7XG4gICAgICAgIFF1ZXJ5RXhlY3V0aW9uSWQ6IHF1ZXJ5SWQsXG4gICAgICB9KSk7XG5cbiAgICAgIHN0YXRlID0gc3RhdHVzUmVzLlF1ZXJ5RXhlY3V0aW9uPy5TdGF0dXM/LlN0YXRlIGFzIFF1ZXJ5RXhlY3V0aW9uU3RhdGU7XG4gICAgICBcbiAgICAgIC8vIExvZyBwcm9ncmVzcyBwZXJpb2RpY2FsbHlcbiAgICAgIGlmIChhdHRlbXB0cyAlIGxvZ0ludGVydmFsID09PSAwKSB7XG4gICAgICAgIGNvbnN0IGVsYXBzZWRTZWNvbmRzID0gTWF0aC5mbG9vcihhdHRlbXB0cyAqIDAuNSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICDij7MgUXVlcnkgJHtxdWVyeUlkfTogJHtzdGF0ZX0gKCR7ZWxhcHNlZFNlY29uZHN9cyBlbGFwc2VkKWApO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgc3R1Y2sgaW4gUVVFVUVEIGZvciB0b28gbG9uZywgbG9nIHdhcm5pbmdcbiAgICAgICAgaWYgKHN0YXRlID09PSAnUVVFVUVEJyAmJiBlbGFwc2VkU2Vjb25kcyA+IDMwKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGAgICDimqDvuI8gUXVlcnkgJHtxdWVyeUlkfSBoYXMgYmVlbiBRVUVVRUQgZm9yICR7ZWxhcHNlZFNlY29uZHN9cy4gVGhpcyBtYXkgaW5kaWNhdGUgQXRoZW5hIGlzIG92ZXJsb2FkZWQgb3IgdGhlcmUgYXJlIHBlcm1pc3Npb24gaXNzdWVzLmApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gJ0ZBSUxFRCcpIHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gc3RhdHVzUmVzLlF1ZXJ5RXhlY3V0aW9uPy5TdGF0dXM/LlN0YXRlQ2hhbmdlUmVhc29uIHx8ICdRdWVyeSBmYWlsZWQnO1xuICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IHN0YXR1c1Jlcy5RdWVyeUV4ZWN1dGlvbj8uUXVlcnkgfHwgJyc7XG4gICAgICAgIGNvbnN0IHN0YXRpc3RpY3MgPSBzdGF0dXNSZXMuUXVlcnlFeGVjdXRpb24/LlN0YXRpc3RpY3M7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBBdGhlbmEgcXVlcnkgJHtxdWVyeUlkfSBmYWlsZWQ6YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFF1ZXJ5OiAke3F1ZXJ5U3RyaW5nLnN1YnN0cmluZygwLCA1MDApfSR7cXVlcnlTdHJpbmcubGVuZ3RoID4gNTAwID8gJy4uLicgOiAnJ31gKTtcbiAgICAgICAgaWYgKHN0YXRpc3RpY3MpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGAgICBTdGF0aXN0aWNzOmAsIEpTT04uc3RyaW5naWZ5KHN0YXRpc3RpY3MsIG51bGwsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0aGVuYSBxdWVyeSBmYWlsZWQ6ICR7cmVhc29ufWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RhdGUgPT09ICdDQU5DRUxMRUQnKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBBdGhlbmEgcXVlcnkgJHtxdWVyeUlkfSB3YXMgY2FuY2VsbGVkYCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXRoZW5hIHF1ZXJ5IHdhcyBjYW5jZWxsZWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUgIT09ICdTVUNDRUVERUQnKSB7XG4gICAgICBjb25zdCBlbGFwc2VkU2Vjb25kcyA9IE1hdGguZmxvb3IoYXR0ZW1wdHMgKiAwLjUpO1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSBgUXVlcnkgJHtxdWVyeUlkfSBkaWQgbm90IGNvbXBsZXRlIHdpdGhpbiAke2VsYXBzZWRTZWNvbmRzfXMuIEZpbmFsIHN0YXRlOiAke3N0YXRlfWA7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgJHtlcnJvck1zZ31gKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFF1ZXJ5OiAke3NxbC5zdWJzdHJpbmcoMCwgNTAwKX0ke3NxbC5sZW5ndGggPiA1MDAgPyAnLi4uJyA6ICcnfWApO1xuICAgICAgY29uc29sZS5lcnJvcihgICAgWW91IGNhbiBjaGVjayB0aGUgcXVlcnkgc3RhdHVzIGluIEFXUyBDb25zb2xlOiBodHRwczovL2NvbnNvbGUuYXdzLmFtYXpvbi5jb20vYXRoZW5hL2hvbWU/cmVnaW9uPSR7cHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtd2VzdC0yJ30jcXVlcnktaGlzdG9yeWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg4pyFIEF0aGVuYSBxdWVyeSAke3F1ZXJ5SWR9IGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgKCR7TWF0aC5mbG9vcihhdHRlbXB0cyAqIDAuNSl9cylgKTtcblxuICAgIC8vIEdldCByZXN1bHRzXG4gICAgY29uc3QgcmVzdWx0c1JlcyA9IGF3YWl0IGF0aGVuYS5zZW5kKG5ldyBHZXRRdWVyeVJlc3VsdHNDb21tYW5kKHtcbiAgICAgIFF1ZXJ5RXhlY3V0aW9uSWQ6IHF1ZXJ5SWQsXG4gICAgfSkpO1xuXG4gICAgY29uc3Qgcm93cyA9IHJlc3VsdHNSZXMuUmVzdWx0U2V0Py5Sb3dzIHx8IFtdO1xuICAgIGlmIChyb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHsgY29sdW1uczogW10sIHJvd3M6IFtdIH07XG4gICAgfVxuXG4gICAgLy8gRmlyc3Qgcm93IGlzIGhlYWRlcnNcbiAgICBjb25zdCBjb2x1bW5zID0gcm93c1swXS5EYXRhPy5tYXAoZCA9PiBkLlZhckNoYXJWYWx1ZSB8fCAnJykgfHwgW107XG5cbiAgICAvLyBSZW1haW5pbmcgcm93cyBhcmUgZGF0YVxuICAgIGNvbnN0IGRhdGEgPSByb3dzLnNsaWNlKDEpLm1hcChyb3cgPT4ge1xuICAgICAgY29uc3Qgb2JqOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICByb3cuRGF0YT8uZm9yRWFjaCgoZCwgaSkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGQuVmFyQ2hhclZhbHVlO1xuICAgICAgICBjb25zdCBjb2x1bW5OYW1lID0gY29sdW1uc1tpXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEtlZXAgZGF0ZXMgYXMgc3RyaW5ncyAodGhleSBjb21lIGZvcm1hdHRlZCBmcm9tIEF0aGVuYSlcbiAgICAgICAgaWYgKGNvbHVtbk5hbWUgPT09ICdkYXRlJyAmJiB2YWx1ZSkge1xuICAgICAgICAgIG9ialtjb2x1bW5OYW1lXSA9IHZhbHVlO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgbnVtYmVyc1xuICAgICAgICAgIGNvbnN0IG51bVZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgb2JqW2NvbHVtbk5hbWVdID0gaXNOYU4obnVtVmFsdWUpID8gdmFsdWUgOiBudW1WYWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvYmpbY29sdW1uTmFtZV0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBjb2x1bW5zLCByb3dzOiBkYXRhIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBdGhlbmEgcXVlcnkgZXJyb3I6JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIFByb3ZpZGUgbW9yZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2VzXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbicpIHtcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnRGF0YWJhc2UnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGZvdW5kJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdGhlbmEgZGF0YWJhc2UgJyR7REFUQUJBU0V9JyBub3QgZm91bmQuIFBsZWFzZSBjcmVhdGUgaXQgaW4gQVdTIEdsdWUgZmlyc3QuYCk7XG4gICAgICB9XG4gICAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2RvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUYWJsZSBkb2VzIG5vdCBleGlzdC4gRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdBY2Nlc3NEZW5pZWRFeGNlcHRpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjY2VzcyBkZW5pZWQgdG8gQXRoZW5hLiBQbGVhc2UgY2hlY2sgSUFNIHBlcm1pc3Npb25zLiBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgICBcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIERpc2NvdmVyIHBhcnRpdGlvbnMgZnJvbSBTMyBieSBsaXN0aW5nIG9iamVjdHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGlzY292ZXJQYXJ0aXRpb25zRnJvbVMzKGRhdGFzZXROYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIGNvbnN0IHByZWZpeCA9IGAke2RhdGFzZXROYW1lfS9gO1xuICBjb25zdCBwYXJ0aXRpb25zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGDwn5SNIERpc2NvdmVyaW5nIHBhcnRpdGlvbnMgZm9yICR7ZGF0YXNldE5hbWV9IGZyb20gUzMgcHJlZml4OiAke3ByZWZpeH1gKTtcbiAgICBsZXQgY29udGludWF0aW9uVG9rZW46IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgcGFnZUNvdW50ID0gMDtcbiAgICBcbiAgICBkbyB7XG4gICAgICBwYWdlQ291bnQrKztcbiAgICAgIGNvbnN0IGxpc3RSZXMgPSBhd2FpdCBzM0NsaWVudC5zZW5kKG5ldyBMaXN0T2JqZWN0c1YyQ29tbWFuZCh7XG4gICAgICAgIEJ1Y2tldDogQlVDS0VULFxuICAgICAgICBQcmVmaXg6IHByZWZpeCxcbiAgICAgICAgRGVsaW1pdGVyOiAnLycsXG4gICAgICAgIE1heEtleXM6IDEwMDAsIC8vIEdldCBtb3JlIHJlc3VsdHMgcGVyIHBhZ2VcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBwYXJ0aXRpb24gZGF0ZXMgZnJvbSBjb21tb24gcHJlZml4ZXNcbiAgICAgIGlmIChsaXN0UmVzLkNvbW1vblByZWZpeGVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICBQYWdlICR7cGFnZUNvdW50fTogRm91bmQgJHtsaXN0UmVzLkNvbW1vblByZWZpeGVzLmxlbmd0aH0gY29tbW9uIHByZWZpeGVzYCk7XG4gICAgICAgIGZvciAoY29uc3QgcHJlZml4T2JqIG9mIGxpc3RSZXMuQ29tbW9uUHJlZml4ZXMpIHtcbiAgICAgICAgICBjb25zdCBwcmVmaXhQYXRoID0gcHJlZml4T2JqLlByZWZpeCB8fCAnJztcbiAgICAgICAgICBjb25zdCBtYXRjaCA9IHByZWZpeFBhdGgubWF0Y2goL2RhdGU9KFxcZHs0fS1cXGR7Mn0tXFxkezJ9KS8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgcGFydGl0aW9ucy5hZGQobWF0Y2hbMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBbHNvIGNoZWNrIGluZGl2aWR1YWwgb2JqZWN0cyBmb3IgZGF0ZSBwYXR0ZXJucyAoaW4gY2FzZSBEZWxpbWl0ZXIgZGlkbid0IGNhdGNoIHRoZW0pXG4gICAgICBpZiAobGlzdFJlcy5Db250ZW50cykge1xuICAgICAgICBjb25zb2xlLmxvZyhgICAgUGFnZSAke3BhZ2VDb3VudH06IEZvdW5kICR7bGlzdFJlcy5Db250ZW50cy5sZW5ndGh9IG9iamVjdHNgKTtcbiAgICAgICAgZm9yIChjb25zdCBvYmogb2YgbGlzdFJlcy5Db250ZW50cykge1xuICAgICAgICAgIGNvbnN0IGtleSA9IG9iai5LZXkgfHwgJyc7XG4gICAgICAgICAgY29uc3QgbWF0Y2ggPSBrZXkubWF0Y2goL2RhdGU9KFxcZHs0fS1cXGR7Mn0tXFxkezJ9KS8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgcGFydGl0aW9ucy5hZGQobWF0Y2hbMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb250aW51YXRpb25Ub2tlbiA9IGxpc3RSZXMuTmV4dENvbnRpbnVhdGlvblRva2VuO1xuICAgICAgaWYgKGNvbnRpbnVhdGlvblRva2VuKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICBQYWdlICR7cGFnZUNvdW50fTogTW9yZSByZXN1bHRzIGF2YWlsYWJsZSwgY29udGludWluZy4uLmApO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGNvbnRpbnVhdGlvblRva2VuKTtcbiAgICBcbiAgICBjb25zdCBzb3J0ZWRQYXJ0aXRpb25zID0gQXJyYXkuZnJvbShwYXJ0aXRpb25zKS5zb3J0KCk7XG4gICAgY29uc29sZS5sb2coYOKchSBEaXNjb3ZlcmVkICR7c29ydGVkUGFydGl0aW9ucy5sZW5ndGh9IHBhcnRpdGlvbnM6ICR7c29ydGVkUGFydGl0aW9ucy5zbGljZSgwLCA1KS5qb2luKCcsICcpfSR7c29ydGVkUGFydGl0aW9ucy5sZW5ndGggPiA1ID8gJy4uLicgOiAnJ31gKTtcbiAgICBcbiAgICByZXR1cm4gc29ydGVkUGFydGl0aW9ucztcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBkaXNjb3ZlcmluZyBwYXJ0aXRpb25zIGZyb20gUzM6YCwgZXJyb3IubWVzc2FnZSB8fCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogQWRkIHBhcnRpdGlvbnMgbWFudWFsbHkgdG8gZW5zdXJlIGFsbCBkYXRhIGlzIGFjY2Vzc2libGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWRkUGFydGl0aW9uc01hbnVhbGx5KHRhYmxlTmFtZTogc3RyaW5nLCBkYXRhc2V0TmFtZTogc3RyaW5nLCBwYXJ0aXRpb25zOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICBpZiAocGFydGl0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zb2xlLmxvZyhgTm8gcGFydGl0aW9ucyBmb3VuZCBpbiBTMyBmb3IgJHtkYXRhc2V0TmFtZX1gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKGDwn5OmIEZvdW5kICR7cGFydGl0aW9ucy5sZW5ndGh9IHBhcnRpdGlvbnMgaW4gUzMsIGFkZGluZyB0byB0YWJsZS4uLmApO1xuICBcbiAgLy8gQWRkIHBhcnRpdGlvbnMgaW4gYmF0Y2hlcyAoQXRoZW5hIGhhcyBsaW1pdHMpXG4gIGNvbnN0IGJhdGNoU2l6ZSA9IDUwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRpdGlvbnMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xuICAgIGNvbnN0IGJhdGNoID0gcGFydGl0aW9ucy5zbGljZShpLCBpICsgYmF0Y2hTaXplKTtcbiAgICBjb25zdCBwYXJ0aXRpb25TcGVjcyA9IGJhdGNoLm1hcChkYXRlID0+IFxuICAgICAgYFBBUlRJVElPTiAoZGF0ZT0nJHtkYXRlfScpIExPQ0FUSU9OICdzMzovLyR7QlVDS0VUfS8ke2RhdGFzZXROYW1lfS9kYXRlPSR7ZGF0ZX0vJ2BcbiAgICApLmpvaW4oJywgJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBBTFRFUiBUQUJMRSAke3RhYmxlTmFtZX0gQUREIElGIE5PVCBFWElTVFMgJHtwYXJ0aXRpb25TcGVjc31gKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgQWRkZWQgJHtiYXRjaC5sZW5ndGh9IHBhcnRpdGlvbnMgKCR7aSArIDF9LSR7TWF0aC5taW4oaSArIGJhdGNoLmxlbmd0aCwgcGFydGl0aW9ucy5sZW5ndGgpfS8ke3BhcnRpdGlvbnMubGVuZ3RofSlgKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBJZ25vcmUgXCJwYXJ0aXRpb24gYWxyZWFkeSBleGlzdHNcIiBlcnJvcnNcbiAgICAgIGlmICghZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2FscmVhZHkgZXhpc3RzJykpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nIGFkZGluZyBwYXJ0aXRpb25zIGJhdGNoICR7aSAvIGJhdGNoU2l6ZSArIDF9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBleHRlcm5hbCB0YWJsZSBmb3IgYSBkYXRhc2V0IGluIEF0aGVuYS9HbHVlXG4gKiBFbnN1cmVzIGFsbCBwYXJ0aXRpb25zIGFyZSBsb2FkZWQgc28gYWxsIFBhcnF1ZXQgZmlsZXMgYXJlIGFjY2Vzc2libGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhYmxlRm9yRGF0YXNldChkYXRhc2V0TmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRhYmxlTmFtZSA9IGdldFRhYmxlTmFtZShkYXRhc2V0TmFtZSk7XG5cbiAgLy8gRmlyc3QsIGRpc2NvdmVyIHBhcnRpdGlvbnMgZnJvbSBTM1xuICBjb25zb2xlLmxvZyhg8J+UjSBEaXNjb3ZlcmluZyBwYXJ0aXRpb25zIGZvciAke2RhdGFzZXROYW1lfSBmcm9tIFMzLi4uYCk7XG4gIGNvbnN0IHMzUGFydGl0aW9ucyA9IGF3YWl0IGRpc2NvdmVyUGFydGl0aW9uc0Zyb21TMyhkYXRhc2V0TmFtZSk7XG4gIGNvbnNvbGUubG9nKGDwn5OFIEZvdW5kICR7czNQYXJ0aXRpb25zLmxlbmd0aH0gcGFydGl0aW9ucyBpbiBTMzpgLCBzM1BhcnRpdGlvbnMuc2xpY2UoMCwgMTApLmpvaW4oJywgJyksIHMzUGFydGl0aW9ucy5sZW5ndGggPiAxMCA/ICcuLi4nIDogJycpO1xuXG4gIGNvbnN0IHNxbCA9IGBcbiAgICBDUkVBVEUgRVhURVJOQUwgVEFCTEUgSUYgTk9UIEVYSVNUUyAke3RhYmxlTmFtZX0gKFxuICAgICAgYWRfaWQgU1RSSU5HLFxuICAgICAgdXRjX3RpbWVzdGFtcCBUSU1FU1RBTVAsXG4gICAgICBob3Jpem9udGFsX2FjY3VyYWN5IERPVUJMRSxcbiAgICAgIGlkX3R5cGUgU1RSSU5HLFxuICAgICAgaXBfYWRkcmVzcyBTVFJJTkcsXG4gICAgICBsYXRpdHVkZSBET1VCTEUsXG4gICAgICBsb25naXR1ZGUgRE9VQkxFLFxuICAgICAgaXNvX2NvdW50cnlfY29kZSBTVFJJTkcsXG4gICAgICBwb2lfaWRzIEFSUkFZPFNUUklORz5cbiAgICApXG4gICAgUEFSVElUSU9ORUQgQlkgKGRhdGUgU1RSSU5HKVxuICAgIFNUT1JFRCBBUyBQQVJRVUVUXG4gICAgTE9DQVRJT04gJ3MzOi8vJHtCVUNLRVR9LyR7ZGF0YXNldE5hbWV9LydcbiAgYDtcblxuICB0cnkge1xuICAgIGF3YWl0IHJ1blF1ZXJ5KHNxbCk7XG4gICAgY29uc29sZS5sb2coYOKchSBDcmVhdGVkL3ZlcmlmaWVkIHRhYmxlOiAke3RhYmxlTmFtZX1gKTtcbiAgICBcbiAgICAvLyBUcnkgTVNDSyBSRVBBSVIgZmlyc3QgKGZhc3Rlc3QgaWYgaXQgd29ya3MpXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBNU0NLIFJFUEFJUiBUQUJMRSAke3RhYmxlTmFtZX1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgUmVwYWlyZWQgcGFydGl0aW9ucyB3aXRoIE1TQ0sgUkVQQUlSYCk7XG4gICAgfSBjYXRjaCAocmVwYWlyRXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS53YXJuKGBNU0NLIFJFUEFJUiBmYWlsZWQ6YCwgcmVwYWlyRXJyb3IubWVzc2FnZSk7XG4gICAgICAvLyBGYWxsIGJhY2sgdG8gbWFudWFsIHBhcnRpdGlvbiBhZGRpdGlvblxuICAgICAgaWYgKHMzUGFydGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IGFkZFBhcnRpdGlvbnNNYW51YWxseSh0YWJsZU5hbWUsIGRhdGFzZXROYW1lLCBzM1BhcnRpdGlvbnMpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBWZXJpZnkgcGFydGl0aW9ucyBhcmUgYWNjZXNzaWJsZSBieSBjaGVja2luZyByb3cgY291bnRcbiAgICB0cnkge1xuICAgICAgY29uc3QgY291bnRSZXMgPSBhd2FpdCBydW5RdWVyeShgU0VMRUNUIENPVU5UKCopIGFzIHRvdGFsIEZST00gJHt0YWJsZU5hbWV9IExJTUlUIDFgKTtcbiAgICAgIGNvbnN0IHRvdGFsUm93cyA9IGNvdW50UmVzLnJvd3NbMF0/LnRvdGFsIHx8IDA7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBUYWJsZSAke3RhYmxlTmFtZX0gaGFzICR7dG90YWxSb3dzLnRvTG9jYWxlU3RyaW5nKCl9IHRvdGFsIHJvd3NgKTtcbiAgICAgIFxuICAgICAgLy8gQWxzbyBjaGVjayBwYXJ0aXRpb24gY291bnRcbiAgICAgIGNvbnN0IHBhcnRpdGlvblJlcyA9IGF3YWl0IHJ1blF1ZXJ5KGBTRUxFQ1QgQ09VTlQoRElTVElOQ1QgZGF0ZSkgYXMgcGFydGl0aW9uX2NvdW50IEZST00gJHt0YWJsZU5hbWV9YCk7XG4gICAgICBjb25zdCBwYXJ0aXRpb25Db3VudCA9IHBhcnRpdGlvblJlcy5yb3dzWzBdPy5wYXJ0aXRpb25fY291bnQgfHwgMDtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIFRhYmxlICR7dGFibGVOYW1lfSBoYXMgJHtwYXJ0aXRpb25Db3VudH0gcGFydGl0aW9ucyBsb2FkZWRgKTtcbiAgICAgIFxuICAgICAgaWYgKHRvdGFsUm93cyA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAgV2FybmluZzogVGFibGUgJHt0YWJsZU5hbWV9IGFwcGVhcnMgZW1wdHkuIEV4cGVjdGVkICR7czNQYXJ0aXRpb25zLmxlbmd0aH0gcGFydGl0aW9ucyBmcm9tIFMzLmApO1xuICAgICAgfSBlbHNlIGlmIChwYXJ0aXRpb25Db3VudCA8IHMzUGFydGl0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIFdhcm5pbmc6IE9ubHkgJHtwYXJ0aXRpb25Db3VudH0vJHtzM1BhcnRpdGlvbnMubGVuZ3RofSBwYXJ0aXRpb25zIGxvYWRlZC4gVHJ5aW5nIG1hbnVhbCBhZGRpdGlvbi4uLmApO1xuICAgICAgICBhd2FpdCBhZGRQYXJ0aXRpb25zTWFudWFsbHkodGFibGVOYW1lLCBkYXRhc2V0TmFtZSwgczNQYXJ0aXRpb25zKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChjb3VudEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCB2ZXJpZnkgcm93IGNvdW50OmAsIGNvdW50RXJyb3IpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIC8vIElmIHRhYmxlIGV4aXN0cyB3aXRoIGRpZmZlcmVudCBzY2hlbWEsIHRyeSB0byByZXBhaXIgcGFydGl0aW9uc1xuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnYWxyZWFkeSBleGlzdHMnKSkge1xuICAgICAgY29uc29sZS5sb2coYFRhYmxlICR7dGFibGVOYW1lfSBhbHJlYWR5IGV4aXN0cywgcmVwYWlyaW5nIHBhcnRpdGlvbnMuLi5gKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBNU0NLIFJFUEFJUiBUQUJMRSAke3RhYmxlTmFtZX1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBSZXBhaXJlZCBwYXJ0aXRpb25zIGZvciAke3RhYmxlTmFtZX1gKTtcbiAgICAgIH0gY2F0Y2ggKHJlcGFpckVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgTVNDSyBSRVBBSVIgZmFpbGVkLCB0cnlpbmcgbWFudWFsIHBhcnRpdGlvbiBhZGRpdGlvbi4uLmApO1xuICAgICAgICBpZiAoczNQYXJ0aXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhd2FpdCBhZGRQYXJ0aXRpb25zTWFudWFsbHkodGFibGVOYW1lLCBkYXRhc2V0TmFtZSwgczNQYXJ0aXRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHRhYmxlIGV4aXN0cyBpbiBBdGhlbmFcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRhYmxlRXhpc3RzKGRhdGFzZXROYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgdGFibGVOYW1lID0gZ2V0VGFibGVOYW1lKGRhdGFzZXROYW1lKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBydW5RdWVyeShgREVTQ1JJQkUgJHt0YWJsZU5hbWV9YCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAvLyBJZiBpdCdzIGEgXCJ0YWJsZSBub3QgZm91bmRcIiBlcnJvciwgcmV0dXJuIGZhbHNlXG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdkb2VzIG5vdCBleGlzdCcpIHx8IFxuICAgICAgICBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnVGFibGUgbm90IGZvdW5kJykgfHxcbiAgICAgICAgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1RhYmxlIHZlcmFzZXQuJykgfHxcbiAgICAgICAgZXJyb3IubmFtZSA9PT0gJ0ludmFsaWRSZXF1ZXN0RXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBGb3IgYWNjZXNzL3Blcm1pc3Npb24gZXJyb3JzLCByZS10aHJvdyB3aXRoIGhlbHBmdWwgbWVzc2FnZVxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGF1dGhvcml6ZWQnKSB8fCBcbiAgICAgICAgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ0FjY2VzcyBkZW5pZWQnKSB8fFxuICAgICAgICBlcnJvci5uYW1lID09PSAnQWNjZXNzRGVuaWVkRXhjZXB0aW9uJykge1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFdpbGwgYmUgY2F1Z2h0IGFuZCBoYW5kbGVkIHdpdGggYmV0dGVyIG1lc3NhZ2VcbiAgICB9XG4gICAgLy8gRm9yIG90aGVyIGVycm9ycywgcmUtdGhyb3dcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0YWJsZSBuYW1lIGZvciBhIGRhdGFzZXRcbiAqIEFkZHMgJ2RzXycgcHJlZml4IHRvIGVuc3VyZSB0YWJsZSBuYW1lIHN0YXJ0cyB3aXRoIGEgbGV0dGVyIChyZXF1aXJlZCBieSBTUUwpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRUYWJsZU5hbWUoZGF0YXNldE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHNhbml0aXplZCA9IGRhdGFzZXROYW1lLnJlcGxhY2UoLy0vZywgJ18nKS5yZXBsYWNlKC9bXmEtejAtOV9dL2dpLCAnXycpO1xuICAvLyBTUUwgdGFibGUgbmFtZXMgY2Fubm90IHN0YXJ0IHdpdGggYSBudW1iZXIsIHNvIGFkZCBwcmVmaXggaWYgbmVlZGVkXG4gIHJldHVybiAvXlswLTldLy50ZXN0KHNhbml0aXplZCkgPyBgZHNfJHtzYW5pdGl6ZWR9YCA6IHNhbml0aXplZDtcbn1cbiJdLCJuYW1lcyI6WyJBdGhlbmFDbGllbnQiLCJTdGFydFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCIsIkdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCIsIkdldFF1ZXJ5UmVzdWx0c0NvbW1hbmQiLCJTM0NsaWVudCIsIkxpc3RPYmplY3RzVjJDb21tYW5kIiwiYXRoZW5hIiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJjcmVkZW50aWFscyIsImFjY2Vzc0tleUlkIiwiQVdTX0FDQ0VTU19LRVlfSUQiLCJzZWNyZXRBY2Nlc3NLZXkiLCJBV1NfU0VDUkVUX0FDQ0VTU19LRVkiLCJEQVRBQkFTRSIsIk9VVFBVVF9MT0NBVElPTiIsIkFUSEVOQV9PVVRQVVRfTE9DQVRJT04iLCJTM19CVUNLRVQiLCJCVUNLRVQiLCJzM0NsaWVudCIsInJ1blF1ZXJ5Iiwic3FsIiwiRXJyb3IiLCJzdGFydFJlcyIsInNlbmQiLCJRdWVyeVN0cmluZyIsIlF1ZXJ5RXhlY3V0aW9uQ29udGV4dCIsIkRhdGFiYXNlIiwiUmVzdWx0Q29uZmlndXJhdGlvbiIsIk91dHB1dExvY2F0aW9uIiwicXVlcnlJZCIsIlF1ZXJ5RXhlY3V0aW9uSWQiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwibGVuZ3RoIiwic3RhdGUiLCJhdHRlbXB0cyIsIm1heEF0dGVtcHRzIiwibG9nSW50ZXJ2YWwiLCJQcm9taXNlIiwiciIsInNldFRpbWVvdXQiLCJzdGF0dXNSZXMiLCJRdWVyeUV4ZWN1dGlvbiIsIlN0YXR1cyIsIlN0YXRlIiwiZWxhcHNlZFNlY29uZHMiLCJNYXRoIiwiZmxvb3IiLCJ3YXJuIiwicmVhc29uIiwiU3RhdGVDaGFuZ2VSZWFzb24iLCJxdWVyeVN0cmluZyIsIlF1ZXJ5Iiwic3RhdGlzdGljcyIsIlN0YXRpc3RpY3MiLCJlcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvck1zZyIsInJlc3VsdHNSZXMiLCJyb3dzIiwiUmVzdWx0U2V0IiwiUm93cyIsImNvbHVtbnMiLCJEYXRhIiwibWFwIiwiZCIsIlZhckNoYXJWYWx1ZSIsImRhdGEiLCJzbGljZSIsInJvdyIsIm9iaiIsImZvckVhY2giLCJpIiwidmFsdWUiLCJjb2x1bW5OYW1lIiwidW5kZWZpbmVkIiwibnVtVmFsdWUiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJuYW1lIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiZGlzY292ZXJQYXJ0aXRpb25zRnJvbVMzIiwiZGF0YXNldE5hbWUiLCJwcmVmaXgiLCJwYXJ0aXRpb25zIiwiU2V0IiwiY29udGludWF0aW9uVG9rZW4iLCJwYWdlQ291bnQiLCJsaXN0UmVzIiwiQnVja2V0IiwiUHJlZml4IiwiRGVsaW1pdGVyIiwiTWF4S2V5cyIsIkNvbW1vblByZWZpeGVzIiwicHJlZml4T2JqIiwicHJlZml4UGF0aCIsIm1hdGNoIiwiYWRkIiwiQ29udGVudHMiLCJrZXkiLCJLZXkiLCJOZXh0Q29udGludWF0aW9uVG9rZW4iLCJzb3J0ZWRQYXJ0aXRpb25zIiwiQXJyYXkiLCJmcm9tIiwic29ydCIsImpvaW4iLCJhZGRQYXJ0aXRpb25zTWFudWFsbHkiLCJ0YWJsZU5hbWUiLCJiYXRjaFNpemUiLCJiYXRjaCIsInBhcnRpdGlvblNwZWNzIiwiZGF0ZSIsIm1pbiIsImNyZWF0ZVRhYmxlRm9yRGF0YXNldCIsImdldFRhYmxlTmFtZSIsInMzUGFydGl0aW9ucyIsInJlcGFpckVycm9yIiwiY291bnRSZXMiLCJ0b3RhbFJvd3MiLCJ0b3RhbCIsInRvTG9jYWxlU3RyaW5nIiwicGFydGl0aW9uUmVzIiwicGFydGl0aW9uQ291bnQiLCJwYXJ0aXRpb25fY291bnQiLCJjb3VudEVycm9yIiwidGFibGVFeGlzdHMiLCJzYW5pdGl6ZWQiLCJyZXBsYWNlIiwidGVzdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/athena.ts\n");

/***/ }),

/***/ "(rsc)/./lib/dataset-analyzer.ts":
/*!*********************************!*\
  !*** ./lib/dataset-analyzer.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyzeDataset: () => (/* binding */ analyzeDataset)\n/* harmony export */ });\n/* harmony import */ var _athena__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./athena */ \"(rsc)/./lib/athena.ts\");\n/**\n * Dataset analysis using AWS Athena\n */ \n/**\n * Analyze a dataset with optional filters\n */ async function analyzeDataset(datasetName, filters = {}) {\n    const tableName = (0,_athena__WEBPACK_IMPORTED_MODULE_0__.getTableName)(datasetName);\n    // Check if AWS credentials are configured\n    if (!process.env.AWS_ACCESS_KEY_ID || !process.env.AWS_SECRET_ACCESS_KEY) {\n        throw new Error(\"AWS credentials not configured. Please set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables.\");\n    }\n    // Ensure table exists\n    let tableExistsResult = false;\n    try {\n        tableExistsResult = await (0,_athena__WEBPACK_IMPORTED_MODULE_0__.tableExists)(datasetName);\n    } catch (error) {\n        // If it's an access denied error, provide helpful instructions\n        if (error.message?.includes(\"not authorized\") || error.message?.includes(\"Access denied\") || error.name === \"AccessDeniedException\") {\n            throw new Error(`Athena access denied. Please add the following IAM permissions to your AWS user:\\n\\n` + `1. Athena: StartQueryExecution, GetQueryExecution, GetQueryResults\\n` + `2. Glue: GetDatabase, CreateTable, GetTable, BatchCreatePartition\\n` + `3. S3: GetObject, PutObject, ListBucket (on garritz-veraset-data-us-west-2)\\n\\n` + `See ATHENA_SETUP.md for detailed instructions.\\n\\n` + `Original error: ${error.message}`);\n        }\n        throw error;\n    }\n    if (!tableExistsResult) {\n        console.log(`Creating table for dataset: ${datasetName}`);\n        try {\n            await (0,_athena__WEBPACK_IMPORTED_MODULE_0__.createTableForDataset)(datasetName);\n        } catch (error) {\n            if (error.message?.includes(\"not authorized\") || error.message?.includes(\"Access denied\")) {\n                throw new Error(`Cannot create Athena table: Access denied. Please ensure your IAM user has Glue CreateTable permissions.\\n\\n` + `See ATHENA_SETUP.md for setup instructions.\\n\\n` + `Original error: ${error.message}`);\n            }\n            throw error;\n        }\n    }\n    // Build WHERE clause - use DATE(utc_timestamp) to filter by actual data dates\n    const conditions = [];\n    if (filters.dateFrom) {\n        conditions.push(`DATE(utc_timestamp) >= DATE '${filters.dateFrom}'`);\n    }\n    if (filters.dateTo) {\n        conditions.push(`DATE(utc_timestamp) <= DATE '${filters.dateTo}'`);\n    }\n    if (filters.poiIds?.length) {\n        const poiList = filters.poiIds.map((p)=>{\n            const escaped = p.replace(/'/g, \"''\");\n            return `'${escaped}'`;\n        }).join(\",\");\n        conditions.push(`poi_ids[1] IN (${poiList})`);\n    }\n    const whereClause = conditions.length ? `WHERE ${conditions.join(\" AND \")}` : \"\";\n    // Ensure WHERE clause is properly formatted (no double WHERE)\n    const whereClauseSafe = whereClause;\n    // First, verify we're reading all partitions\n    console.log(`üîç Analyzing dataset: ${datasetName} (table: ${tableName})`);\n    // Check partition count and sample data - this helps verify all partitions are loaded\n    // Note: Querying partition column directly can sometimes cause issues in Athena\n    // We'll skip this check if it fails and continue with the analysis\n    try {\n        const partitionCheck = await (0,_athena__WEBPACK_IMPORTED_MODULE_0__.runQuery)(`\n      SELECT \n        date as partition_date, \n        COUNT(*) as row_count, \n        COUNT(DISTINCT ad_id) as unique_devices\n      FROM ${tableName}\n      GROUP BY date\n      ORDER BY date\n      LIMIT 20\n    `);\n        console.log(`üìÖ Found partitions in table (showing first 20):`);\n        partitionCheck.rows.forEach((r)=>{\n            console.log(`   - ${r.partition_date}: ${parseInt(String(r.row_count)).toLocaleString()} rows, ${parseInt(String(r.unique_devices)).toLocaleString()} unique devices`);\n        });\n    } catch (err) {\n        console.warn(\"Could not check partitions (this is OK, continuing with analysis):\", err.message || err);\n    // Don't throw - this is just for logging, analysis can continue\n    }\n    // Run queries in parallel (with error handling per query)\n    let summaryRes, deviceTypesRes, dailyRes, dwellRes, topPoisRes;\n    console.log(`üìä Running 5 analysis queries in parallel for ${datasetName}...`);\n    // Helper to wrap queries with error handling and logging\n    const runQueryWithName = async (name, sql)=>{\n        try {\n            console.log(`   üîÑ Starting query: ${name}`);\n            const result = await (0,_athena__WEBPACK_IMPORTED_MODULE_0__.runQuery)(sql);\n            console.log(`   ‚úÖ Completed query: ${name} (${result.rows.length} rows)`);\n            return result;\n        } catch (error) {\n            console.error(`   ‚ùå Failed query: ${name}`);\n            console.error(`   Error: ${error.message}`);\n            throw new Error(`${name} query failed: ${error.message}`);\n        }\n    };\n    try {\n        [summaryRes, deviceTypesRes, dailyRes, dwellRes, topPoisRes] = await Promise.all([\n            // Summary stats - use DATE(utc_timestamp) to ensure all parquet files are integrated\n            // Also count from both partition date and utc_timestamp to verify consistency\n            runQueryWithName(\"Summary\", `\n      SELECT \n        COUNT(*) as total_pings,\n        COUNT(DISTINCT ad_id) as unique_devices,\n        COUNT(DISTINCT poi_ids[1]) as unique_pois,\n        MIN(DATE(utc_timestamp)) as min_date,\n        MAX(DATE(utc_timestamp)) as max_date,\n        COUNT(DISTINCT DATE(utc_timestamp)) as days_analyzed,\n        COUNT(DISTINCT date) as partition_count\n      FROM ${tableName}\n      ${whereClause}\n    `),\n            // Device types\n            runQueryWithName(\"Device Types\", `\n      SELECT id_type, COUNT(DISTINCT ad_id) as count\n      FROM ${tableName}\n      ${whereClause}\n      GROUP BY id_type\n    `),\n            // Daily activity - extract date from utc_timestamp and aggregate ALL parquet files by day\n            // This ensures all data across all partitions is summed per day\n            runQueryWithName(\"Daily Activity\", `\n      SELECT \n        date_format(DATE(utc_timestamp), '%Y-%m-%d') as date,\n        COUNT(*) as pings,\n        COUNT(DISTINCT ad_id) as devices\n      FROM ${tableName}\n      ${whereClause ? whereClause + \" AND utc_timestamp IS NOT NULL\" : \"WHERE utc_timestamp IS NOT NULL\"}\n      GROUP BY DATE(utc_timestamp)\n      ORDER BY DATE(utc_timestamp) ASC\n    `),\n            // Dwell distribution - use date_diff with correct Presto/Athena syntax\n            runQueryWithName(\"Dwell Distribution\", `\n      WITH device_dwell AS (\n        SELECT \n          ad_id,\n          poi_ids[1] as poi_id,\n          date_diff('second', MIN(utc_timestamp), MAX(utc_timestamp)) as dwell_seconds\n        FROM ${tableName}\n        ${whereClause ? whereClause + \" AND poi_ids[1] IS NOT NULL\" : \"WHERE poi_ids[1] IS NOT NULL\"}\n        GROUP BY ad_id, poi_ids[1]\n        HAVING MAX(utc_timestamp) > MIN(utc_timestamp)\n      ),\n      dwell_ranges AS (\n        SELECT\n          CASE\n            WHEN dwell_seconds < 30 THEN '0-30s'\n            WHEN dwell_seconds < 60 THEN '30s-1m'\n            WHEN dwell_seconds < 300 THEN '1-5m'\n            WHEN dwell_seconds < 900 THEN '5-15m'\n            WHEN dwell_seconds < 3600 THEN '15-60m'\n            ELSE '60m+'\n          END as dwell_range\n        FROM device_dwell\n      )\n      SELECT\n        dwell_range,\n        COUNT(*) as count\n      FROM dwell_ranges\n      GROUP BY dwell_range\n      ORDER BY \n        CASE dwell_range\n          WHEN '0-30s' THEN 1\n          WHEN '30s-1m' THEN 2\n          WHEN '1-5m' THEN 3\n          WHEN '5-15m' THEN 4\n          WHEN '15-60m' THEN 5\n          WHEN '60m+' THEN 6\n          ELSE 7\n        END\n    `),\n            // Top POIs\n            runQueryWithName(\"Top POIs\", `\n      SELECT \n        poi_ids[1] as poi_id,\n        COUNT(*) as pings,\n        COUNT(DISTINCT ad_id) as devices\n      FROM ${tableName}\n      ${whereClause ? whereClause + \" AND poi_ids[1] IS NOT NULL\" : \"WHERE poi_ids[1] IS NOT NULL\"}\n      GROUP BY poi_ids[1]\n      ORDER BY COUNT(DISTINCT ad_id) DESC\n      LIMIT 20\n    `)\n        ]);\n    } catch (error) {\n        console.error(\"‚ùå Error running analysis queries:\", error);\n        console.error(\"Error message:\", error.message);\n        console.error(\"Error stack:\", error.stack);\n        // Re-throw with more context\n        throw new Error(`Analysis query failed: ${error.message || \"Unknown error\"}`);\n    }\n    // Parse results\n    const summary = summaryRes.rows[0] || {};\n    // Log summary for debugging\n    console.log(`üìä Analysis summary for ${datasetName}:`);\n    console.log(`   Total pings: ${parseInt(String(summary.total_pings)).toLocaleString()}`);\n    console.log(`   Unique devices: ${parseInt(String(summary.unique_devices)).toLocaleString()}`);\n    console.log(`   Unique POIs: ${parseInt(String(summary.unique_pois)).toLocaleString()}`);\n    console.log(`   Date range: ${summary.min_date} to ${summary.max_date}`);\n    console.log(`   Days analyzed: ${summary.days_analyzed}`);\n    console.log(`   Partitions found: ${summary.partition_count || \"N/A\"}`);\n    const deviceTypes = {};\n    deviceTypesRes.rows.forEach((r)=>{\n        if (r.id_type) {\n            deviceTypes[r.id_type] = parseInt(String(r.count)) || 0;\n        }\n    });\n    console.log(`üì± Device types:`, deviceTypes);\n    console.log(`üìÖ Daily activity records: ${dailyRes.rows.length}`);\n    // Process daily activity - ensure dates are properly formatted\n    const dailyActivity = dailyRes.rows.map((r)=>{\n        // Get date string from Athena result\n        let dateStr = String(r.date || \"\").trim();\n        // Normalize date format to YYYY-MM-DD\n        if (!dateStr) {\n            return null;\n        }\n        // Handle different formats from Athena\n        if (dateStr.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n            // Already in YYYY-MM-DD format - perfect!\n            dateStr = dateStr;\n        } else if (dateStr.includes(\"T\")) {\n            // ISO format: \"2026-01-05T00:00:00.000Z\" -> \"2026-01-05\"\n            dateStr = dateStr.split(\"T\")[0];\n        } else {\n            // Try to parse and reformat\n            try {\n                const date = new Date(dateStr);\n                if (!isNaN(date.getTime())) {\n                    const year = date.getFullYear();\n                    const month = String(date.getMonth() + 1).padStart(2, \"0\");\n                    const day = String(date.getDate()).padStart(2, \"0\");\n                    dateStr = `${year}-${month}-${day}`;\n                } else {\n                    console.warn(`Invalid date format: ${dateStr}`);\n                    return null;\n                }\n            } catch (e) {\n                console.warn(`Error parsing date: ${dateStr}`, e);\n                return null;\n            }\n        }\n        return {\n            date: dateStr,\n            pings: parseInt(String(r.pings)) || 0,\n            devices: parseInt(String(r.devices)) || 0\n        };\n    }).filter((item)=>item !== null).sort((a, b)=>a.date.localeCompare(b.date)); // Ensure sorted by date\n    const dwellDistribution = {\n        \"0-30s\": 0,\n        \"30s-1m\": 0,\n        \"1-5m\": 0,\n        \"5-15m\": 0,\n        \"15-60m\": 0,\n        \"60m+\": 0\n    };\n    dwellRes.rows.forEach((r)=>{\n        if (r.dwell_range) {\n            dwellDistribution[r.dwell_range] = parseInt(String(r.count)) || 0;\n        }\n    });\n    const topPois = topPoisRes.rows.map((r)=>({\n            poiId: String(r.poi_id || \"\"),\n            pings: parseInt(String(r.pings)) || 0,\n            devices: parseInt(String(r.devices)) || 0\n        }));\n    return {\n        dataset: datasetName,\n        analyzedAt: new Date().toISOString(),\n        filters,\n        summary: {\n            totalPings: parseInt(String(summary.total_pings)) || 0,\n            uniqueDevices: parseInt(String(summary.unique_devices)) || 0,\n            uniquePois: parseInt(String(summary.unique_pois)) || 0,\n            dateRange: {\n                from: String(summary.min_date || \"\"),\n                to: String(summary.max_date || \"\")\n            },\n            daysAnalyzed: parseInt(String(summary.days_analyzed)) || 0\n        },\n        deviceTypes,\n        dailyActivity,\n        dwellDistribution,\n        topPois\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUUsV0FBVyxNQUFNO1lBQ3JENEMsV0FBVztnQkFDVEMsTUFBTWhFLE9BQU9pQixRQUFRRyxRQUFRLElBQUk7Z0JBQ2pDNkMsSUFBSWpFLE9BQU9pQixRQUFRSSxRQUFRLElBQUk7WUFDakM7WUFDQTZDLGNBQWNuRSxTQUFTQyxPQUFPaUIsUUFBUUssYUFBYSxNQUFNO1FBQzNEO1FBQ0FFO1FBQ0FHO1FBQ0F5QjtRQUNBRTtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nbWMtdmVyYXNldC1hcGkvLi9saWIvZGF0YXNldC1hbmFseXplci50cz8yMjE5Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGF0YXNldCBhbmFseXNpcyB1c2luZyBBV1MgQXRoZW5hXG4gKi9cblxuaW1wb3J0IHsgcnVuUXVlcnksIGNyZWF0ZVRhYmxlRm9yRGF0YXNldCwgdGFibGVFeGlzdHMsIGdldFRhYmxlTmFtZSB9IGZyb20gJy4vYXRoZW5hJztcblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc0ZpbHRlcnMge1xuICBkYXRlRnJvbT86IHN0cmluZztcbiAgZGF0ZVRvPzogc3RyaW5nO1xuICBwb2lJZHM/OiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc1Jlc3VsdCB7XG4gIGRhdGFzZXQ6IHN0cmluZztcbiAgYW5hbHl6ZWRBdDogc3RyaW5nO1xuICBmaWx0ZXJzOiBBbmFseXNpc0ZpbHRlcnM7XG4gIHN1bW1hcnk6IHtcbiAgICB0b3RhbFBpbmdzOiBudW1iZXI7XG4gICAgdW5pcXVlRGV2aWNlczogbnVtYmVyO1xuICAgIHVuaXF1ZVBvaXM6IG51bWJlcjtcbiAgICBkYXRlUmFuZ2U6IHsgZnJvbTogc3RyaW5nOyB0bzogc3RyaW5nIH07XG4gICAgZGF5c0FuYWx5emVkOiBudW1iZXI7XG4gIH07XG4gIGRldmljZVR5cGVzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICBkYWlseUFjdGl2aXR5OiBBcnJheTx7IGRhdGU6IHN0cmluZzsgcGluZ3M6IG51bWJlcjsgZGV2aWNlczogbnVtYmVyIH0+O1xuICBkd2VsbERpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgdG9wUG9pczogQXJyYXk8eyBwb2lJZDogc3RyaW5nOyBwaW5nczogbnVtYmVyOyBkZXZpY2VzOiBudW1iZXIgfT47XG59XG5cbi8qKlxuICogQW5hbHl6ZSBhIGRhdGFzZXQgd2l0aCBvcHRpb25hbCBmaWx0ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhbmFseXplRGF0YXNldChcbiAgZGF0YXNldE5hbWU6IHN0cmluZyxcbiAgZmlsdGVyczogQW5hbHlzaXNGaWx0ZXJzID0ge31cbik6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgY29uc3QgdGFibGVOYW1lID0gZ2V0VGFibGVOYW1lKGRhdGFzZXROYW1lKTtcblxuICAvLyBDaGVjayBpZiBBV1MgY3JlZGVudGlhbHMgYXJlIGNvbmZpZ3VyZWRcbiAgaWYgKCFwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCB8fCAhcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ0FXUyBjcmVkZW50aWFscyBub3QgY29uZmlndXJlZC4gUGxlYXNlIHNldCBBV1NfQUNDRVNTX0tFWV9JRCBhbmQgQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZIGVudmlyb25tZW50IHZhcmlhYmxlcy4nXG4gICAgKTtcbiAgfVxuXG4gIC8vIEVuc3VyZSB0YWJsZSBleGlzdHNcbiAgbGV0IHRhYmxlRXhpc3RzUmVzdWx0ID0gZmFsc2U7XG4gIHRyeSB7XG4gICAgdGFibGVFeGlzdHNSZXN1bHQgPSBhd2FpdCB0YWJsZUV4aXN0cyhkYXRhc2V0TmFtZSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAvLyBJZiBpdCdzIGFuIGFjY2VzcyBkZW5pZWQgZXJyb3IsIHByb3ZpZGUgaGVscGZ1bCBpbnN0cnVjdGlvbnNcbiAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ25vdCBhdXRob3JpemVkJykgfHwgXG4gICAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdBY2Nlc3MgZGVuaWVkJykgfHxcbiAgICAgICAgZXJyb3IubmFtZSA9PT0gJ0FjY2Vzc0RlbmllZEV4Y2VwdGlvbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEF0aGVuYSBhY2Nlc3MgZGVuaWVkLiBQbGVhc2UgYWRkIHRoZSBmb2xsb3dpbmcgSUFNIHBlcm1pc3Npb25zIHRvIHlvdXIgQVdTIHVzZXI6XFxuXFxuYCArXG4gICAgICAgIGAxLiBBdGhlbmE6IFN0YXJ0UXVlcnlFeGVjdXRpb24sIEdldFF1ZXJ5RXhlY3V0aW9uLCBHZXRRdWVyeVJlc3VsdHNcXG5gICtcbiAgICAgICAgYDIuIEdsdWU6IEdldERhdGFiYXNlLCBDcmVhdGVUYWJsZSwgR2V0VGFibGUsIEJhdGNoQ3JlYXRlUGFydGl0aW9uXFxuYCArXG4gICAgICAgIGAzLiBTMzogR2V0T2JqZWN0LCBQdXRPYmplY3QsIExpc3RCdWNrZXQgKG9uIGdhcnJpdHotdmVyYXNldC1kYXRhLXVzLXdlc3QtMilcXG5cXG5gICtcbiAgICAgICAgYFNlZSBBVEhFTkFfU0VUVVAubWQgZm9yIGRldGFpbGVkIGluc3RydWN0aW9ucy5cXG5cXG5gICtcbiAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YFxuICAgICAgKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cblxuICBpZiAoIXRhYmxlRXhpc3RzUmVzdWx0KSB7XG4gICAgY29uc29sZS5sb2coYENyZWF0aW5nIHRhYmxlIGZvciBkYXRhc2V0OiAke2RhdGFzZXROYW1lfWApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBjcmVhdGVUYWJsZUZvckRhdGFzZXQoZGF0YXNldE5hbWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGF1dGhvcml6ZWQnKSB8fCBcbiAgICAgICAgICBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnQWNjZXNzIGRlbmllZCcpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgQ2Fubm90IGNyZWF0ZSBBdGhlbmEgdGFibGU6IEFjY2VzcyBkZW5pZWQuIFBsZWFzZSBlbnN1cmUgeW91ciBJQU0gdXNlciBoYXMgR2x1ZSBDcmVhdGVUYWJsZSBwZXJtaXNzaW9ucy5cXG5cXG5gICtcbiAgICAgICAgICBgU2VlIEFUSEVOQV9TRVRVUC5tZCBmb3Igc2V0dXAgaW5zdHJ1Y3Rpb25zLlxcblxcbmAgK1xuICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8vIEJ1aWxkIFdIRVJFIGNsYXVzZSAtIHVzZSBEQVRFKHV0Y190aW1lc3RhbXApIHRvIGZpbHRlciBieSBhY3R1YWwgZGF0YSBkYXRlc1xuICBjb25zdCBjb25kaXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICBpZiAoZmlsdGVycy5kYXRlRnJvbSkge1xuICAgIGNvbmRpdGlvbnMucHVzaChgREFURSh1dGNfdGltZXN0YW1wKSA+PSBEQVRFICcke2ZpbHRlcnMuZGF0ZUZyb219J2ApO1xuICB9XG4gIGlmIChmaWx0ZXJzLmRhdGVUbykge1xuICAgIGNvbmRpdGlvbnMucHVzaChgREFURSh1dGNfdGltZXN0YW1wKSA8PSBEQVRFICcke2ZpbHRlcnMuZGF0ZVRvfSdgKTtcbiAgfVxuICBpZiAoZmlsdGVycy5wb2lJZHM/Lmxlbmd0aCkge1xuICAgIGNvbnN0IHBvaUxpc3QgPSBmaWx0ZXJzLnBvaUlkcy5tYXAocCA9PiB7XG4gICAgICBjb25zdCBlc2NhcGVkID0gcC5yZXBsYWNlKC8nL2csIFwiJydcIik7XG4gICAgICByZXR1cm4gYCcke2VzY2FwZWR9J2A7XG4gICAgfSkuam9pbignLCcpO1xuICAgIGNvbmRpdGlvbnMucHVzaChgcG9pX2lkc1sxXSBJTiAoJHtwb2lMaXN0fSlgKTtcbiAgfVxuICBjb25zdCB3aGVyZUNsYXVzZSA9IGNvbmRpdGlvbnMubGVuZ3RoID8gYFdIRVJFICR7Y29uZGl0aW9ucy5qb2luKCcgQU5EICcpfWAgOiAnJztcbiAgXG4gIC8vIEVuc3VyZSBXSEVSRSBjbGF1c2UgaXMgcHJvcGVybHkgZm9ybWF0dGVkIChubyBkb3VibGUgV0hFUkUpXG4gIGNvbnN0IHdoZXJlQ2xhdXNlU2FmZSA9IHdoZXJlQ2xhdXNlO1xuXG4gIC8vIEZpcnN0LCB2ZXJpZnkgd2UncmUgcmVhZGluZyBhbGwgcGFydGl0aW9uc1xuICBjb25zb2xlLmxvZyhg8J+UjSBBbmFseXppbmcgZGF0YXNldDogJHtkYXRhc2V0TmFtZX0gKHRhYmxlOiAke3RhYmxlTmFtZX0pYCk7XG4gIFxuICAvLyBDaGVjayBwYXJ0aXRpb24gY291bnQgYW5kIHNhbXBsZSBkYXRhIC0gdGhpcyBoZWxwcyB2ZXJpZnkgYWxsIHBhcnRpdGlvbnMgYXJlIGxvYWRlZFxuICAvLyBOb3RlOiBRdWVyeWluZyBwYXJ0aXRpb24gY29sdW1uIGRpcmVjdGx5IGNhbiBzb21ldGltZXMgY2F1c2UgaXNzdWVzIGluIEF0aGVuYVxuICAvLyBXZSdsbCBza2lwIHRoaXMgY2hlY2sgaWYgaXQgZmFpbHMgYW5kIGNvbnRpbnVlIHdpdGggdGhlIGFuYWx5c2lzXG4gIHRyeSB7XG4gICAgY29uc3QgcGFydGl0aW9uQ2hlY2sgPSBhd2FpdCBydW5RdWVyeShgXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIGRhdGUgYXMgcGFydGl0aW9uX2RhdGUsIFxuICAgICAgICBDT1VOVCgqKSBhcyByb3dfY291bnQsIFxuICAgICAgICBDT1VOVChESVNUSU5DVCBhZF9pZCkgYXMgdW5pcXVlX2RldmljZXNcbiAgICAgIEZST00gJHt0YWJsZU5hbWV9XG4gICAgICBHUk9VUCBCWSBkYXRlXG4gICAgICBPUkRFUiBCWSBkYXRlXG4gICAgICBMSU1JVCAyMFxuICAgIGApO1xuICAgIGNvbnNvbGUubG9nKGDwn5OFIEZvdW5kIHBhcnRpdGlvbnMgaW4gdGFibGUgKHNob3dpbmcgZmlyc3QgMjApOmApO1xuICAgIHBhcnRpdGlvbkNoZWNrLnJvd3MuZm9yRWFjaCgocjogYW55KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhgICAgLSAke3IucGFydGl0aW9uX2RhdGV9OiAke3BhcnNlSW50KFN0cmluZyhyLnJvd19jb3VudCkpLnRvTG9jYWxlU3RyaW5nKCl9IHJvd3MsICR7cGFyc2VJbnQoU3RyaW5nKHIudW5pcXVlX2RldmljZXMpKS50b0xvY2FsZVN0cmluZygpfSB1bmlxdWUgZGV2aWNlc2ApO1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGNoZWNrIHBhcnRpdGlvbnMgKHRoaXMgaXMgT0ssIGNvbnRpbnVpbmcgd2l0aCBhbmFseXNpcyk6JywgZXJyLm1lc3NhZ2UgfHwgZXJyKTtcbiAgICAvLyBEb24ndCB0aHJvdyAtIHRoaXMgaXMganVzdCBmb3IgbG9nZ2luZywgYW5hbHlzaXMgY2FuIGNvbnRpbnVlXG4gIH1cblxuICAvLyBSdW4gcXVlcmllcyBpbiBwYXJhbGxlbCAod2l0aCBlcnJvciBoYW5kbGluZyBwZXIgcXVlcnkpXG4gIGxldCBzdW1tYXJ5UmVzLCBkZXZpY2VUeXBlc1JlcywgZGFpbHlSZXMsIGR3ZWxsUmVzLCB0b3BQb2lzUmVzO1xuICBcbiAgY29uc29sZS5sb2coYPCfk4ogUnVubmluZyA1IGFuYWx5c2lzIHF1ZXJpZXMgaW4gcGFyYWxsZWwgZm9yICR7ZGF0YXNldE5hbWV9Li4uYCk7XG4gIFxuICAvLyBIZWxwZXIgdG8gd3JhcCBxdWVyaWVzIHdpdGggZXJyb3IgaGFuZGxpbmcgYW5kIGxvZ2dpbmdcbiAgY29uc3QgcnVuUXVlcnlXaXRoTmFtZSA9IGFzeW5jIChuYW1lOiBzdHJpbmcsIHNxbDogc3RyaW5nKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKGAgICDwn5SEIFN0YXJ0aW5nIHF1ZXJ5OiAke25hbWV9YCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBydW5RdWVyeShzcWwpO1xuICAgICAgY29uc29sZS5sb2coYCAgIOKchSBDb21wbGV0ZWQgcXVlcnk6ICR7bmFtZX0gKCR7cmVzdWx0LnJvd3MubGVuZ3RofSByb3dzKWApO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKGAgICDinYwgRmFpbGVkIHF1ZXJ5OiAke25hbWV9YCk7XG4gICAgICBjb25zb2xlLmVycm9yKGAgICBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke25hbWV9IHF1ZXJ5IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfTtcbiAgXG4gIHRyeSB7XG4gICAgW3N1bW1hcnlSZXMsIGRldmljZVR5cGVzUmVzLCBkYWlseVJlcywgZHdlbGxSZXMsIHRvcFBvaXNSZXNdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgIC8vIFN1bW1hcnkgc3RhdHMgLSB1c2UgREFURSh1dGNfdGltZXN0YW1wKSB0byBlbnN1cmUgYWxsIHBhcnF1ZXQgZmlsZXMgYXJlIGludGVncmF0ZWRcbiAgICAvLyBBbHNvIGNvdW50IGZyb20gYm90aCBwYXJ0aXRpb24gZGF0ZSBhbmQgdXRjX3RpbWVzdGFtcCB0byB2ZXJpZnkgY29uc2lzdGVuY3lcbiAgICBydW5RdWVyeVdpdGhOYW1lKCdTdW1tYXJ5JywgYFxuICAgICAgU0VMRUNUIFxuICAgICAgICBDT1VOVCgqKSBhcyB0b3RhbF9waW5ncyxcbiAgICAgICAgQ09VTlQoRElTVElOQ1QgYWRfaWQpIGFzIHVuaXF1ZV9kZXZpY2VzLFxuICAgICAgICBDT1VOVChESVNUSU5DVCBwb2lfaWRzWzFdKSBhcyB1bmlxdWVfcG9pcyxcbiAgICAgICAgTUlOKERBVEUodXRjX3RpbWVzdGFtcCkpIGFzIG1pbl9kYXRlLFxuICAgICAgICBNQVgoREFURSh1dGNfdGltZXN0YW1wKSkgYXMgbWF4X2RhdGUsXG4gICAgICAgIENPVU5UKERJU1RJTkNUIERBVEUodXRjX3RpbWVzdGFtcCkpIGFzIGRheXNfYW5hbHl6ZWQsXG4gICAgICAgIENPVU5UKERJU1RJTkNUIGRhdGUpIGFzIHBhcnRpdGlvbl9jb3VudFxuICAgICAgRlJPTSAke3RhYmxlTmFtZX1cbiAgICAgICR7d2hlcmVDbGF1c2V9XG4gICAgYCksXG5cbiAgICAvLyBEZXZpY2UgdHlwZXNcbiAgICBydW5RdWVyeVdpdGhOYW1lKCdEZXZpY2UgVHlwZXMnLCBgXG4gICAgICBTRUxFQ1QgaWRfdHlwZSwgQ09VTlQoRElTVElOQ1QgYWRfaWQpIGFzIGNvdW50XG4gICAgICBGUk9NICR7dGFibGVOYW1lfVxuICAgICAgJHt3aGVyZUNsYXVzZX1cbiAgICAgIEdST1VQIEJZIGlkX3R5cGVcbiAgICBgKSxcblxuICAgIC8vIERhaWx5IGFjdGl2aXR5IC0gZXh0cmFjdCBkYXRlIGZyb20gdXRjX3RpbWVzdGFtcCBhbmQgYWdncmVnYXRlIEFMTCBwYXJxdWV0IGZpbGVzIGJ5IGRheVxuICAgIC8vIFRoaXMgZW5zdXJlcyBhbGwgZGF0YSBhY3Jvc3MgYWxsIHBhcnRpdGlvbnMgaXMgc3VtbWVkIHBlciBkYXlcbiAgICBydW5RdWVyeVdpdGhOYW1lKCdEYWlseSBBY3Rpdml0eScsIGBcbiAgICAgIFNFTEVDVCBcbiAgICAgICAgZGF0ZV9mb3JtYXQoREFURSh1dGNfdGltZXN0YW1wKSwgJyVZLSVtLSVkJykgYXMgZGF0ZSxcbiAgICAgICAgQ09VTlQoKikgYXMgcGluZ3MsXG4gICAgICAgIENPVU5UKERJU1RJTkNUIGFkX2lkKSBhcyBkZXZpY2VzXG4gICAgICBGUk9NICR7dGFibGVOYW1lfVxuICAgICAgJHt3aGVyZUNsYXVzZSA/IHdoZXJlQ2xhdXNlICsgJyBBTkQgdXRjX3RpbWVzdGFtcCBJUyBOT1QgTlVMTCcgOiAnV0hFUkUgdXRjX3RpbWVzdGFtcCBJUyBOT1QgTlVMTCd9XG4gICAgICBHUk9VUCBCWSBEQVRFKHV0Y190aW1lc3RhbXApXG4gICAgICBPUkRFUiBCWSBEQVRFKHV0Y190aW1lc3RhbXApIEFTQ1xuICAgIGApLFxuXG4gICAgLy8gRHdlbGwgZGlzdHJpYnV0aW9uIC0gdXNlIGRhdGVfZGlmZiB3aXRoIGNvcnJlY3QgUHJlc3RvL0F0aGVuYSBzeW50YXhcbiAgICBydW5RdWVyeVdpdGhOYW1lKCdEd2VsbCBEaXN0cmlidXRpb24nLCBgXG4gICAgICBXSVRIIGRldmljZV9kd2VsbCBBUyAoXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICBhZF9pZCxcbiAgICAgICAgICBwb2lfaWRzWzFdIGFzIHBvaV9pZCxcbiAgICAgICAgICBkYXRlX2RpZmYoJ3NlY29uZCcsIE1JTih1dGNfdGltZXN0YW1wKSwgTUFYKHV0Y190aW1lc3RhbXApKSBhcyBkd2VsbF9zZWNvbmRzXG4gICAgICAgIEZST00gJHt0YWJsZU5hbWV9XG4gICAgICAgICR7d2hlcmVDbGF1c2UgPyB3aGVyZUNsYXVzZSArICcgQU5EIHBvaV9pZHNbMV0gSVMgTk9UIE5VTEwnIDogJ1dIRVJFIHBvaV9pZHNbMV0gSVMgTk9UIE5VTEwnfVxuICAgICAgICBHUk9VUCBCWSBhZF9pZCwgcG9pX2lkc1sxXVxuICAgICAgICBIQVZJTkcgTUFYKHV0Y190aW1lc3RhbXApID4gTUlOKHV0Y190aW1lc3RhbXApXG4gICAgICApLFxuICAgICAgZHdlbGxfcmFuZ2VzIEFTIChcbiAgICAgICAgU0VMRUNUXG4gICAgICAgICAgQ0FTRVxuICAgICAgICAgICAgV0hFTiBkd2VsbF9zZWNvbmRzIDwgMzAgVEhFTiAnMC0zMHMnXG4gICAgICAgICAgICBXSEVOIGR3ZWxsX3NlY29uZHMgPCA2MCBUSEVOICczMHMtMW0nXG4gICAgICAgICAgICBXSEVOIGR3ZWxsX3NlY29uZHMgPCAzMDAgVEhFTiAnMS01bSdcbiAgICAgICAgICAgIFdIRU4gZHdlbGxfc2Vjb25kcyA8IDkwMCBUSEVOICc1LTE1bSdcbiAgICAgICAgICAgIFdIRU4gZHdlbGxfc2Vjb25kcyA8IDM2MDAgVEhFTiAnMTUtNjBtJ1xuICAgICAgICAgICAgRUxTRSAnNjBtKydcbiAgICAgICAgICBFTkQgYXMgZHdlbGxfcmFuZ2VcbiAgICAgICAgRlJPTSBkZXZpY2VfZHdlbGxcbiAgICAgIClcbiAgICAgIFNFTEVDVFxuICAgICAgICBkd2VsbF9yYW5nZSxcbiAgICAgICAgQ09VTlQoKikgYXMgY291bnRcbiAgICAgIEZST00gZHdlbGxfcmFuZ2VzXG4gICAgICBHUk9VUCBCWSBkd2VsbF9yYW5nZVxuICAgICAgT1JERVIgQlkgXG4gICAgICAgIENBU0UgZHdlbGxfcmFuZ2VcbiAgICAgICAgICBXSEVOICcwLTMwcycgVEhFTiAxXG4gICAgICAgICAgV0hFTiAnMzBzLTFtJyBUSEVOIDJcbiAgICAgICAgICBXSEVOICcxLTVtJyBUSEVOIDNcbiAgICAgICAgICBXSEVOICc1LTE1bScgVEhFTiA0XG4gICAgICAgICAgV0hFTiAnMTUtNjBtJyBUSEVOIDVcbiAgICAgICAgICBXSEVOICc2MG0rJyBUSEVOIDZcbiAgICAgICAgICBFTFNFIDdcbiAgICAgICAgRU5EXG4gICAgYCksXG5cbiAgICAvLyBUb3AgUE9Jc1xuICAgIHJ1blF1ZXJ5V2l0aE5hbWUoJ1RvcCBQT0lzJywgYFxuICAgICAgU0VMRUNUIFxuICAgICAgICBwb2lfaWRzWzFdIGFzIHBvaV9pZCxcbiAgICAgICAgQ09VTlQoKikgYXMgcGluZ3MsXG4gICAgICAgIENPVU5UKERJU1RJTkNUIGFkX2lkKSBhcyBkZXZpY2VzXG4gICAgICBGUk9NICR7dGFibGVOYW1lfVxuICAgICAgJHt3aGVyZUNsYXVzZSA/IHdoZXJlQ2xhdXNlICsgJyBBTkQgcG9pX2lkc1sxXSBJUyBOT1QgTlVMTCcgOiAnV0hFUkUgcG9pX2lkc1sxXSBJUyBOT1QgTlVMTCd9XG4gICAgICBHUk9VUCBCWSBwb2lfaWRzWzFdXG4gICAgICBPUkRFUiBCWSBDT1VOVChESVNUSU5DVCBhZF9pZCkgREVTQ1xuICAgICAgTElNSVQgMjBcbiAgICBgKSxcbiAgICBdKTtcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBydW5uaW5nIGFuYWx5c2lzIHF1ZXJpZXM6JywgZXJyb3IpO1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG1lc3NhZ2U6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3Igc3RhY2s6JywgZXJyb3Iuc3RhY2spO1xuICAgIC8vIFJlLXRocm93IHdpdGggbW9yZSBjb250ZXh0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBBbmFseXNpcyBxdWVyeSBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCk7XG4gIH1cblxuICAvLyBQYXJzZSByZXN1bHRzXG4gIGNvbnN0IHN1bW1hcnkgPSBzdW1tYXJ5UmVzLnJvd3NbMF0gfHwge307XG4gIFxuICAvLyBMb2cgc3VtbWFyeSBmb3IgZGVidWdnaW5nXG4gIGNvbnNvbGUubG9nKGDwn5OKIEFuYWx5c2lzIHN1bW1hcnkgZm9yICR7ZGF0YXNldE5hbWV9OmApO1xuICBjb25zb2xlLmxvZyhgICAgVG90YWwgcGluZ3M6ICR7cGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudG90YWxfcGluZ3MpKS50b0xvY2FsZVN0cmluZygpfWApO1xuICBjb25zb2xlLmxvZyhgICAgVW5pcXVlIGRldmljZXM6ICR7cGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudW5pcXVlX2RldmljZXMpKS50b0xvY2FsZVN0cmluZygpfWApO1xuICBjb25zb2xlLmxvZyhgICAgVW5pcXVlIFBPSXM6ICR7cGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudW5pcXVlX3BvaXMpKS50b0xvY2FsZVN0cmluZygpfWApO1xuICBjb25zb2xlLmxvZyhgICAgRGF0ZSByYW5nZTogJHtzdW1tYXJ5Lm1pbl9kYXRlfSB0byAke3N1bW1hcnkubWF4X2RhdGV9YCk7XG4gIGNvbnNvbGUubG9nKGAgICBEYXlzIGFuYWx5emVkOiAke3N1bW1hcnkuZGF5c19hbmFseXplZH1gKTtcbiAgY29uc29sZS5sb2coYCAgIFBhcnRpdGlvbnMgZm91bmQ6ICR7c3VtbWFyeS5wYXJ0aXRpb25fY291bnQgfHwgJ04vQSd9YCk7XG5cbiAgY29uc3QgZGV2aWNlVHlwZXM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgZGV2aWNlVHlwZXNSZXMucm93cy5mb3JFYWNoKHIgPT4ge1xuICAgIGlmIChyLmlkX3R5cGUpIHtcbiAgICAgIGRldmljZVR5cGVzW3IuaWRfdHlwZV0gPSBwYXJzZUludChTdHJpbmcoci5jb3VudCkpIHx8IDA7XG4gICAgfVxuICB9KTtcbiAgXG4gIGNvbnNvbGUubG9nKGDwn5OxIERldmljZSB0eXBlczpgLCBkZXZpY2VUeXBlcyk7XG4gIGNvbnNvbGUubG9nKGDwn5OFIERhaWx5IGFjdGl2aXR5IHJlY29yZHM6ICR7ZGFpbHlSZXMucm93cy5sZW5ndGh9YCk7XG5cbiAgLy8gUHJvY2VzcyBkYWlseSBhY3Rpdml0eSAtIGVuc3VyZSBkYXRlcyBhcmUgcHJvcGVybHkgZm9ybWF0dGVkXG4gIGNvbnN0IGRhaWx5QWN0aXZpdHkgPSBkYWlseVJlcy5yb3dzXG4gICAgLm1hcChyID0+IHtcbiAgICAgIC8vIEdldCBkYXRlIHN0cmluZyBmcm9tIEF0aGVuYSByZXN1bHRcbiAgICAgIGxldCBkYXRlU3RyID0gU3RyaW5nKHIuZGF0ZSB8fCAnJykudHJpbSgpO1xuICAgICAgXG4gICAgICAvLyBOb3JtYWxpemUgZGF0ZSBmb3JtYXQgdG8gWVlZWS1NTS1ERFxuICAgICAgaWYgKCFkYXRlU3RyKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBIYW5kbGUgZGlmZmVyZW50IGZvcm1hdHMgZnJvbSBBdGhlbmFcbiAgICAgIGlmIChkYXRlU3RyLm1hdGNoKC9eXFxkezR9LVxcZHsyfS1cXGR7Mn0kLykpIHtcbiAgICAgICAgLy8gQWxyZWFkeSBpbiBZWVlZLU1NLUREIGZvcm1hdCAtIHBlcmZlY3QhXG4gICAgICAgIGRhdGVTdHIgPSBkYXRlU3RyO1xuICAgICAgfSBlbHNlIGlmIChkYXRlU3RyLmluY2x1ZGVzKCdUJykpIHtcbiAgICAgICAgLy8gSVNPIGZvcm1hdDogXCIyMDI2LTAxLTA1VDAwOjAwOjAwLjAwMFpcIiAtPiBcIjIwMjYtMDEtMDVcIlxuICAgICAgICBkYXRlU3RyID0gZGF0ZVN0ci5zcGxpdCgnVCcpWzBdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIGFuZCByZWZvcm1hdFxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyKTtcbiAgICAgICAgICBpZiAoIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkge1xuICAgICAgICAgICAgY29uc3QgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgICAgIGNvbnN0IG1vbnRoID0gU3RyaW5nKGRhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgICAgICAgICBjb25zdCBkYXkgPSBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgICAgICAgICBkYXRlU3RyID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBJbnZhbGlkIGRhdGUgZm9ybWF0OiAke2RhdGVTdHJ9YCk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYEVycm9yIHBhcnNpbmcgZGF0ZTogJHtkYXRlU3RyfWAsIGUpO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGU6IGRhdGVTdHIsXG4gICAgICAgIHBpbmdzOiBwYXJzZUludChTdHJpbmcoci5waW5ncykpIHx8IDAsXG4gICAgICAgIGRldmljZXM6IHBhcnNlSW50KFN0cmluZyhyLmRldmljZXMpKSB8fCAwLFxuICAgICAgfTtcbiAgICB9KVxuICAgIC5maWx0ZXIoKGl0ZW0pOiBpdGVtIGlzIHsgZGF0ZTogc3RyaW5nOyBwaW5nczogbnVtYmVyOyBkZXZpY2VzOiBudW1iZXIgfSA9PiBpdGVtICE9PSBudWxsKVxuICAgIC5zb3J0KChhLCBiKSA9PiBhLmRhdGUubG9jYWxlQ29tcGFyZShiLmRhdGUpKTsgLy8gRW5zdXJlIHNvcnRlZCBieSBkYXRlXG5cbiAgY29uc3QgZHdlbGxEaXN0cmlidXRpb246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJzAtMzBzJzogMCxcbiAgICAnMzBzLTFtJzogMCxcbiAgICAnMS01bSc6IDAsXG4gICAgJzUtMTVtJzogMCxcbiAgICAnMTUtNjBtJzogMCxcbiAgICAnNjBtKyc6IDAsXG4gIH07XG4gIGR3ZWxsUmVzLnJvd3MuZm9yRWFjaChyID0+IHtcbiAgICBpZiAoci5kd2VsbF9yYW5nZSkge1xuICAgICAgZHdlbGxEaXN0cmlidXRpb25bci5kd2VsbF9yYW5nZV0gPSBwYXJzZUludChTdHJpbmcoci5jb3VudCkpIHx8IDA7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCB0b3BQb2lzID0gdG9wUG9pc1Jlcy5yb3dzLm1hcChyID0+ICh7XG4gICAgcG9pSWQ6IFN0cmluZyhyLnBvaV9pZCB8fCAnJyksXG4gICAgcGluZ3M6IHBhcnNlSW50KFN0cmluZyhyLnBpbmdzKSkgfHwgMCxcbiAgICBkZXZpY2VzOiBwYXJzZUludChTdHJpbmcoci5kZXZpY2VzKSkgfHwgMCxcbiAgfSkpO1xuXG4gIHJldHVybiB7XG4gICAgZGF0YXNldDogZGF0YXNldE5hbWUsXG4gICAgYW5hbHl6ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIGZpbHRlcnMsXG4gICAgc3VtbWFyeToge1xuICAgICAgdG90YWxQaW5nczogcGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudG90YWxfcGluZ3MpKSB8fCAwLFxuICAgICAgdW5pcXVlRGV2aWNlczogcGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudW5pcXVlX2RldmljZXMpKSB8fCAwLFxuICAgICAgdW5pcXVlUG9pczogcGFyc2VJbnQoU3RyaW5nKHN1bW1hcnkudW5pcXVlX3BvaXMpKSB8fCAwLFxuICAgICAgZGF0ZVJhbmdlOiB7XG4gICAgICAgIGZyb206IFN0cmluZyhzdW1tYXJ5Lm1pbl9kYXRlIHx8ICcnKSxcbiAgICAgICAgdG86IFN0cmluZyhzdW1tYXJ5Lm1heF9kYXRlIHx8ICcnKSxcbiAgICAgIH0sXG4gICAgICBkYXlzQW5hbHl6ZWQ6IHBhcnNlSW50KFN0cmluZyhzdW1tYXJ5LmRheXNfYW5hbHl6ZWQpKSB8fCAwLFxuICAgIH0sXG4gICAgZGV2aWNlVHlwZXMsXG4gICAgZGFpbHlBY3Rpdml0eSxcbiAgICBkd2VsbERpc3RyaWJ1dGlvbixcbiAgICB0b3BQb2lzLFxuICB9O1xufVxuIl0sIm5hbWVzIjpbInJ1blF1ZXJ5IiwiY3JlYXRlVGFibGVGb3JEYXRhc2V0IiwidGFibGVFeGlzdHMiLCJnZXRUYWJsZU5hbWUiLCJhbmFseXplRGF0YXNldCIsImRhdGFzZXROYW1lIiwiZmlsdGVycyIsInRhYmxlTmFtZSIsInByb2Nlc3MiLCJlbnYiLCJBV1NfQUNDRVNTX0tFWV9JRCIsIkFXU19TRUNSRVRfQUNDRVNTX0tFWSIsIkVycm9yIiwidGFibGVFeGlzdHNSZXN1bHQiLCJlcnJvciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsIm5hbWUiLCJjb25zb2xlIiwibG9nIiwiY29uZGl0aW9ucyIsImRhdGVGcm9tIiwicHVzaCIsImRhdGVUbyIsInBvaUlkcyIsImxlbmd0aCIsInBvaUxpc3QiLCJtYXAiLCJwIiwiZXNjYXBlZCIsInJlcGxhY2UiLCJqb2luIiwid2hlcmVDbGF1c2UiLCJ3aGVyZUNsYXVzZVNhZmUiLCJwYXJ0aXRpb25DaGVjayIsInJvd3MiLCJmb3JFYWNoIiwiciIsInBhcnRpdGlvbl9kYXRlIiwicGFyc2VJbnQiLCJTdHJpbmciLCJyb3dfY291bnQiLCJ0b0xvY2FsZVN0cmluZyIsInVuaXF1ZV9kZXZpY2VzIiwiZXJyIiwid2FybiIsInN1bW1hcnlSZXMiLCJkZXZpY2VUeXBlc1JlcyIsImRhaWx5UmVzIiwiZHdlbGxSZXMiLCJ0b3BQb2lzUmVzIiwicnVuUXVlcnlXaXRoTmFtZSIsInNxbCIsInJlc3VsdCIsIlByb21pc2UiLCJhbGwiLCJzdGFjayIsInN1bW1hcnkiLCJ0b3RhbF9waW5ncyIsInVuaXF1ZV9wb2lzIiwibWluX2RhdGUiLCJtYXhfZGF0ZSIsImRheXNfYW5hbHl6ZWQiLCJwYXJ0aXRpb25fY291bnQiLCJkZXZpY2VUeXBlcyIsImlkX3R5cGUiLCJjb3VudCIsImRhaWx5QWN0aXZpdHkiLCJkYXRlU3RyIiwiZGF0ZSIsInRyaW0iLCJtYXRjaCIsInNwbGl0IiwiRGF0ZSIsImlzTmFOIiwiZ2V0VGltZSIsInllYXIiLCJnZXRGdWxsWWVhciIsIm1vbnRoIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsImRheSIsImdldERhdGUiLCJlIiwicGluZ3MiLCJkZXZpY2VzIiwiZmlsdGVyIiwiaXRlbSIsInNvcnQiLCJhIiwiYiIsImxvY2FsZUNvbXBhcmUiLCJkd2VsbERpc3RyaWJ1dGlvbiIsImR3ZWxsX3JhbmdlIiwidG9wUG9pcyIsInBvaUlkIiwicG9pX2lkIiwiZGF0YXNldCIsImFuYWx5emVkQXQiLCJ0b0lTT1N0cmluZyIsInRvdGFsUGluZ3MiLCJ1bmlxdWVEZXZpY2VzIiwidW5pcXVlUG9pcyIsImRhdGVSYW5nZSIsImZyb20iLCJ0byIsImRheXNBbmFseXplZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/dataset-analyzer.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@smithy","vendor-chunks/@aws-sdk","vendor-chunks/next","vendor-chunks/@aws"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();