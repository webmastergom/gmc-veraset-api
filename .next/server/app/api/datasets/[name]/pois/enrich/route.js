"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/datasets/[name]/pois/enrich/route";
exports.ids = ["app/api/datasets/[name]/pois/enrich/route"];
exports.modules = {

/***/ "@aws-sdk/client-s3":
/*!*************************************!*\
  !*** external "@aws-sdk/client-s3" ***!
  \*************************************/
/***/ ((module) => {

module.exports = require("@aws-sdk/client-s3");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "process":
/*!**************************!*\
  !*** external "process" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("process");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:fs/promises":
/*!***********************************!*\
  !*** external "node:fs/promises" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:fs/promises");

/***/ }),

/***/ "node:os":
/*!**************************!*\
  !*** external "node:os" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:os");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_juliangarritz_dev_py_veraset_veraset_api_app_api_datasets_name_pois_enrich_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/datasets/[name]/pois/enrich/route.ts */ \"(rsc)/./app/api/datasets/[name]/pois/enrich/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/datasets/[name]/pois/enrich/route\",\n        pathname: \"/api/datasets/[name]/pois/enrich\",\n        filename: \"route\",\n        bundlePath: \"app/api/datasets/[name]/pois/enrich/route\"\n    },\n    resolvedPagePath: \"/Users/juliangarritz/dev/py/veraset/veraset-api/app/api/datasets/[name]/pois/enrich/route.ts\",\n    nextConfigOutput,\n    userland: _Users_juliangarritz_dev_py_veraset_veraset_api_app_api_datasets_name_pois_enrich_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/datasets/[name]/pois/enrich/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZkYXRhc2V0cyUyRiU1Qm5hbWUlNUQlMkZwb2lzJTJGZW5yaWNoJTJGcm91dGUmcGFnZT0lMkZhcGklMkZkYXRhc2V0cyUyRiU1Qm5hbWUlNUQlMkZwb2lzJTJGZW5yaWNoJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZGF0YXNldHMlMkYlNUJuYW1lJTVEJTJGcG9pcyUyRmVucmljaCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmp1bGlhbmdhcnJpdHolMkZkZXYlMkZweSUyRnZlcmFzZXQlMkZ2ZXJhc2V0LWFwaSUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZqdWxpYW5nYXJyaXR6JTJGZGV2JTJGcHklMkZ2ZXJhc2V0JTJGdmVyYXNldC1hcGkmaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzRDO0FBQ3pIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ21jLXZlcmFzZXQtYXBpLz82MzE1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9qdWxpYW5nYXJyaXR6L2Rldi9weS92ZXJhc2V0L3ZlcmFzZXQtYXBpL2FwcC9hcGkvZGF0YXNldHMvW25hbWVdL3BvaXMvZW5yaWNoL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kYXRhc2V0cy9bbmFtZV0vcG9pcy9lbnJpY2gvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kYXRhc2V0cy9bbmFtZV0vcG9pcy9lbnJpY2hcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2RhdGFzZXRzL1tuYW1lXS9wb2lzL2VucmljaC9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9qdWxpYW5nYXJyaXR6L2Rldi9weS92ZXJhc2V0L3ZlcmFzZXQtYXBpL2FwcC9hcGkvZGF0YXNldHMvW25hbWVdL3BvaXMvZW5yaWNoL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9kYXRhc2V0cy9bbmFtZV0vcG9pcy9lbnJpY2gvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/datasets/[name]/pois/enrich/route.ts":
/*!******************************************************!*\
  !*** ./app/api/datasets/[name]/pois/enrich/route.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   revalidate: () => (/* binding */ revalidate)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_athena__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/athena */ \"(rsc)/./lib/athena.ts\");\n\n\nconst VERASET_BASE_URL = \"https://platform.prd.veraset.tech\";\nconst dynamic = \"force-dynamic\";\nconst revalidate = 0;\nconst maxDuration = 60;\n/**\n * GET /api/datasets/[name]/pois/enrich\n * Get POIs from dataset and enrich them with details from Veraset API\n * This uses /v1/poi/pois to get information about POIs that visited the dataset\n */ async function GET(req, { params }) {\n    try {\n        const apiKey = process.env.VERASET_API_KEY;\n        if (!apiKey) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"VERASET_API_KEY not configured\"\n            }, {\n                status: 500\n            });\n        }\n        const datasetName = params.name;\n        const tableName = (0,_lib_athena__WEBPACK_IMPORTED_MODULE_1__.getTableName)(datasetName);\n        // Check if AWS credentials are configured\n        if (!process.env.AWS_ACCESS_KEY_ID || !process.env.AWS_SECRET_ACCESS_KEY) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"AWS credentials not configured\"\n            }, {\n                status: 503\n            });\n        }\n        // Ensure table exists\n        if (!await (0,_lib_athena__WEBPACK_IMPORTED_MODULE_1__.tableExists)(datasetName)) {\n            await (0,_lib_athena__WEBPACK_IMPORTED_MODULE_1__.createTableForDataset)(datasetName);\n        }\n        // Query to get all unique POIs with their stats\n        const sql = `\n      SELECT \n        poi_ids[1] as poi_id,\n        COUNT(*) as pings,\n        COUNT(DISTINCT ad_id) as devices\n      FROM ${tableName}\n      WHERE poi_ids[1] IS NOT NULL\n      GROUP BY poi_ids[1]\n      ORDER BY COUNT(DISTINCT ad_id) DESC\n    `;\n        console.log(`ðŸ” Fetching POIs for dataset ${datasetName}...`);\n        const result = await (0,_lib_athena__WEBPACK_IMPORTED_MODULE_1__.runQuery)(sql);\n        const datasetPois = result.rows.map((row)=>({\n                poiId: row.poi_id,\n                pings: parseInt(String(row.pings)) || 0,\n                devices: parseInt(String(row.devices)) || 0\n            }));\n        console.log(`âœ… Found ${datasetPois.length} unique POIs in dataset ${datasetName}`);\n        // If no POIs found, return early\n        if (datasetPois.length === 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                pois: [],\n                total: 0,\n                enriched: false\n            });\n        }\n        // Extract POI IDs to query Veraset API\n        const poiIds = datasetPois.map((p)=>p.poiId).filter(Boolean);\n        // Query Veraset API to get POI details for the POIs in our dataset\n        // According to Veraset docs: /v1/poi/pois can be queried to get POI information\n        // We'll query with the POI IDs we found in the dataset\n        try {\n            // Query Veraset API - we can pass POI IDs as query parameters if supported\n            // Or query all and filter (less efficient but works)\n            // TODO: Check Veraset API docs for best way to query specific POI IDs\n            const verasetResponse = await fetch(`${VERASET_BASE_URL}/v1/poi/pois`, {\n                method: \"GET\",\n                headers: {\n                    \"X-API-Key\": apiKey,\n                    \"Content-Type\": \"application/json\"\n                }\n            });\n            if (verasetResponse.ok) {\n                const verasetData = await verasetResponse.json();\n                const verasetPois = verasetData.pois || verasetData.data || [];\n                // Create a map of POI ID to Veraset POI data\n                // Match by poi_id or id field\n                const poiDetailsMap = new Map();\n                verasetPois.forEach((poi)=>{\n                    const poiId = poi.poi_id || poi.id || poi.place_key;\n                    if (poiId) {\n                        // Store by both string and number representation for matching\n                        poiDetailsMap.set(String(poiId), poi);\n                        if (typeof poiId === \"number\") {\n                            poiDetailsMap.set(String(poiId), poi);\n                        }\n                    }\n                });\n                // Enrich dataset POIs with Veraset data\n                const enrichedPois = datasetPois.map((datasetPoi)=>{\n                    const verasetPoi = poiDetailsMap.get(String(datasetPoi.poiId));\n                    return {\n                        ...datasetPoi,\n                        // Add Veraset POI details if found\n                        name: verasetPoi?.name || verasetPoi?.poi_name || verasetPoi?.brand || datasetPoi.poiId,\n                        category: verasetPoi?.category,\n                        subcategory: verasetPoi?.subcategory,\n                        brand: verasetPoi?.brand,\n                        address: verasetPoi?.address,\n                        city: verasetPoi?.city,\n                        state: verasetPoi?.state,\n                        zipcode: verasetPoi?.zipcode || verasetPoi?.zip,\n                        country: verasetPoi?.country,\n                        place_key: verasetPoi?.place_key || verasetPoi?.placeKey,\n                        enriched: !!verasetPoi\n                    };\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    pois: enrichedPois,\n                    total: enrichedPois.length,\n                    enriched: true,\n                    enrichedCount: enrichedPois.filter((p)=>p.enriched).length\n                });\n            } else {\n                // If Veraset API fails, return POIs without enrichment\n                console.warn(\"Failed to enrich POIs from Veraset API, returning basic POI data\");\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    pois: datasetPois,\n                    total: datasetPois.length,\n                    enriched: false\n                });\n            }\n        } catch (error) {\n            console.error(\"Error enriching POIs from Veraset:\", error);\n            // Return POIs without enrichment if Veraset API fails\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                pois: datasetPois,\n                total: datasetPois.length,\n                enriched: false,\n                error: \"Failed to enrich POIs from Veraset API\"\n            });\n        }\n    } catch (error) {\n        console.error(`GET /api/datasets/${params.name}/pois/enrich error:`, error);\n        let errorMessage = error.message || \"Unknown error\";\n        let statusCode = 500;\n        if (errorMessage.includes(\"AWS credentials not configured\")) {\n            statusCode = 503;\n        } else if (errorMessage.includes(\"database\") || errorMessage.includes(\"Database\")) {\n            statusCode = 503;\n        } else if (errorMessage.includes(\"Access denied\")) {\n            statusCode = 403;\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to fetch and enrich POIs\",\n            details: errorMessage\n        }, {\n            status: statusCode\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2RhdGFzZXRzL1tuYW1lXS9wb2lzL2VucmljaC9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0Q7QUFDa0M7QUFFMUYsTUFBTUssbUJBQW1CO0FBRWxCLE1BQU1DLFVBQVUsZ0JBQWdCO0FBQ2hDLE1BQU1DLGFBQWEsRUFBRTtBQUNyQixNQUFNQyxjQUFjLEdBQUc7QUFFOUI7Ozs7Q0FJQyxHQUNNLGVBQWVDLElBQ3BCQyxHQUFnQixFQUNoQixFQUFFQyxNQUFNLEVBQWdDO0lBRXhDLElBQUk7UUFDRixNQUFNQyxTQUFTQyxRQUFRQyxHQUFHLENBQUNDLGVBQWU7UUFFMUMsSUFBSSxDQUFDSCxRQUFRO1lBQ1gsT0FBT1oscURBQVlBLENBQUNnQixJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQWlDLEdBQzFDO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxNQUFNQyxjQUFjUixPQUFPUyxJQUFJO1FBQy9CLE1BQU1DLFlBQVlqQix5REFBWUEsQ0FBQ2U7UUFFL0IsMENBQTBDO1FBQzFDLElBQUksQ0FBQ04sUUFBUUMsR0FBRyxDQUFDUSxpQkFBaUIsSUFBSSxDQUFDVCxRQUFRQyxHQUFHLENBQUNTLHFCQUFxQixFQUFFO1lBQ3hFLE9BQU92QixxREFBWUEsQ0FBQ2dCLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBaUMsR0FDMUM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLHNCQUFzQjtRQUN0QixJQUFJLENBQUUsTUFBTWYsd0RBQVdBLENBQUNnQixjQUFlO1lBQ3JDLE1BQU1qQixrRUFBcUJBLENBQUNpQjtRQUM5QjtRQUVBLGdEQUFnRDtRQUNoRCxNQUFNSyxNQUFNLENBQUM7Ozs7O1dBS04sRUFBRUgsVUFBVTs7OztJQUluQixDQUFDO1FBRURJLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDZCQUE2QixFQUFFUCxZQUFZLEdBQUcsQ0FBQztRQUM1RCxNQUFNUSxTQUFTLE1BQU0xQixxREFBUUEsQ0FBQ3VCO1FBRTlCLE1BQU1JLGNBQWNELE9BQU9FLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUNDLE1BQWM7Z0JBQ2pEQyxPQUFPRCxJQUFJRSxNQUFNO2dCQUNqQkMsT0FBT0MsU0FBU0MsT0FBT0wsSUFBSUcsS0FBSyxNQUFNO2dCQUN0Q0csU0FBU0YsU0FBU0MsT0FBT0wsSUFBSU0sT0FBTyxNQUFNO1lBQzVDO1FBRUFaLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRUUsWUFBWVUsTUFBTSxDQUFDLHdCQUF3QixFQUFFbkIsWUFBWSxDQUFDO1FBRWpGLGlDQUFpQztRQUNqQyxJQUFJUyxZQUFZVSxNQUFNLEtBQUssR0FBRztZQUM1QixPQUFPdEMscURBQVlBLENBQUNnQixJQUFJLENBQUM7Z0JBQ3ZCdUIsTUFBTSxFQUFFO2dCQUNSQyxPQUFPO2dCQUNQQyxVQUFVO1lBQ1o7UUFDRjtRQUVBLHVDQUF1QztRQUN2QyxNQUFNQyxTQUFTZCxZQUFZRSxHQUFHLENBQUNhLENBQUFBLElBQUtBLEVBQUVYLEtBQUssRUFBRVksTUFBTSxDQUFDQztRQUVwRCxtRUFBbUU7UUFDbkUsZ0ZBQWdGO1FBQ2hGLHVEQUF1RDtRQUN2RCxJQUFJO1lBQ0YsMkVBQTJFO1lBQzNFLHFEQUFxRDtZQUNyRCxzRUFBc0U7WUFDdEUsTUFBTUMsa0JBQWtCLE1BQU1DLE1BQU0sQ0FBQyxFQUFFMUMsaUJBQWlCLFlBQVksQ0FBQyxFQUFFO2dCQUNyRTJDLFFBQVE7Z0JBQ1JDLFNBQVM7b0JBQ1AsYUFBYXJDO29CQUNiLGdCQUFnQjtnQkFDbEI7WUFDRjtZQUVBLElBQUlrQyxnQkFBZ0JJLEVBQUUsRUFBRTtnQkFDdEIsTUFBTUMsY0FBYyxNQUFNTCxnQkFBZ0I5QixJQUFJO2dCQUM5QyxNQUFNb0MsY0FBY0QsWUFBWVosSUFBSSxJQUFJWSxZQUFZRSxJQUFJLElBQUksRUFBRTtnQkFFOUQsNkNBQTZDO2dCQUM3Qyw4QkFBOEI7Z0JBQzlCLE1BQU1DLGdCQUFnQixJQUFJQztnQkFDMUJILFlBQVlJLE9BQU8sQ0FBQyxDQUFDQztvQkFDbkIsTUFBTXpCLFFBQVF5QixJQUFJeEIsTUFBTSxJQUFJd0IsSUFBSUMsRUFBRSxJQUFJRCxJQUFJRSxTQUFTO29CQUNuRCxJQUFJM0IsT0FBTzt3QkFDVCw4REFBOEQ7d0JBQzlEc0IsY0FBY00sR0FBRyxDQUFDeEIsT0FBT0osUUFBUXlCO3dCQUNqQyxJQUFJLE9BQU96QixVQUFVLFVBQVU7NEJBQzdCc0IsY0FBY00sR0FBRyxDQUFDeEIsT0FBT0osUUFBUXlCO3dCQUNuQztvQkFDRjtnQkFDRjtnQkFFQSx3Q0FBd0M7Z0JBQ3hDLE1BQU1JLGVBQWVqQyxZQUFZRSxHQUFHLENBQUNnQyxDQUFBQTtvQkFDbkMsTUFBTUMsYUFBYVQsY0FBY1UsR0FBRyxDQUFDNUIsT0FBTzBCLFdBQVc5QixLQUFLO29CQUU1RCxPQUFPO3dCQUNMLEdBQUc4QixVQUFVO3dCQUNiLG1DQUFtQzt3QkFDbkMxQyxNQUFNMkMsWUFBWTNDLFFBQVEyQyxZQUFZRSxZQUFZRixZQUFZRyxTQUFTSixXQUFXOUIsS0FBSzt3QkFDdkZtQyxVQUFVSixZQUFZSTt3QkFDdEJDLGFBQWFMLFlBQVlLO3dCQUN6QkYsT0FBT0gsWUFBWUc7d0JBQ25CRyxTQUFTTixZQUFZTTt3QkFDckJDLE1BQU1QLFlBQVlPO3dCQUNsQkMsT0FBT1IsWUFBWVE7d0JBQ25CQyxTQUFTVCxZQUFZUyxXQUFXVCxZQUFZVTt3QkFDNUNDLFNBQVNYLFlBQVlXO3dCQUNyQmYsV0FBV0ksWUFBWUosYUFBYUksWUFBWVk7d0JBQ2hEbEMsVUFBVSxDQUFDLENBQUNzQjtvQkFDZDtnQkFDRjtnQkFFQSxPQUFPL0QscURBQVlBLENBQUNnQixJQUFJLENBQUM7b0JBQ3ZCdUIsTUFBTXNCO29CQUNOckIsT0FBT3FCLGFBQWF2QixNQUFNO29CQUMxQkcsVUFBVTtvQkFDVm1DLGVBQWVmLGFBQWFqQixNQUFNLENBQUNELENBQUFBLElBQUtBLEVBQUVGLFFBQVEsRUFBRUgsTUFBTTtnQkFDNUQ7WUFDRixPQUFPO2dCQUNMLHVEQUF1RDtnQkFDdkRiLFFBQVFvRCxJQUFJLENBQUM7Z0JBQ2IsT0FBTzdFLHFEQUFZQSxDQUFDZ0IsSUFBSSxDQUFDO29CQUN2QnVCLE1BQU1YO29CQUNOWSxPQUFPWixZQUFZVSxNQUFNO29CQUN6QkcsVUFBVTtnQkFDWjtZQUNGO1FBQ0YsRUFBRSxPQUFPeEIsT0FBWTtZQUNuQlEsUUFBUVIsS0FBSyxDQUFDLHNDQUFzQ0E7WUFDcEQsc0RBQXNEO1lBQ3RELE9BQU9qQixxREFBWUEsQ0FBQ2dCLElBQUksQ0FBQztnQkFDdkJ1QixNQUFNWDtnQkFDTlksT0FBT1osWUFBWVUsTUFBTTtnQkFDekJHLFVBQVU7Z0JBQ1Z4QixPQUFPO1lBQ1Q7UUFDRjtJQUVGLEVBQUUsT0FBT0EsT0FBWTtRQUNuQlEsUUFBUVIsS0FBSyxDQUFDLENBQUMsa0JBQWtCLEVBQUVOLE9BQU9TLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFSDtRQUVyRSxJQUFJNkQsZUFBZTdELE1BQU04RCxPQUFPLElBQUk7UUFDcEMsSUFBSUMsYUFBYTtRQUVqQixJQUFJRixhQUFhRyxRQUFRLENBQUMsbUNBQW1DO1lBQzNERCxhQUFhO1FBQ2YsT0FBTyxJQUFJRixhQUFhRyxRQUFRLENBQUMsZUFBZUgsYUFBYUcsUUFBUSxDQUFDLGFBQWE7WUFDakZELGFBQWE7UUFDZixPQUFPLElBQUlGLGFBQWFHLFFBQVEsQ0FBQyxrQkFBa0I7WUFDakRELGFBQWE7UUFDZjtRQUVBLE9BQU9oRixxREFBWUEsQ0FBQ2dCLElBQUksQ0FDdEI7WUFDRUMsT0FBTztZQUNQaUUsU0FBU0o7UUFDWCxHQUNBO1lBQUU1RCxRQUFROEQ7UUFBVztJQUV6QjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ21jLXZlcmFzZXQtYXBpLy4vYXBwL2FwaS9kYXRhc2V0cy9bbmFtZV0vcG9pcy9lbnJpY2gvcm91dGUudHM/Zjk5ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgcnVuUXVlcnksIGNyZWF0ZVRhYmxlRm9yRGF0YXNldCwgdGFibGVFeGlzdHMsIGdldFRhYmxlTmFtZSB9IGZyb20gJ0AvbGliL2F0aGVuYSc7XG5cbmNvbnN0IFZFUkFTRVRfQkFTRV9VUkwgPSAnaHR0cHM6Ly9wbGF0Zm9ybS5wcmQudmVyYXNldC50ZWNoJztcblxuZXhwb3J0IGNvbnN0IGR5bmFtaWMgPSAnZm9yY2UtZHluYW1pYyc7XG5leHBvcnQgY29uc3QgcmV2YWxpZGF0ZSA9IDA7XG5leHBvcnQgY29uc3QgbWF4RHVyYXRpb24gPSA2MDtcblxuLyoqXG4gKiBHRVQgL2FwaS9kYXRhc2V0cy9bbmFtZV0vcG9pcy9lbnJpY2hcbiAqIEdldCBQT0lzIGZyb20gZGF0YXNldCBhbmQgZW5yaWNoIHRoZW0gd2l0aCBkZXRhaWxzIGZyb20gVmVyYXNldCBBUElcbiAqIFRoaXMgdXNlcyAvdjEvcG9pL3BvaXMgdG8gZ2V0IGluZm9ybWF0aW9uIGFib3V0IFBPSXMgdGhhdCB2aXNpdGVkIHRoZSBkYXRhc2V0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoXG4gIHJlcTogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IG5hbWU6IHN0cmluZyB9IH1cbikge1xuICB0cnkge1xuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LlZFUkFTRVRfQVBJX0tFWTtcbiAgICBcbiAgICBpZiAoIWFwaUtleSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnVkVSQVNFVF9BUElfS0VZIG5vdCBjb25maWd1cmVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNTAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YXNldE5hbWUgPSBwYXJhbXMubmFtZTtcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBnZXRUYWJsZU5hbWUoZGF0YXNldE5hbWUpO1xuXG4gICAgLy8gQ2hlY2sgaWYgQVdTIGNyZWRlbnRpYWxzIGFyZSBjb25maWd1cmVkXG4gICAgaWYgKCFwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCB8fCAhcHJvY2Vzcy5lbnYuQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdBV1MgY3JlZGVudGlhbHMgbm90IGNvbmZpZ3VyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDMgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBFbnN1cmUgdGFibGUgZXhpc3RzXG4gICAgaWYgKCEoYXdhaXQgdGFibGVFeGlzdHMoZGF0YXNldE5hbWUpKSkge1xuICAgICAgYXdhaXQgY3JlYXRlVGFibGVGb3JEYXRhc2V0KGRhdGFzZXROYW1lKTtcbiAgICB9XG5cbiAgICAvLyBRdWVyeSB0byBnZXQgYWxsIHVuaXF1ZSBQT0lzIHdpdGggdGhlaXIgc3RhdHNcbiAgICBjb25zdCBzcWwgPSBgXG4gICAgICBTRUxFQ1QgXG4gICAgICAgIHBvaV9pZHNbMV0gYXMgcG9pX2lkLFxuICAgICAgICBDT1VOVCgqKSBhcyBwaW5ncyxcbiAgICAgICAgQ09VTlQoRElTVElOQ1QgYWRfaWQpIGFzIGRldmljZXNcbiAgICAgIEZST00gJHt0YWJsZU5hbWV9XG4gICAgICBXSEVSRSBwb2lfaWRzWzFdIElTIE5PVCBOVUxMXG4gICAgICBHUk9VUCBCWSBwb2lfaWRzWzFdXG4gICAgICBPUkRFUiBCWSBDT1VOVChESVNUSU5DVCBhZF9pZCkgREVTQ1xuICAgIGA7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UjSBGZXRjaGluZyBQT0lzIGZvciBkYXRhc2V0ICR7ZGF0YXNldE5hbWV9Li4uYCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuUXVlcnkoc3FsKTtcblxuICAgIGNvbnN0IGRhdGFzZXRQb2lzID0gcmVzdWx0LnJvd3MubWFwKChyb3c6IGFueSkgPT4gKHtcbiAgICAgIHBvaUlkOiByb3cucG9pX2lkLFxuICAgICAgcGluZ3M6IHBhcnNlSW50KFN0cmluZyhyb3cucGluZ3MpKSB8fCAwLFxuICAgICAgZGV2aWNlczogcGFyc2VJbnQoU3RyaW5nKHJvdy5kZXZpY2VzKSkgfHwgMCxcbiAgICB9KSk7XG5cbiAgICBjb25zb2xlLmxvZyhg4pyFIEZvdW5kICR7ZGF0YXNldFBvaXMubGVuZ3RofSB1bmlxdWUgUE9JcyBpbiBkYXRhc2V0ICR7ZGF0YXNldE5hbWV9YCk7XG5cbiAgICAvLyBJZiBubyBQT0lzIGZvdW5kLCByZXR1cm4gZWFybHlcbiAgICBpZiAoZGF0YXNldFBvaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBwb2lzOiBbXSxcbiAgICAgICAgdG90YWw6IDAsXG4gICAgICAgIGVucmljaGVkOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEV4dHJhY3QgUE9JIElEcyB0byBxdWVyeSBWZXJhc2V0IEFQSVxuICAgIGNvbnN0IHBvaUlkcyA9IGRhdGFzZXRQb2lzLm1hcChwID0+IHAucG9pSWQpLmZpbHRlcihCb29sZWFuKTtcbiAgICBcbiAgICAvLyBRdWVyeSBWZXJhc2V0IEFQSSB0byBnZXQgUE9JIGRldGFpbHMgZm9yIHRoZSBQT0lzIGluIG91ciBkYXRhc2V0XG4gICAgLy8gQWNjb3JkaW5nIHRvIFZlcmFzZXQgZG9jczogL3YxL3BvaS9wb2lzIGNhbiBiZSBxdWVyaWVkIHRvIGdldCBQT0kgaW5mb3JtYXRpb25cbiAgICAvLyBXZSdsbCBxdWVyeSB3aXRoIHRoZSBQT0kgSURzIHdlIGZvdW5kIGluIHRoZSBkYXRhc2V0XG4gICAgdHJ5IHtcbiAgICAgIC8vIFF1ZXJ5IFZlcmFzZXQgQVBJIC0gd2UgY2FuIHBhc3MgUE9JIElEcyBhcyBxdWVyeSBwYXJhbWV0ZXJzIGlmIHN1cHBvcnRlZFxuICAgICAgLy8gT3IgcXVlcnkgYWxsIGFuZCBmaWx0ZXIgKGxlc3MgZWZmaWNpZW50IGJ1dCB3b3JrcylcbiAgICAgIC8vIFRPRE86IENoZWNrIFZlcmFzZXQgQVBJIGRvY3MgZm9yIGJlc3Qgd2F5IHRvIHF1ZXJ5IHNwZWNpZmljIFBPSSBJRHNcbiAgICAgIGNvbnN0IHZlcmFzZXRSZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke1ZFUkFTRVRfQkFTRV9VUkx9L3YxL3BvaS9wb2lzYCwge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ1gtQVBJLUtleSc6IGFwaUtleSxcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmICh2ZXJhc2V0UmVzcG9uc2Uub2spIHtcbiAgICAgICAgY29uc3QgdmVyYXNldERhdGEgPSBhd2FpdCB2ZXJhc2V0UmVzcG9uc2UuanNvbigpO1xuICAgICAgICBjb25zdCB2ZXJhc2V0UG9pcyA9IHZlcmFzZXREYXRhLnBvaXMgfHwgdmVyYXNldERhdGEuZGF0YSB8fCBbXTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhIG1hcCBvZiBQT0kgSUQgdG8gVmVyYXNldCBQT0kgZGF0YVxuICAgICAgICAvLyBNYXRjaCBieSBwb2lfaWQgb3IgaWQgZmllbGRcbiAgICAgICAgY29uc3QgcG9pRGV0YWlsc01hcCA9IG5ldyBNYXA8c3RyaW5nLCBhbnk+KCk7XG4gICAgICAgIHZlcmFzZXRQb2lzLmZvckVhY2goKHBvaTogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgcG9pSWQgPSBwb2kucG9pX2lkIHx8IHBvaS5pZCB8fCBwb2kucGxhY2Vfa2V5O1xuICAgICAgICAgIGlmIChwb2lJZCkge1xuICAgICAgICAgICAgLy8gU3RvcmUgYnkgYm90aCBzdHJpbmcgYW5kIG51bWJlciByZXByZXNlbnRhdGlvbiBmb3IgbWF0Y2hpbmdcbiAgICAgICAgICAgIHBvaURldGFpbHNNYXAuc2V0KFN0cmluZyhwb2lJZCksIHBvaSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHBvaUlkID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICBwb2lEZXRhaWxzTWFwLnNldChTdHJpbmcocG9pSWQpLCBwb2kpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRW5yaWNoIGRhdGFzZXQgUE9JcyB3aXRoIFZlcmFzZXQgZGF0YVxuICAgICAgICBjb25zdCBlbnJpY2hlZFBvaXMgPSBkYXRhc2V0UG9pcy5tYXAoZGF0YXNldFBvaSA9PiB7XG4gICAgICAgICAgY29uc3QgdmVyYXNldFBvaSA9IHBvaURldGFpbHNNYXAuZ2V0KFN0cmluZyhkYXRhc2V0UG9pLnBvaUlkKSk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLmRhdGFzZXRQb2ksXG4gICAgICAgICAgICAvLyBBZGQgVmVyYXNldCBQT0kgZGV0YWlscyBpZiBmb3VuZFxuICAgICAgICAgICAgbmFtZTogdmVyYXNldFBvaT8ubmFtZSB8fCB2ZXJhc2V0UG9pPy5wb2lfbmFtZSB8fCB2ZXJhc2V0UG9pPy5icmFuZCB8fCBkYXRhc2V0UG9pLnBvaUlkLFxuICAgICAgICAgICAgY2F0ZWdvcnk6IHZlcmFzZXRQb2k/LmNhdGVnb3J5LFxuICAgICAgICAgICAgc3ViY2F0ZWdvcnk6IHZlcmFzZXRQb2k/LnN1YmNhdGVnb3J5LFxuICAgICAgICAgICAgYnJhbmQ6IHZlcmFzZXRQb2k/LmJyYW5kLFxuICAgICAgICAgICAgYWRkcmVzczogdmVyYXNldFBvaT8uYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IHZlcmFzZXRQb2k/LmNpdHksXG4gICAgICAgICAgICBzdGF0ZTogdmVyYXNldFBvaT8uc3RhdGUsXG4gICAgICAgICAgICB6aXBjb2RlOiB2ZXJhc2V0UG9pPy56aXBjb2RlIHx8IHZlcmFzZXRQb2k/LnppcCxcbiAgICAgICAgICAgIGNvdW50cnk6IHZlcmFzZXRQb2k/LmNvdW50cnksXG4gICAgICAgICAgICBwbGFjZV9rZXk6IHZlcmFzZXRQb2k/LnBsYWNlX2tleSB8fCB2ZXJhc2V0UG9pPy5wbGFjZUtleSxcbiAgICAgICAgICAgIGVucmljaGVkOiAhIXZlcmFzZXRQb2ksXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgICBwb2lzOiBlbnJpY2hlZFBvaXMsXG4gICAgICAgICAgdG90YWw6IGVucmljaGVkUG9pcy5sZW5ndGgsXG4gICAgICAgICAgZW5yaWNoZWQ6IHRydWUsXG4gICAgICAgICAgZW5yaWNoZWRDb3VudDogZW5yaWNoZWRQb2lzLmZpbHRlcihwID0+IHAuZW5yaWNoZWQpLmxlbmd0aCxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBJZiBWZXJhc2V0IEFQSSBmYWlscywgcmV0dXJuIFBPSXMgd2l0aG91dCBlbnJpY2htZW50XG4gICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGVucmljaCBQT0lzIGZyb20gVmVyYXNldCBBUEksIHJldHVybmluZyBiYXNpYyBQT0kgZGF0YScpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICAgIHBvaXM6IGRhdGFzZXRQb2lzLFxuICAgICAgICAgIHRvdGFsOiBkYXRhc2V0UG9pcy5sZW5ndGgsXG4gICAgICAgICAgZW5yaWNoZWQ6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBlbnJpY2hpbmcgUE9JcyBmcm9tIFZlcmFzZXQ6JywgZXJyb3IpO1xuICAgICAgLy8gUmV0dXJuIFBPSXMgd2l0aG91dCBlbnJpY2htZW50IGlmIFZlcmFzZXQgQVBJIGZhaWxzXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgICBwb2lzOiBkYXRhc2V0UG9pcyxcbiAgICAgICAgdG90YWw6IGRhdGFzZXRQb2lzLmxlbmd0aCxcbiAgICAgICAgZW5yaWNoZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBlbnJpY2ggUE9JcyBmcm9tIFZlcmFzZXQgQVBJJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihgR0VUIC9hcGkvZGF0YXNldHMvJHtwYXJhbXMubmFtZX0vcG9pcy9lbnJpY2ggZXJyb3I6YCwgZXJyb3IpO1xuICAgIFxuICAgIGxldCBlcnJvck1lc3NhZ2UgPSBlcnJvci5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJztcbiAgICBsZXQgc3RhdHVzQ29kZSA9IDUwMDtcbiAgICBcbiAgICBpZiAoZXJyb3JNZXNzYWdlLmluY2x1ZGVzKCdBV1MgY3JlZGVudGlhbHMgbm90IGNvbmZpZ3VyZWQnKSkge1xuICAgICAgc3RhdHVzQ29kZSA9IDUwMztcbiAgICB9IGVsc2UgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygnZGF0YWJhc2UnKSB8fCBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ0RhdGFiYXNlJykpIHtcbiAgICAgIHN0YXR1c0NvZGUgPSA1MDM7XG4gICAgfSBlbHNlIGlmIChlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ0FjY2VzcyBkZW5pZWQnKSkge1xuICAgICAgc3RhdHVzQ29kZSA9IDQwMztcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggYW5kIGVucmljaCBQT0lzJywgXG4gICAgICAgIGRldGFpbHM6IGVycm9yTWVzc2FnZVxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiBzdGF0dXNDb2RlIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwicnVuUXVlcnkiLCJjcmVhdGVUYWJsZUZvckRhdGFzZXQiLCJ0YWJsZUV4aXN0cyIsImdldFRhYmxlTmFtZSIsIlZFUkFTRVRfQkFTRV9VUkwiLCJkeW5hbWljIiwicmV2YWxpZGF0ZSIsIm1heER1cmF0aW9uIiwiR0VUIiwicmVxIiwicGFyYW1zIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIlZFUkFTRVRfQVBJX0tFWSIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImRhdGFzZXROYW1lIiwibmFtZSIsInRhYmxlTmFtZSIsIkFXU19BQ0NFU1NfS0VZX0lEIiwiQVdTX1NFQ1JFVF9BQ0NFU1NfS0VZIiwic3FsIiwiY29uc29sZSIsImxvZyIsInJlc3VsdCIsImRhdGFzZXRQb2lzIiwicm93cyIsIm1hcCIsInJvdyIsInBvaUlkIiwicG9pX2lkIiwicGluZ3MiLCJwYXJzZUludCIsIlN0cmluZyIsImRldmljZXMiLCJsZW5ndGgiLCJwb2lzIiwidG90YWwiLCJlbnJpY2hlZCIsInBvaUlkcyIsInAiLCJmaWx0ZXIiLCJCb29sZWFuIiwidmVyYXNldFJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwib2siLCJ2ZXJhc2V0RGF0YSIsInZlcmFzZXRQb2lzIiwiZGF0YSIsInBvaURldGFpbHNNYXAiLCJNYXAiLCJmb3JFYWNoIiwicG9pIiwiaWQiLCJwbGFjZV9rZXkiLCJzZXQiLCJlbnJpY2hlZFBvaXMiLCJkYXRhc2V0UG9pIiwidmVyYXNldFBvaSIsImdldCIsInBvaV9uYW1lIiwiYnJhbmQiLCJjYXRlZ29yeSIsInN1YmNhdGVnb3J5IiwiYWRkcmVzcyIsImNpdHkiLCJzdGF0ZSIsInppcGNvZGUiLCJ6aXAiLCJjb3VudHJ5IiwicGxhY2VLZXkiLCJlbnJpY2hlZENvdW50Iiwid2FybiIsImVycm9yTWVzc2FnZSIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwiaW5jbHVkZXMiLCJkZXRhaWxzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/datasets/[name]/pois/enrich/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/athena.ts":
/*!***********************!*\
  !*** ./lib/athena.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createTableForDataset: () => (/* binding */ createTableForDataset),\n/* harmony export */   getTableName: () => (/* binding */ getTableName),\n/* harmony export */   runQuery: () => (/* binding */ runQuery),\n/* harmony export */   tableExists: () => (/* binding */ tableExists)\n/* harmony export */ });\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/AthenaClient.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/StartQueryExecutionCommand.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/GetQueryExecutionCommand.js\");\n/* harmony import */ var _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @aws-sdk/client-athena */ \"(rsc)/./node_modules/@aws-sdk/client-athena/dist-es/commands/GetQueryResultsCommand.js\");\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @aws-sdk/client-s3 */ \"@aws-sdk/client-s3\");\n/* harmony import */ var _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__);\n/**\n * AWS Athena client for querying Parquet files in S3\n */ \n\nconst athena = new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_1__.AthenaClient({\n    region: process.env.AWS_REGION || \"us-west-2\",\n    credentials: {\n        accessKeyId: process.env.AWS_ACCESS_KEY_ID || \"\",\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || \"\"\n    }\n});\nconst DATABASE = \"veraset\";\nconst OUTPUT_LOCATION = process.env.ATHENA_OUTPUT_LOCATION || `s3://${process.env.S3_BUCKET || \"garritz-veraset-data-us-west-2\"}/athena-results/`;\nconst BUCKET = process.env.S3_BUCKET || \"garritz-veraset-data-us-west-2\";\nconst s3Client = new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.S3Client({\n    region: process.env.AWS_REGION || \"us-west-2\",\n    credentials: {\n        accessKeyId: process.env.AWS_ACCESS_KEY_ID || \"\",\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY || \"\"\n    }\n});\n/**\n * Run an Athena SQL query and return results\n */ async function runQuery(sql) {\n    try {\n        // Check if AWS credentials are configured\n        if (!process.env.AWS_ACCESS_KEY_ID || !process.env.AWS_SECRET_ACCESS_KEY) {\n            throw new Error(\"AWS credentials not configured. Please set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY environment variables.\");\n        }\n        // Start query\n        const startRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_2__.StartQueryExecutionCommand({\n            QueryString: sql,\n            QueryExecutionContext: {\n                Database: DATABASE\n            },\n            ResultConfiguration: {\n                OutputLocation: OUTPUT_LOCATION\n            }\n        }));\n        const queryId = startRes.QueryExecutionId;\n        if (!queryId) {\n            throw new Error(\"No query execution ID returned from Athena\");\n        }\n        console.log(`ðŸš€ Started Athena query: ${queryId}`);\n        console.log(`   Query preview: ${sql.substring(0, 200)}${sql.length > 200 ? \"...\" : \"\"}`);\n        // Poll for completion\n        let state = \"QUEUED\";\n        let attempts = 0;\n        const maxAttempts = 600; // 5 minutes max (500ms * 600) - Athena queries can take time\n        const logInterval = 20; // Log every 10 seconds\n        while((state === \"QUEUED\" || state === \"RUNNING\") && attempts < maxAttempts){\n            await new Promise((r)=>setTimeout(r, 500));\n            attempts++;\n            const statusRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_3__.GetQueryExecutionCommand({\n                QueryExecutionId: queryId\n            }));\n            state = statusRes.QueryExecution?.Status?.State;\n            // Log progress periodically\n            if (attempts % logInterval === 0) {\n                const elapsedSeconds = Math.floor(attempts * 0.5);\n                console.log(`   â³ Query ${queryId}: ${state} (${elapsedSeconds}s elapsed)`);\n                // If stuck in QUEUED for too long, log warning\n                if (state === \"QUEUED\" && elapsedSeconds > 30) {\n                    console.warn(`   âš ï¸ Query ${queryId} has been QUEUED for ${elapsedSeconds}s. This may indicate Athena is overloaded or there are permission issues.`);\n                }\n            }\n            if (state === \"FAILED\") {\n                const reason = statusRes.QueryExecution?.Status?.StateChangeReason || \"Query failed\";\n                const queryString = statusRes.QueryExecution?.Query || \"\";\n                const statistics = statusRes.QueryExecution?.Statistics;\n                console.error(`âŒ Athena query ${queryId} failed:`);\n                console.error(`   Reason: ${reason}`);\n                console.error(`   Query: ${queryString.substring(0, 500)}${queryString.length > 500 ? \"...\" : \"\"}`);\n                if (statistics) {\n                    console.error(`   Statistics:`, JSON.stringify(statistics, null, 2));\n                }\n                throw new Error(`Athena query failed: ${reason}`);\n            }\n            if (state === \"CANCELLED\") {\n                console.error(`âŒ Athena query ${queryId} was cancelled`);\n                throw new Error(\"Athena query was cancelled\");\n            }\n        }\n        if (state !== \"SUCCEEDED\") {\n            const elapsedSeconds = Math.floor(attempts * 0.5);\n            const errorMsg = `Query ${queryId} did not complete within ${elapsedSeconds}s. Final state: ${state}`;\n            console.error(`âŒ ${errorMsg}`);\n            console.error(`   Query: ${sql.substring(0, 500)}${sql.length > 500 ? \"...\" : \"\"}`);\n            console.error(`   You can check the query status in AWS Console: https://console.aws.amazon.com/athena/home?region=${process.env.AWS_REGION || \"us-west-2\"}#query-history`);\n            throw new Error(errorMsg);\n        }\n        console.log(`âœ… Athena query ${queryId} completed successfully (${Math.floor(attempts * 0.5)}s)`);\n        // Get results\n        const resultsRes = await athena.send(new _aws_sdk_client_athena__WEBPACK_IMPORTED_MODULE_4__.GetQueryResultsCommand({\n            QueryExecutionId: queryId\n        }));\n        const rows = resultsRes.ResultSet?.Rows || [];\n        if (rows.length === 0) {\n            return {\n                columns: [],\n                rows: []\n            };\n        }\n        // First row is headers\n        const columns = rows[0].Data?.map((d)=>d.VarCharValue || \"\") || [];\n        // Remaining rows are data\n        const data = rows.slice(1).map((row)=>{\n            const obj = {};\n            row.Data?.forEach((d, i)=>{\n                const value = d.VarCharValue;\n                const columnName = columns[i];\n                // Keep dates as strings (they come formatted from Athena)\n                if (columnName === \"date\" && value) {\n                    obj[columnName] = value;\n                } else if (value !== null && value !== undefined) {\n                    // Try to parse numbers\n                    const numValue = parseFloat(value);\n                    obj[columnName] = isNaN(numValue) ? value : numValue;\n                } else {\n                    obj[columnName] = null;\n                }\n            });\n            return obj;\n        });\n        return {\n            columns,\n            rows: data\n        };\n    } catch (error) {\n        console.error(\"Athena query error:\", error);\n        // Provide more helpful error messages\n        if (error.name === \"InvalidRequestException\") {\n            if (error.message?.includes(\"Database\") || error.message?.includes(\"not found\")) {\n                throw new Error(`Athena database '${DATABASE}' not found. Please create it in AWS Glue first.`);\n            }\n            if (error.message?.includes(\"does not exist\")) {\n                throw new Error(`Table does not exist. Error: ${error.message}`);\n            }\n        }\n        if (error.name === \"AccessDeniedException\") {\n            throw new Error(`Access denied to Athena. Please check IAM permissions. Error: ${error.message}`);\n        }\n        throw error;\n    }\n}\n/**\n * Discover partitions from S3 by listing objects\n */ async function discoverPartitionsFromS3(datasetName) {\n    const prefix = `${datasetName}/`;\n    const partitions = new Set();\n    try {\n        console.log(`ðŸ” Discovering partitions for ${datasetName} from S3 prefix: ${prefix}`);\n        let continuationToken;\n        let pageCount = 0;\n        do {\n            pageCount++;\n            const listRes = await s3Client.send(new _aws_sdk_client_s3__WEBPACK_IMPORTED_MODULE_0__.ListObjectsV2Command({\n                Bucket: BUCKET,\n                Prefix: prefix,\n                Delimiter: \"/\",\n                MaxKeys: 1000\n            }));\n            // Extract partition dates from common prefixes\n            if (listRes.CommonPrefixes) {\n                console.log(`   Page ${pageCount}: Found ${listRes.CommonPrefixes.length} common prefixes`);\n                for (const prefixObj of listRes.CommonPrefixes){\n                    const prefixPath = prefixObj.Prefix || \"\";\n                    const match = prefixPath.match(/date=(\\d{4}-\\d{2}-\\d{2})/);\n                    if (match) {\n                        partitions.add(match[1]);\n                    }\n                }\n            }\n            // Also check individual objects for date patterns (in case Delimiter didn't catch them)\n            if (listRes.Contents) {\n                console.log(`   Page ${pageCount}: Found ${listRes.Contents.length} objects`);\n                for (const obj of listRes.Contents){\n                    const key = obj.Key || \"\";\n                    const match = key.match(/date=(\\d{4}-\\d{2}-\\d{2})/);\n                    if (match) {\n                        partitions.add(match[1]);\n                    }\n                }\n            }\n            continuationToken = listRes.NextContinuationToken;\n            if (continuationToken) {\n                console.log(`   Page ${pageCount}: More results available, continuing...`);\n            }\n        }while (continuationToken);\n        const sortedPartitions = Array.from(partitions).sort();\n        console.log(`âœ… Discovered ${sortedPartitions.length} partitions: ${sortedPartitions.slice(0, 5).join(\", \")}${sortedPartitions.length > 5 ? \"...\" : \"\"}`);\n        return sortedPartitions;\n    } catch (error) {\n        console.error(`âŒ Error discovering partitions from S3:`, error.message || error);\n        return [];\n    }\n}\n/**\n * Add partitions manually to ensure all data is accessible\n */ async function addPartitionsManually(tableName, datasetName, partitions) {\n    if (partitions.length === 0) {\n        console.log(`No partitions found in S3 for ${datasetName}`);\n        return;\n    }\n    console.log(`ðŸ“¦ Found ${partitions.length} partitions in S3, adding to table...`);\n    // Add partitions in batches (Athena has limits)\n    const batchSize = 50;\n    for(let i = 0; i < partitions.length; i += batchSize){\n        const batch = partitions.slice(i, i + batchSize);\n        const partitionSpecs = batch.map((date)=>`PARTITION (date='${date}') LOCATION 's3://${BUCKET}/${datasetName}/date=${date}/'`).join(\", \");\n        try {\n            await runQuery(`ALTER TABLE ${tableName} ADD IF NOT EXISTS ${partitionSpecs}`);\n            console.log(`âœ… Added ${batch.length} partitions (${i + 1}-${Math.min(i + batch.length, partitions.length)}/${partitions.length})`);\n        } catch (error) {\n            // Ignore \"partition already exists\" errors\n            if (!error.message?.includes(\"already exists\")) {\n                console.warn(`Warning adding partitions batch ${i / batchSize + 1}:`, error.message);\n            }\n        }\n    }\n}\n/**\n * Create an external table for a dataset in Athena/Glue\n * Ensures all partitions are loaded so all Parquet files are accessible\n */ async function createTableForDataset(datasetName) {\n    const tableName = getTableName(datasetName);\n    // First, discover partitions from S3\n    console.log(`ðŸ” Discovering partitions for ${datasetName} from S3...`);\n    const s3Partitions = await discoverPartitionsFromS3(datasetName);\n    console.log(`ðŸ“… Found ${s3Partitions.length} partitions in S3:`, s3Partitions.slice(0, 10).join(\", \"), s3Partitions.length > 10 ? \"...\" : \"\");\n    const sql = `\n    CREATE EXTERNAL TABLE IF NOT EXISTS ${tableName} (\n      ad_id STRING,\n      utc_timestamp TIMESTAMP,\n      horizontal_accuracy DOUBLE,\n      id_type STRING,\n      ip_address STRING,\n      latitude DOUBLE,\n      longitude DOUBLE,\n      iso_country_code STRING,\n      poi_ids ARRAY<STRING>\n    )\n    PARTITIONED BY (date STRING)\n    STORED AS PARQUET\n    LOCATION 's3://${BUCKET}/${datasetName}/'\n  `;\n    try {\n        await runQuery(sql);\n        console.log(`âœ… Created/verified table: ${tableName}`);\n        // Try MSCK REPAIR first (fastest if it works)\n        try {\n            await runQuery(`MSCK REPAIR TABLE ${tableName}`);\n            console.log(`âœ… Repaired partitions with MSCK REPAIR`);\n        } catch (repairError) {\n            console.warn(`MSCK REPAIR failed:`, repairError.message);\n            // Fall back to manual partition addition\n            if (s3Partitions.length > 0) {\n                await addPartitionsManually(tableName, datasetName, s3Partitions);\n            }\n        }\n        // Verify partitions are accessible by checking row count\n        try {\n            const countRes = await runQuery(`SELECT COUNT(*) as total FROM ${tableName} LIMIT 1`);\n            const totalRows = countRes.rows[0]?.total || 0;\n            console.log(`ðŸ“Š Table ${tableName} has ${totalRows.toLocaleString()} total rows`);\n            // Also check partition count\n            const partitionRes = await runQuery(`SELECT COUNT(DISTINCT date) as partition_count FROM ${tableName}`);\n            const partitionCount = partitionRes.rows[0]?.partition_count || 0;\n            console.log(`ðŸ“… Table ${tableName} has ${partitionCount} partitions loaded`);\n            if (totalRows === 0) {\n                console.warn(`âš ï¸  Warning: Table ${tableName} appears empty. Expected ${s3Partitions.length} partitions from S3.`);\n            } else if (partitionCount < s3Partitions.length) {\n                console.warn(`âš ï¸  Warning: Only ${partitionCount}/${s3Partitions.length} partitions loaded. Trying manual addition...`);\n                await addPartitionsManually(tableName, datasetName, s3Partitions);\n            }\n        } catch (countError) {\n            console.warn(`Could not verify row count:`, countError);\n        }\n    } catch (error) {\n        // If table exists with different schema, try to repair partitions\n        if (error.message?.includes(\"already exists\")) {\n            console.log(`Table ${tableName} already exists, repairing partitions...`);\n            try {\n                await runQuery(`MSCK REPAIR TABLE ${tableName}`);\n                console.log(`âœ… Repaired partitions for ${tableName}`);\n            } catch (repairError) {\n                console.warn(`MSCK REPAIR failed, trying manual partition addition...`);\n                if (s3Partitions.length > 0) {\n                    await addPartitionsManually(tableName, datasetName, s3Partitions);\n                }\n            }\n        } else {\n            throw error;\n        }\n    }\n}\n/**\n * Check if a table exists in Athena\n */ async function tableExists(datasetName) {\n    const tableName = getTableName(datasetName);\n    try {\n        await runQuery(`DESCRIBE ${tableName}`);\n        return true;\n    } catch (error) {\n        // If it's a \"table not found\" error, return false\n        if (error.message?.includes(\"does not exist\") || error.message?.includes(\"Table not found\") || error.message?.includes(\"Table veraset.\") || error.name === \"InvalidRequestException\") {\n            return false;\n        }\n        // For access/permission errors, re-throw with helpful message\n        if (error.message?.includes(\"not authorized\") || error.message?.includes(\"Access denied\") || error.name === \"AccessDeniedException\") {\n            throw error; // Will be caught and handled with better message\n        }\n        // For other errors, re-throw\n        throw error;\n    }\n}\n/**\n * Get table name for a dataset\n * Adds 'ds_' prefix to ensure table name starts with a letter (required by SQL)\n */ function getTableName(datasetName) {\n    const sanitized = datasetName.replace(/-/g, \"_\").replace(/[^a-z0-9_]/gi, \"_\");\n    // SQL table names cannot start with a number, so add prefix if needed\n    return /^[0-9]/.test(sanitized) ? `ds_${sanitized}` : sanitized;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UyxzQkFDeEIzQixNQUFNMEIsT0FBTyxFQUFFQyxTQUFTLHFCQUN4QjNCLE1BQU15QixJQUFJLEtBQUssMkJBQTJCO1lBQzVDLE9BQU87UUFDVDtRQUNBLDhEQUE4RDtRQUM5RCxJQUFJekIsTUFBTTBCLE9BQU8sRUFBRUMsU0FBUyxxQkFDeEIzQixNQUFNMEIsT0FBTyxFQUFFQyxTQUFTLG9CQUN4QjNCLE1BQU15QixJQUFJLEtBQUsseUJBQXlCO1lBQzFDLE1BQU16QixPQUFPLGlEQUFpRDtRQUNoRTtRQUNBLDZCQUE2QjtRQUM3QixNQUFNQTtJQUNSO0FBQ0Y7QUFFQTs7O0NBR0MsR0FDTSxTQUFTOEQsYUFBYWpDLFdBQW1CO0lBQzlDLE1BQU02QyxZQUFZN0MsWUFBWThDLE9BQU8sQ0FBQyxNQUFNLEtBQUtBLE9BQU8sQ0FBQyxnQkFBZ0I7SUFDekUsc0VBQXNFO0lBQ3RFLE9BQU8sU0FBU0MsSUFBSSxDQUFDRixhQUFhLENBQUMsR0FBRyxFQUFFQSxVQUFVLENBQUMsR0FBR0E7QUFDeEQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9nbWMtdmVyYXNldC1hcGkvLi9saWIvYXRoZW5hLnRzPzU3YTEiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBV1MgQXRoZW5hIGNsaWVudCBmb3IgcXVlcnlpbmcgUGFycXVldCBmaWxlcyBpbiBTM1xuICovXG5cbmltcG9ydCB7XG4gIEF0aGVuYUNsaWVudCxcbiAgU3RhcnRRdWVyeUV4ZWN1dGlvbkNvbW1hbmQsXG4gIEdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCxcbiAgR2V0UXVlcnlSZXN1bHRzQ29tbWFuZCxcbiAgUXVlcnlFeGVjdXRpb25TdGF0ZSxcbn0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWF0aGVuYSc7XG5pbXBvcnQgeyBTM0NsaWVudCwgTGlzdE9iamVjdHNWMkNvbW1hbmQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xuXG5jb25zdCBhdGhlbmEgPSBuZXcgQXRoZW5hQ2xpZW50KHtcbiAgcmVnaW9uOiBwcm9jZXNzLmVudi5BV1NfUkVHSU9OIHx8ICd1cy13ZXN0LTInLFxuICBjcmVkZW50aWFsczoge1xuICAgIGFjY2Vzc0tleUlkOiBwcm9jZXNzLmVudi5BV1NfQUNDRVNTX0tFWV9JRCB8fCAnJyxcbiAgICBzZWNyZXRBY2Nlc3NLZXk6IHByb2Nlc3MuZW52LkFXU19TRUNSRVRfQUNDRVNTX0tFWSB8fCAnJyxcbiAgfSxcbn0pO1xuXG5jb25zdCBEQVRBQkFTRSA9ICd2ZXJhc2V0JztcbmNvbnN0IE9VVFBVVF9MT0NBVElPTiA9IHByb2Nlc3MuZW52LkFUSEVOQV9PVVRQVVRfTE9DQVRJT04gfHwgXG4gIGBzMzovLyR7cHJvY2Vzcy5lbnYuUzNfQlVDS0VUIHx8ICdnYXJyaXR6LXZlcmFzZXQtZGF0YS11cy13ZXN0LTInfS9hdGhlbmEtcmVzdWx0cy9gO1xuY29uc3QgQlVDS0VUID0gcHJvY2Vzcy5lbnYuUzNfQlVDS0VUIHx8ICdnYXJyaXR6LXZlcmFzZXQtZGF0YS11cy13ZXN0LTInO1xuXG5jb25zdCBzM0NsaWVudCA9IG5ldyBTM0NsaWVudCh7XG4gIHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtd2VzdC0yJyxcbiAgY3JlZGVudGlhbHM6IHtcbiAgICBhY2Nlc3NLZXlJZDogcHJvY2Vzcy5lbnYuQVdTX0FDQ0VTU19LRVlfSUQgfHwgJycsXG4gICAgc2VjcmV0QWNjZXNzS2V5OiBwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVkgfHwgJycsXG4gIH0sXG59KTtcblxuZXhwb3J0IGludGVyZmFjZSBRdWVyeVJlc3VsdCB7XG4gIGNvbHVtbnM6IHN0cmluZ1tdO1xuICByb3dzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+W107XG59XG5cbi8qKlxuICogUnVuIGFuIEF0aGVuYSBTUUwgcXVlcnkgYW5kIHJldHVybiByZXN1bHRzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBydW5RdWVyeShzcWw6IHN0cmluZyk6IFByb21pc2U8UXVlcnlSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICAvLyBDaGVjayBpZiBBV1MgY3JlZGVudGlhbHMgYXJlIGNvbmZpZ3VyZWRcbiAgICBpZiAoIXByb2Nlc3MuZW52LkFXU19BQ0NFU1NfS0VZX0lEIHx8ICFwcm9jZXNzLmVudi5BV1NfU0VDUkVUX0FDQ0VTU19LRVkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQVdTIGNyZWRlbnRpYWxzIG5vdCBjb25maWd1cmVkLiBQbGVhc2Ugc2V0IEFXU19BQ0NFU1NfS0VZX0lEIGFuZCBBV1NfU0VDUkVUX0FDQ0VTU19LRVkgZW52aXJvbm1lbnQgdmFyaWFibGVzLicpO1xuICAgIH1cblxuICAgIC8vIFN0YXJ0IHF1ZXJ5XG4gICAgY29uc3Qgc3RhcnRSZXMgPSBhd2FpdCBhdGhlbmEuc2VuZChuZXcgU3RhcnRRdWVyeUV4ZWN1dGlvbkNvbW1hbmQoe1xuICAgICAgUXVlcnlTdHJpbmc6IHNxbCxcbiAgICAgIFF1ZXJ5RXhlY3V0aW9uQ29udGV4dDogeyBEYXRhYmFzZTogREFUQUJBU0UgfSxcbiAgICAgIFJlc3VsdENvbmZpZ3VyYXRpb246IHsgT3V0cHV0TG9jYXRpb246IE9VVFBVVF9MT0NBVElPTiB9LFxuICAgIH0pKTtcblxuICAgIGNvbnN0IHF1ZXJ5SWQgPSBzdGFydFJlcy5RdWVyeUV4ZWN1dGlvbklkO1xuICAgIGlmICghcXVlcnlJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBxdWVyeSBleGVjdXRpb24gSUQgcmV0dXJuZWQgZnJvbSBBdGhlbmEnKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+agCBTdGFydGVkIEF0aGVuYSBxdWVyeTogJHtxdWVyeUlkfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBRdWVyeSBwcmV2aWV3OiAke3NxbC5zdWJzdHJpbmcoMCwgMjAwKX0ke3NxbC5sZW5ndGggPiAyMDAgPyAnLi4uJyA6ICcnfWApO1xuXG4gICAgLy8gUG9sbCBmb3IgY29tcGxldGlvblxuICAgIGxldCBzdGF0ZTogUXVlcnlFeGVjdXRpb25TdGF0ZSA9ICdRVUVVRUQnO1xuICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgY29uc3QgbWF4QXR0ZW1wdHMgPSA2MDA7IC8vIDUgbWludXRlcyBtYXggKDUwMG1zICogNjAwKSAtIEF0aGVuYSBxdWVyaWVzIGNhbiB0YWtlIHRpbWVcbiAgICBjb25zdCBsb2dJbnRlcnZhbCA9IDIwOyAvLyBMb2cgZXZlcnkgMTAgc2Vjb25kc1xuXG4gICAgd2hpbGUgKChzdGF0ZSA9PT0gJ1FVRVVFRCcgfHwgc3RhdGUgPT09ICdSVU5OSU5HJykgJiYgYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cykge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDUwMCkpO1xuICAgICAgYXR0ZW1wdHMrKztcblxuICAgICAgY29uc3Qgc3RhdHVzUmVzID0gYXdhaXQgYXRoZW5hLnNlbmQobmV3IEdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCh7XG4gICAgICAgIFF1ZXJ5RXhlY3V0aW9uSWQ6IHF1ZXJ5SWQsXG4gICAgICB9KSk7XG5cbiAgICAgIHN0YXRlID0gc3RhdHVzUmVzLlF1ZXJ5RXhlY3V0aW9uPy5TdGF0dXM/LlN0YXRlIGFzIFF1ZXJ5RXhlY3V0aW9uU3RhdGU7XG4gICAgICBcbiAgICAgIC8vIExvZyBwcm9ncmVzcyBwZXJpb2RpY2FsbHlcbiAgICAgIGlmIChhdHRlbXB0cyAlIGxvZ0ludGVydmFsID09PSAwKSB7XG4gICAgICAgIGNvbnN0IGVsYXBzZWRTZWNvbmRzID0gTWF0aC5mbG9vcihhdHRlbXB0cyAqIDAuNSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICDij7MgUXVlcnkgJHtxdWVyeUlkfTogJHtzdGF0ZX0gKCR7ZWxhcHNlZFNlY29uZHN9cyBlbGFwc2VkKWApO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgc3R1Y2sgaW4gUVVFVUVEIGZvciB0b28gbG9uZywgbG9nIHdhcm5pbmdcbiAgICAgICAgaWYgKHN0YXRlID09PSAnUVVFVUVEJyAmJiBlbGFwc2VkU2Vjb25kcyA+IDMwKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGAgICDimqDvuI8gUXVlcnkgJHtxdWVyeUlkfSBoYXMgYmVlbiBRVUVVRUQgZm9yICR7ZWxhcHNlZFNlY29uZHN9cy4gVGhpcyBtYXkgaW5kaWNhdGUgQXRoZW5hIGlzIG92ZXJsb2FkZWQgb3IgdGhlcmUgYXJlIHBlcm1pc3Npb24gaXNzdWVzLmApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gJ0ZBSUxFRCcpIHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gc3RhdHVzUmVzLlF1ZXJ5RXhlY3V0aW9uPy5TdGF0dXM/LlN0YXRlQ2hhbmdlUmVhc29uIHx8ICdRdWVyeSBmYWlsZWQnO1xuICAgICAgICBjb25zdCBxdWVyeVN0cmluZyA9IHN0YXR1c1Jlcy5RdWVyeUV4ZWN1dGlvbj8uUXVlcnkgfHwgJyc7XG4gICAgICAgIGNvbnN0IHN0YXRpc3RpY3MgPSBzdGF0dXNSZXMuUXVlcnlFeGVjdXRpb24/LlN0YXRpc3RpY3M7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBBdGhlbmEgcXVlcnkgJHtxdWVyeUlkfSBmYWlsZWQ6YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFF1ZXJ5OiAke3F1ZXJ5U3RyaW5nLnN1YnN0cmluZygwLCA1MDApfSR7cXVlcnlTdHJpbmcubGVuZ3RoID4gNTAwID8gJy4uLicgOiAnJ31gKTtcbiAgICAgICAgaWYgKHN0YXRpc3RpY3MpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGAgICBTdGF0aXN0aWNzOmAsIEpTT04uc3RyaW5naWZ5KHN0YXRpc3RpY3MsIG51bGwsIDIpKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0aGVuYSBxdWVyeSBmYWlsZWQ6ICR7cmVhc29ufWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RhdGUgPT09ICdDQU5DRUxMRUQnKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBBdGhlbmEgcXVlcnkgJHtxdWVyeUlkfSB3YXMgY2FuY2VsbGVkYCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQXRoZW5hIHF1ZXJ5IHdhcyBjYW5jZWxsZWQnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUgIT09ICdTVUNDRUVERUQnKSB7XG4gICAgICBjb25zdCBlbGFwc2VkU2Vjb25kcyA9IE1hdGguZmxvb3IoYXR0ZW1wdHMgKiAwLjUpO1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSBgUXVlcnkgJHtxdWVyeUlkfSBkaWQgbm90IGNvbXBsZXRlIHdpdGhpbiAke2VsYXBzZWRTZWNvbmRzfXMuIEZpbmFsIHN0YXRlOiAke3N0YXRlfWA7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgJHtlcnJvck1zZ31gKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYCAgIFF1ZXJ5OiAke3NxbC5zdWJzdHJpbmcoMCwgNTAwKX0ke3NxbC5sZW5ndGggPiA1MDAgPyAnLi4uJyA6ICcnfWApO1xuICAgICAgY29uc29sZS5lcnJvcihgICAgWW91IGNhbiBjaGVjayB0aGUgcXVlcnkgc3RhdHVzIGluIEFXUyBDb25zb2xlOiBodHRwczovL2NvbnNvbGUuYXdzLmFtYXpvbi5jb20vYXRoZW5hL2hvbWU/cmVnaW9uPSR7cHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtd2VzdC0yJ30jcXVlcnktaGlzdG9yeWApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yTXNnKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg4pyFIEF0aGVuYSBxdWVyeSAke3F1ZXJ5SWR9IGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgKCR7TWF0aC5mbG9vcihhdHRlbXB0cyAqIDAuNSl9cylgKTtcblxuICAgIC8vIEdldCByZXN1bHRzXG4gICAgY29uc3QgcmVzdWx0c1JlcyA9IGF3YWl0IGF0aGVuYS5zZW5kKG5ldyBHZXRRdWVyeVJlc3VsdHNDb21tYW5kKHtcbiAgICAgIFF1ZXJ5RXhlY3V0aW9uSWQ6IHF1ZXJ5SWQsXG4gICAgfSkpO1xuXG4gICAgY29uc3Qgcm93cyA9IHJlc3VsdHNSZXMuUmVzdWx0U2V0Py5Sb3dzIHx8IFtdO1xuICAgIGlmIChyb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHsgY29sdW1uczogW10sIHJvd3M6IFtdIH07XG4gICAgfVxuXG4gICAgLy8gRmlyc3Qgcm93IGlzIGhlYWRlcnNcbiAgICBjb25zdCBjb2x1bW5zID0gcm93c1swXS5EYXRhPy5tYXAoZCA9PiBkLlZhckNoYXJWYWx1ZSB8fCAnJykgfHwgW107XG5cbiAgICAvLyBSZW1haW5pbmcgcm93cyBhcmUgZGF0YVxuICAgIGNvbnN0IGRhdGEgPSByb3dzLnNsaWNlKDEpLm1hcChyb3cgPT4ge1xuICAgICAgY29uc3Qgb2JqOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICByb3cuRGF0YT8uZm9yRWFjaCgoZCwgaSkgPT4ge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGQuVmFyQ2hhclZhbHVlO1xuICAgICAgICBjb25zdCBjb2x1bW5OYW1lID0gY29sdW1uc1tpXTtcbiAgICAgICAgXG4gICAgICAgIC8vIEtlZXAgZGF0ZXMgYXMgc3RyaW5ncyAodGhleSBjb21lIGZvcm1hdHRlZCBmcm9tIEF0aGVuYSlcbiAgICAgICAgaWYgKGNvbHVtbk5hbWUgPT09ICdkYXRlJyAmJiB2YWx1ZSkge1xuICAgICAgICAgIG9ialtjb2x1bW5OYW1lXSA9IHZhbHVlO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAvLyBUcnkgdG8gcGFyc2UgbnVtYmVyc1xuICAgICAgICAgIGNvbnN0IG51bVZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gICAgICAgICAgb2JqW2NvbHVtbk5hbWVdID0gaXNOYU4obnVtVmFsdWUpID8gdmFsdWUgOiBudW1WYWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvYmpbY29sdW1uTmFtZV0gPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSk7XG5cbiAgICByZXR1cm4geyBjb2x1bW5zLCByb3dzOiBkYXRhIH07XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBdGhlbmEgcXVlcnkgZXJyb3I6JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIFByb3ZpZGUgbW9yZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2VzXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdJbnZhbGlkUmVxdWVzdEV4Y2VwdGlvbicpIHtcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnRGF0YWJhc2UnKSB8fCBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGZvdW5kJykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBBdGhlbmEgZGF0YWJhc2UgJyR7REFUQUJBU0V9JyBub3QgZm91bmQuIFBsZWFzZSBjcmVhdGUgaXQgaW4gQVdTIEdsdWUgZmlyc3QuYCk7XG4gICAgICB9XG4gICAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2RvZXMgbm90IGV4aXN0JykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUYWJsZSBkb2VzIG5vdCBleGlzdC4gRXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYgKGVycm9yLm5hbWUgPT09ICdBY2Nlc3NEZW5pZWRFeGNlcHRpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjY2VzcyBkZW5pZWQgdG8gQXRoZW5hLiBQbGVhc2UgY2hlY2sgSUFNIHBlcm1pc3Npb25zLiBFcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgICBcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIERpc2NvdmVyIHBhcnRpdGlvbnMgZnJvbSBTMyBieSBsaXN0aW5nIG9iamVjdHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGlzY292ZXJQYXJ0aXRpb25zRnJvbVMzKGRhdGFzZXROYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIGNvbnN0IHByZWZpeCA9IGAke2RhdGFzZXROYW1lfS9gO1xuICBjb25zdCBwYXJ0aXRpb25zID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKGDwn5SNIERpc2NvdmVyaW5nIHBhcnRpdGlvbnMgZm9yICR7ZGF0YXNldE5hbWV9IGZyb20gUzMgcHJlZml4OiAke3ByZWZpeH1gKTtcbiAgICBsZXQgY29udGludWF0aW9uVG9rZW46IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICBsZXQgcGFnZUNvdW50ID0gMDtcbiAgICBcbiAgICBkbyB7XG4gICAgICBwYWdlQ291bnQrKztcbiAgICAgIGNvbnN0IGxpc3RSZXMgPSBhd2FpdCBzM0NsaWVudC5zZW5kKG5ldyBMaXN0T2JqZWN0c1YyQ29tbWFuZCh7XG4gICAgICAgIEJ1Y2tldDogQlVDS0VULFxuICAgICAgICBQcmVmaXg6IHByZWZpeCxcbiAgICAgICAgRGVsaW1pdGVyOiAnLycsXG4gICAgICAgIE1heEtleXM6IDEwMDAsIC8vIEdldCBtb3JlIHJlc3VsdHMgcGVyIHBhZ2VcbiAgICAgIH0pKTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBwYXJ0aXRpb24gZGF0ZXMgZnJvbSBjb21tb24gcHJlZml4ZXNcbiAgICAgIGlmIChsaXN0UmVzLkNvbW1vblByZWZpeGVzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICBQYWdlICR7cGFnZUNvdW50fTogRm91bmQgJHtsaXN0UmVzLkNvbW1vblByZWZpeGVzLmxlbmd0aH0gY29tbW9uIHByZWZpeGVzYCk7XG4gICAgICAgIGZvciAoY29uc3QgcHJlZml4T2JqIG9mIGxpc3RSZXMuQ29tbW9uUHJlZml4ZXMpIHtcbiAgICAgICAgICBjb25zdCBwcmVmaXhQYXRoID0gcHJlZml4T2JqLlByZWZpeCB8fCAnJztcbiAgICAgICAgICBjb25zdCBtYXRjaCA9IHByZWZpeFBhdGgubWF0Y2goL2RhdGU9KFxcZHs0fS1cXGR7Mn0tXFxkezJ9KS8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgcGFydGl0aW9ucy5hZGQobWF0Y2hbMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBbHNvIGNoZWNrIGluZGl2aWR1YWwgb2JqZWN0cyBmb3IgZGF0ZSBwYXR0ZXJucyAoaW4gY2FzZSBEZWxpbWl0ZXIgZGlkbid0IGNhdGNoIHRoZW0pXG4gICAgICBpZiAobGlzdFJlcy5Db250ZW50cykge1xuICAgICAgICBjb25zb2xlLmxvZyhgICAgUGFnZSAke3BhZ2VDb3VudH06IEZvdW5kICR7bGlzdFJlcy5Db250ZW50cy5sZW5ndGh9IG9iamVjdHNgKTtcbiAgICAgICAgZm9yIChjb25zdCBvYmogb2YgbGlzdFJlcy5Db250ZW50cykge1xuICAgICAgICAgIGNvbnN0IGtleSA9IG9iai5LZXkgfHwgJyc7XG4gICAgICAgICAgY29uc3QgbWF0Y2ggPSBrZXkubWF0Y2goL2RhdGU9KFxcZHs0fS1cXGR7Mn0tXFxkezJ9KS8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgcGFydGl0aW9ucy5hZGQobWF0Y2hbMV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb250aW51YXRpb25Ub2tlbiA9IGxpc3RSZXMuTmV4dENvbnRpbnVhdGlvblRva2VuO1xuICAgICAgaWYgKGNvbnRpbnVhdGlvblRva2VuKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICBQYWdlICR7cGFnZUNvdW50fTogTW9yZSByZXN1bHRzIGF2YWlsYWJsZSwgY29udGludWluZy4uLmApO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGNvbnRpbnVhdGlvblRva2VuKTtcbiAgICBcbiAgICBjb25zdCBzb3J0ZWRQYXJ0aXRpb25zID0gQXJyYXkuZnJvbShwYXJ0aXRpb25zKS5zb3J0KCk7XG4gICAgY29uc29sZS5sb2coYOKchSBEaXNjb3ZlcmVkICR7c29ydGVkUGFydGl0aW9ucy5sZW5ndGh9IHBhcnRpdGlvbnM6ICR7c29ydGVkUGFydGl0aW9ucy5zbGljZSgwLCA1KS5qb2luKCcsICcpfSR7c29ydGVkUGFydGl0aW9ucy5sZW5ndGggPiA1ID8gJy4uLicgOiAnJ31gKTtcbiAgICBcbiAgICByZXR1cm4gc29ydGVkUGFydGl0aW9ucztcbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvciBkaXNjb3ZlcmluZyBwYXJ0aXRpb25zIGZyb20gUzM6YCwgZXJyb3IubWVzc2FnZSB8fCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogQWRkIHBhcnRpdGlvbnMgbWFudWFsbHkgdG8gZW5zdXJlIGFsbCBkYXRhIGlzIGFjY2Vzc2libGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWRkUGFydGl0aW9uc01hbnVhbGx5KHRhYmxlTmFtZTogc3RyaW5nLCBkYXRhc2V0TmFtZTogc3RyaW5nLCBwYXJ0aXRpb25zOiBzdHJpbmdbXSk6IFByb21pc2U8dm9pZD4ge1xuICBpZiAocGFydGl0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICBjb25zb2xlLmxvZyhgTm8gcGFydGl0aW9ucyBmb3VuZCBpbiBTMyBmb3IgJHtkYXRhc2V0TmFtZX1gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgXG4gIGNvbnNvbGUubG9nKGDwn5OmIEZvdW5kICR7cGFydGl0aW9ucy5sZW5ndGh9IHBhcnRpdGlvbnMgaW4gUzMsIGFkZGluZyB0byB0YWJsZS4uLmApO1xuICBcbiAgLy8gQWRkIHBhcnRpdGlvbnMgaW4gYmF0Y2hlcyAoQXRoZW5hIGhhcyBsaW1pdHMpXG4gIGNvbnN0IGJhdGNoU2l6ZSA9IDUwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcnRpdGlvbnMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xuICAgIGNvbnN0IGJhdGNoID0gcGFydGl0aW9ucy5zbGljZShpLCBpICsgYmF0Y2hTaXplKTtcbiAgICBjb25zdCBwYXJ0aXRpb25TcGVjcyA9IGJhdGNoLm1hcChkYXRlID0+IFxuICAgICAgYFBBUlRJVElPTiAoZGF0ZT0nJHtkYXRlfScpIExPQ0FUSU9OICdzMzovLyR7QlVDS0VUfS8ke2RhdGFzZXROYW1lfS9kYXRlPSR7ZGF0ZX0vJ2BcbiAgICApLmpvaW4oJywgJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBBTFRFUiBUQUJMRSAke3RhYmxlTmFtZX0gQUREIElGIE5PVCBFWElTVFMgJHtwYXJ0aXRpb25TcGVjc31gKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgQWRkZWQgJHtiYXRjaC5sZW5ndGh9IHBhcnRpdGlvbnMgKCR7aSArIDF9LSR7TWF0aC5taW4oaSArIGJhdGNoLmxlbmd0aCwgcGFydGl0aW9ucy5sZW5ndGgpfS8ke3BhcnRpdGlvbnMubGVuZ3RofSlgKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBJZ25vcmUgXCJwYXJ0aXRpb24gYWxyZWFkeSBleGlzdHNcIiBlcnJvcnNcbiAgICAgIGlmICghZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ2FscmVhZHkgZXhpc3RzJykpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nIGFkZGluZyBwYXJ0aXRpb25zIGJhdGNoICR7aSAvIGJhdGNoU2l6ZSArIDF9OmAsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhbiBleHRlcm5hbCB0YWJsZSBmb3IgYSBkYXRhc2V0IGluIEF0aGVuYS9HbHVlXG4gKiBFbnN1cmVzIGFsbCBwYXJ0aXRpb25zIGFyZSBsb2FkZWQgc28gYWxsIFBhcnF1ZXQgZmlsZXMgYXJlIGFjY2Vzc2libGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRhYmxlRm9yRGF0YXNldChkYXRhc2V0TmFtZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRhYmxlTmFtZSA9IGdldFRhYmxlTmFtZShkYXRhc2V0TmFtZSk7XG5cbiAgLy8gRmlyc3QsIGRpc2NvdmVyIHBhcnRpdGlvbnMgZnJvbSBTM1xuICBjb25zb2xlLmxvZyhg8J+UjSBEaXNjb3ZlcmluZyBwYXJ0aXRpb25zIGZvciAke2RhdGFzZXROYW1lfSBmcm9tIFMzLi4uYCk7XG4gIGNvbnN0IHMzUGFydGl0aW9ucyA9IGF3YWl0IGRpc2NvdmVyUGFydGl0aW9uc0Zyb21TMyhkYXRhc2V0TmFtZSk7XG4gIGNvbnNvbGUubG9nKGDwn5OFIEZvdW5kICR7czNQYXJ0aXRpb25zLmxlbmd0aH0gcGFydGl0aW9ucyBpbiBTMzpgLCBzM1BhcnRpdGlvbnMuc2xpY2UoMCwgMTApLmpvaW4oJywgJyksIHMzUGFydGl0aW9ucy5sZW5ndGggPiAxMCA/ICcuLi4nIDogJycpO1xuXG4gIGNvbnN0IHNxbCA9IGBcbiAgICBDUkVBVEUgRVhURVJOQUwgVEFCTEUgSUYgTk9UIEVYSVNUUyAke3RhYmxlTmFtZX0gKFxuICAgICAgYWRfaWQgU1RSSU5HLFxuICAgICAgdXRjX3RpbWVzdGFtcCBUSU1FU1RBTVAsXG4gICAgICBob3Jpem9udGFsX2FjY3VyYWN5IERPVUJMRSxcbiAgICAgIGlkX3R5cGUgU1RSSU5HLFxuICAgICAgaXBfYWRkcmVzcyBTVFJJTkcsXG4gICAgICBsYXRpdHVkZSBET1VCTEUsXG4gICAgICBsb25naXR1ZGUgRE9VQkxFLFxuICAgICAgaXNvX2NvdW50cnlfY29kZSBTVFJJTkcsXG4gICAgICBwb2lfaWRzIEFSUkFZPFNUUklORz5cbiAgICApXG4gICAgUEFSVElUSU9ORUQgQlkgKGRhdGUgU1RSSU5HKVxuICAgIFNUT1JFRCBBUyBQQVJRVUVUXG4gICAgTE9DQVRJT04gJ3MzOi8vJHtCVUNLRVR9LyR7ZGF0YXNldE5hbWV9LydcbiAgYDtcblxuICB0cnkge1xuICAgIGF3YWl0IHJ1blF1ZXJ5KHNxbCk7XG4gICAgY29uc29sZS5sb2coYOKchSBDcmVhdGVkL3ZlcmlmaWVkIHRhYmxlOiAke3RhYmxlTmFtZX1gKTtcbiAgICBcbiAgICAvLyBUcnkgTVNDSyBSRVBBSVIgZmlyc3QgKGZhc3Rlc3QgaWYgaXQgd29ya3MpXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBNU0NLIFJFUEFJUiBUQUJMRSAke3RhYmxlTmFtZX1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgUmVwYWlyZWQgcGFydGl0aW9ucyB3aXRoIE1TQ0sgUkVQQUlSYCk7XG4gICAgfSBjYXRjaCAocmVwYWlyRXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS53YXJuKGBNU0NLIFJFUEFJUiBmYWlsZWQ6YCwgcmVwYWlyRXJyb3IubWVzc2FnZSk7XG4gICAgICAvLyBGYWxsIGJhY2sgdG8gbWFudWFsIHBhcnRpdGlvbiBhZGRpdGlvblxuICAgICAgaWYgKHMzUGFydGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGF3YWl0IGFkZFBhcnRpdGlvbnNNYW51YWxseSh0YWJsZU5hbWUsIGRhdGFzZXROYW1lLCBzM1BhcnRpdGlvbnMpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBWZXJpZnkgcGFydGl0aW9ucyBhcmUgYWNjZXNzaWJsZSBieSBjaGVja2luZyByb3cgY291bnRcbiAgICB0cnkge1xuICAgICAgY29uc3QgY291bnRSZXMgPSBhd2FpdCBydW5RdWVyeShgU0VMRUNUIENPVU5UKCopIGFzIHRvdGFsIEZST00gJHt0YWJsZU5hbWV9IExJTUlUIDFgKTtcbiAgICAgIGNvbnN0IHRvdGFsUm93cyA9IGNvdW50UmVzLnJvd3NbMF0/LnRvdGFsIHx8IDA7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBUYWJsZSAke3RhYmxlTmFtZX0gaGFzICR7dG90YWxSb3dzLnRvTG9jYWxlU3RyaW5nKCl9IHRvdGFsIHJvd3NgKTtcbiAgICAgIFxuICAgICAgLy8gQWxzbyBjaGVjayBwYXJ0aXRpb24gY291bnRcbiAgICAgIGNvbnN0IHBhcnRpdGlvblJlcyA9IGF3YWl0IHJ1blF1ZXJ5KGBTRUxFQ1QgQ09VTlQoRElTVElOQ1QgZGF0ZSkgYXMgcGFydGl0aW9uX2NvdW50IEZST00gJHt0YWJsZU5hbWV9YCk7XG4gICAgICBjb25zdCBwYXJ0aXRpb25Db3VudCA9IHBhcnRpdGlvblJlcy5yb3dzWzBdPy5wYXJ0aXRpb25fY291bnQgfHwgMDtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OFIFRhYmxlICR7dGFibGVOYW1lfSBoYXMgJHtwYXJ0aXRpb25Db3VudH0gcGFydGl0aW9ucyBsb2FkZWRgKTtcbiAgICAgIFxuICAgICAgaWYgKHRvdGFsUm93cyA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAgV2FybmluZzogVGFibGUgJHt0YWJsZU5hbWV9IGFwcGVhcnMgZW1wdHkuIEV4cGVjdGVkICR7czNQYXJ0aXRpb25zLmxlbmd0aH0gcGFydGl0aW9ucyBmcm9tIFMzLmApO1xuICAgICAgfSBlbHNlIGlmIChwYXJ0aXRpb25Db3VudCA8IHMzUGFydGl0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIFdhcm5pbmc6IE9ubHkgJHtwYXJ0aXRpb25Db3VudH0vJHtzM1BhcnRpdGlvbnMubGVuZ3RofSBwYXJ0aXRpb25zIGxvYWRlZC4gVHJ5aW5nIG1hbnVhbCBhZGRpdGlvbi4uLmApO1xuICAgICAgICBhd2FpdCBhZGRQYXJ0aXRpb25zTWFudWFsbHkodGFibGVOYW1lLCBkYXRhc2V0TmFtZSwgczNQYXJ0aXRpb25zKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChjb3VudEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYENvdWxkIG5vdCB2ZXJpZnkgcm93IGNvdW50OmAsIGNvdW50RXJyb3IpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgIC8vIElmIHRhYmxlIGV4aXN0cyB3aXRoIGRpZmZlcmVudCBzY2hlbWEsIHRyeSB0byByZXBhaXIgcGFydGl0aW9uc1xuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnYWxyZWFkeSBleGlzdHMnKSkge1xuICAgICAgY29uc29sZS5sb2coYFRhYmxlICR7dGFibGVOYW1lfSBhbHJlYWR5IGV4aXN0cywgcmVwYWlyaW5nIHBhcnRpdGlvbnMuLi5gKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHJ1blF1ZXJ5KGBNU0NLIFJFUEFJUiBUQUJMRSAke3RhYmxlTmFtZX1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBSZXBhaXJlZCBwYXJ0aXRpb25zIGZvciAke3RhYmxlTmFtZX1gKTtcbiAgICAgIH0gY2F0Y2ggKHJlcGFpckVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgTVNDSyBSRVBBSVIgZmFpbGVkLCB0cnlpbmcgbWFudWFsIHBhcnRpdGlvbiBhZGRpdGlvbi4uLmApO1xuICAgICAgICBpZiAoczNQYXJ0aXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhd2FpdCBhZGRQYXJ0aXRpb25zTWFudWFsbHkodGFibGVOYW1lLCBkYXRhc2V0TmFtZSwgczNQYXJ0aXRpb25zKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHRhYmxlIGV4aXN0cyBpbiBBdGhlbmFcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHRhYmxlRXhpc3RzKGRhdGFzZXROYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgdGFibGVOYW1lID0gZ2V0VGFibGVOYW1lKGRhdGFzZXROYW1lKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBydW5RdWVyeShgREVTQ1JJQkUgJHt0YWJsZU5hbWV9YCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAvLyBJZiBpdCdzIGEgXCJ0YWJsZSBub3QgZm91bmRcIiBlcnJvciwgcmV0dXJuIGZhbHNlXG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdkb2VzIG5vdCBleGlzdCcpIHx8IFxuICAgICAgICBlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnVGFibGUgbm90IGZvdW5kJykgfHxcbiAgICAgICAgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1RhYmxlIHZlcmFzZXQuJykgfHxcbiAgICAgICAgZXJyb3IubmFtZSA9PT0gJ0ludmFsaWRSZXF1ZXN0RXhjZXB0aW9uJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBGb3IgYWNjZXNzL3Blcm1pc3Npb24gZXJyb3JzLCByZS10aHJvdyB3aXRoIGhlbHBmdWwgbWVzc2FnZVxuICAgIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnbm90IGF1dGhvcml6ZWQnKSB8fCBcbiAgICAgICAgZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ0FjY2VzcyBkZW5pZWQnKSB8fFxuICAgICAgICBlcnJvci5uYW1lID09PSAnQWNjZXNzRGVuaWVkRXhjZXB0aW9uJykge1xuICAgICAgdGhyb3cgZXJyb3I7IC8vIFdpbGwgYmUgY2F1Z2h0IGFuZCBoYW5kbGVkIHdpdGggYmV0dGVyIG1lc3NhZ2VcbiAgICB9XG4gICAgLy8gRm9yIG90aGVyIGVycm9ycywgcmUtdGhyb3dcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0YWJsZSBuYW1lIGZvciBhIGRhdGFzZXRcbiAqIEFkZHMgJ2RzXycgcHJlZml4IHRvIGVuc3VyZSB0YWJsZSBuYW1lIHN0YXJ0cyB3aXRoIGEgbGV0dGVyIChyZXF1aXJlZCBieSBTUUwpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRUYWJsZU5hbWUoZGF0YXNldE5hbWU6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IHNhbml0aXplZCA9IGRhdGFzZXROYW1lLnJlcGxhY2UoLy0vZywgJ18nKS5yZXBsYWNlKC9bXmEtejAtOV9dL2dpLCAnXycpO1xuICAvLyBTUUwgdGFibGUgbmFtZXMgY2Fubm90IHN0YXJ0IHdpdGggYSBudW1iZXIsIHNvIGFkZCBwcmVmaXggaWYgbmVlZGVkXG4gIHJldHVybiAvXlswLTldLy50ZXN0KHNhbml0aXplZCkgPyBgZHNfJHtzYW5pdGl6ZWR9YCA6IHNhbml0aXplZDtcbn1cbiJdLCJuYW1lcyI6WyJBdGhlbmFDbGllbnQiLCJTdGFydFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCIsIkdldFF1ZXJ5RXhlY3V0aW9uQ29tbWFuZCIsIkdldFF1ZXJ5UmVzdWx0c0NvbW1hbmQiLCJTM0NsaWVudCIsIkxpc3RPYmplY3RzVjJDb21tYW5kIiwiYXRoZW5hIiwicmVnaW9uIiwicHJvY2VzcyIsImVudiIsIkFXU19SRUdJT04iLCJjcmVkZW50aWFscyIsImFjY2Vzc0tleUlkIiwiQVdTX0FDQ0VTU19LRVlfSUQiLCJzZWNyZXRBY2Nlc3NLZXkiLCJBV1NfU0VDUkVUX0FDQ0VTU19LRVkiLCJEQVRBQkFTRSIsIk9VVFBVVF9MT0NBVElPTiIsIkFUSEVOQV9PVVRQVVRfTE9DQVRJT04iLCJTM19CVUNLRVQiLCJCVUNLRVQiLCJzM0NsaWVudCIsInJ1blF1ZXJ5Iiwic3FsIiwiRXJyb3IiLCJzdGFydFJlcyIsInNlbmQiLCJRdWVyeVN0cmluZyIsIlF1ZXJ5RXhlY3V0aW9uQ29udGV4dCIsIkRhdGFiYXNlIiwiUmVzdWx0Q29uZmlndXJhdGlvbiIsIk91dHB1dExvY2F0aW9uIiwicXVlcnlJZCIsIlF1ZXJ5RXhlY3V0aW9uSWQiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwibGVuZ3RoIiwic3RhdGUiLCJhdHRlbXB0cyIsIm1heEF0dGVtcHRzIiwibG9nSW50ZXJ2YWwiLCJQcm9taXNlIiwiciIsInNldFRpbWVvdXQiLCJzdGF0dXNSZXMiLCJRdWVyeUV4ZWN1dGlvbiIsIlN0YXR1cyIsIlN0YXRlIiwiZWxhcHNlZFNlY29uZHMiLCJNYXRoIiwiZmxvb3IiLCJ3YXJuIiwicmVhc29uIiwiU3RhdGVDaGFuZ2VSZWFzb24iLCJxdWVyeVN0cmluZyIsIlF1ZXJ5Iiwic3RhdGlzdGljcyIsIlN0YXRpc3RpY3MiLCJlcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvck1zZyIsInJlc3VsdHNSZXMiLCJyb3dzIiwiUmVzdWx0U2V0IiwiUm93cyIsImNvbHVtbnMiLCJEYXRhIiwibWFwIiwiZCIsIlZhckNoYXJWYWx1ZSIsImRhdGEiLCJzbGljZSIsInJvdyIsIm9iaiIsImZvckVhY2giLCJpIiwidmFsdWUiLCJjb2x1bW5OYW1lIiwidW5kZWZpbmVkIiwibnVtVmFsdWUiLCJwYXJzZUZsb2F0IiwiaXNOYU4iLCJuYW1lIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiZGlzY292ZXJQYXJ0aXRpb25zRnJvbVMzIiwiZGF0YXNldE5hbWUiLCJwcmVmaXgiLCJwYXJ0aXRpb25zIiwiU2V0IiwiY29udGludWF0aW9uVG9rZW4iLCJwYWdlQ291bnQiLCJsaXN0UmVzIiwiQnVja2V0IiwiUHJlZml4IiwiRGVsaW1pdGVyIiwiTWF4S2V5cyIsIkNvbW1vblByZWZpeGVzIiwicHJlZml4T2JqIiwicHJlZml4UGF0aCIsIm1hdGNoIiwiYWRkIiwiQ29udGVudHMiLCJrZXkiLCJLZXkiLCJOZXh0Q29udGludWF0aW9uVG9rZW4iLCJzb3J0ZWRQYXJ0aXRpb25zIiwiQXJyYXkiLCJmcm9tIiwic29ydCIsImpvaW4iLCJhZGRQYXJ0aXRpb25zTWFudWFsbHkiLCJ0YWJsZU5hbWUiLCJiYXRjaFNpemUiLCJiYXRjaCIsInBhcnRpdGlvblNwZWNzIiwiZGF0ZSIsIm1pbiIsImNyZWF0ZVRhYmxlRm9yRGF0YXNldCIsImdldFRhYmxlTmFtZSIsInMzUGFydGl0aW9ucyIsInJlcGFpckVycm9yIiwiY291bnRSZXMiLCJ0b3RhbFJvd3MiLCJ0b3RhbCIsInRvTG9jYWxlU3RyaW5nIiwicGFydGl0aW9uUmVzIiwicGFydGl0aW9uQ291bnQiLCJwYXJ0aXRpb25fY291bnQiLCJjb3VudEVycm9yIiwidGFibGVFeGlzdHMiLCJzYW5pdGl6ZWQiLCJyZXBsYWNlIiwidGVzdCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/athena.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@smithy","vendor-chunks/@aws-sdk","vendor-chunks/next","vendor-chunks/@aws"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&page=%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fdatasets%2F%5Bname%5D%2Fpois%2Fenrich%2Froute.ts&appDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fjuliangarritz%2Fdev%2Fpy%2Fveraset%2Fveraset-api&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();